<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>Keep Moving â€¢ Posts by &#34;ai&#34; tag</title>
        <link>http://qianqiu-cell.github.io</link>
        <description>ğŸŒ¸å­¦ä¹ ç¬”è®°ğŸŒ¸</description>
        <language>zh-CN</language>
        <pubDate>Sat, 14 Sep 2024 00:00:00 +0800</pubDate>
        <lastBuildDate>Sat, 14 Sep 2024 00:00:00 +0800</lastBuildDate>
        <category>AI</category>
        <category>ç”µè„‘ç¡¬ä»¶çŸ¥è¯†</category>
        <category>æ˜¾ç¤ºå™¨</category>
        <category>åšå®¢æ­å»º</category>
        <category>æ§åˆ¶å·¥ç¨‹</category>
        <category>æ•°å­¦åŸºç¡€</category>
        <category>ç¡¬ä»¶å¼€å‘</category>
        <category>åŒºé—´ä¸ç¡®å®šæ€§</category>
        <category>latexæŠ€å·§</category>
        <category>è®ºæ–‡ç¼–è¾‘</category>
        <category>æœ€ä¼˜åŒ–</category>
        <category>å¤šç›®æ ‡æœ€ä¼˜åŒ–</category>
        <category>å•ç›®æ ‡æœ€ä¼˜åŒ–</category>
        <category>ç§‘å­¦ç ”ç©¶</category>
        <category>officeæŠ€å·§</category>
        <category>search</category>
        <category>C++</category>
        <category>ç¼–ç¨‹æŠ€å·§</category>
        <category>leetcode</category>
        <category>matlab</category>
        <category>python</category>
        <category>ç³»ç»Ÿè®¾è®¡</category>
        <category>Qt</category>
        <category>ç•Œé¢å¼€å‘</category>
        <item>
            <guid isPermalink="true">http://qianqiu-cell.github.io/2024/09/14/AI/BLIP/</guid>
            <title>BLIP</title>
            <link>http://qianqiu-cell.github.io/2024/09/14/AI/BLIP/</link>
            <category>AI</category>
            <pubDate>Sat, 14 Sep 2024 00:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;ä¸€-å¼•è¨€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸€-å¼•è¨€&#34;&gt;#&lt;/a&gt; ä¸€ã€å¼•è¨€&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒè‡ªä» &lt;code&gt;CLIP&lt;/code&gt;  æ¨ªç©ºå‡ºä¸–ï¼Œå„ç§ è§†è§‰è¯­è¨€é¢„è®­ç»ƒ ( &lt;code&gt;Vision-Language Pre-training, VLP&lt;/code&gt; ) æ¨¡å‹é€æ¸æ¶Œç°ï¼Œæ˜¾è‘—æé«˜äº†å„ç§è§†è§‰è¯­è¨€ä»»åŠ¡çš„æ€§èƒ½ã€‚ç„¶è€Œï¼Œç°æœ‰çš„ &lt;code&gt;VLP&lt;/code&gt;  æ–¹æ³•ä¸»è¦å­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡å‹è§’åº¦&lt;/strong&gt;ï¼šå¤§å¤šæ•°æ–¹æ³•éƒ½æ˜¯åŸºäº ç¼–ç å™¨æ¨¡å‹ ( &lt;code&gt;encoder-based model&lt;/code&gt; ) æˆ–ç¼–ç å™¨ - è§£ç å™¨æ¨¡å‹ ( &lt;code&gt;encoder-decoder models&lt;/code&gt; )ï¼Œå‰è€…éš¾ä»¥å®Œæˆæ–‡æœ¬ç”Ÿæˆä»»åŠ¡ï¼Œåè€…æ— æ³•å®Œæˆå›¾åƒæ–‡æœ¬æ£€ç´¢ä»»åŠ¡ï¼Œè¿™ä¸¤é¡¹ä»»åŠ¡æ— æ³•å…¼é¡¾ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®è§’åº¦&lt;/strong&gt;ï¼šä»¥ &lt;code&gt;CLIP&lt;/code&gt;  ä¸ºä»£è¡¨çš„æ–¹æ³•éƒ½æ˜¯ä»äº’è”ç½‘ä¸Šæ”¶é›†æµ·é‡å›¾åƒ - æ–‡æœ¬å¯¹ä½œä¸ºæ ·æœ¬è¿›è¡Œé¢„è®­ç»ƒï¼Œè¿™äº›å¸¦å™ªå£°çš„æ–‡æœ¬ä½œä¸ºè§†è§‰è¯­è¨€å­¦ä¹ çš„ç›‘ç£ä¿¡å·æ˜¾ç„¶ä¸æ˜¯æœ€ä¼˜è§£ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒä¸ºæ­¤ï¼Œ &lt;code&gt;Salesforce&lt;/code&gt;  çš„ç ”ç©¶è€…ä»¬æå‡ºäº† &lt;code&gt;BLIP (Bootstrapping language - image Pre-training)&lt;/code&gt; ï¼Œç”¨äºç»Ÿä¸€çš„è§†è§‰è¯­è¨€ç†è§£å’Œç”Ÿæˆã€‚ &lt;code&gt;BLIP&lt;/code&gt;  æ˜¯ä¸€ç§æ–°çš„ &lt;code&gt;VLP&lt;/code&gt;  æ¡†æ¶ï¼Œæ¯”ç°æœ‰æ–¹æ³•èƒ½å¤Ÿå®ç°æ›´å¹¿æ³›çš„ä¸‹æ¸¸ä»»åŠ¡ã€‚å®ƒåˆ†åˆ«ä»æ¨¡å‹å’Œæ•°æ®çš„è§’åº¦ä»‹ç»äº†ä¸¤ä¸ªè´¡çŒ®:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç¼–ç å™¨ - è§£ç å™¨çš„å¤šæ¨¡æ€æ··åˆ&lt;/strong&gt; ( &lt;code&gt;MED, Multimodal mixture of Encoder-Decoder&lt;/code&gt; ): ä¸€ç§æœ‰æ•ˆçš„å¤šä»»åŠ¡é¢„è®­ç»ƒå’Œçµæ´»è¿ç§»å­¦ä¹ çš„æ–°æ¨¡å‹æ¶æ„ã€‚ &lt;code&gt;MED&lt;/code&gt;  å¯ä»¥ä½œä¸ºå•æ¨¡ç¼–ç å™¨ã€åŸºäºå›¾åƒçš„æ–‡æœ¬ç¼–ç å™¨æˆ–åŸºäºå›¾åƒçš„æ–‡æœ¬è§£ç å™¨æ“ä½œã€‚è¯¥æ¨¡å‹é‡‡ç”¨å›¾åƒæ–‡æœ¬å¯¹æ¯”å­¦ä¹ ã€å›¾åƒæ–‡æœ¬åŒ¹é…å’Œå›¾åƒæ¡ä»¶åŒ–è¯­è¨€å»ºæ¨¡ä¸‰ä¸ªè§†è§‰è¯­è¨€ç›®æ ‡è¿›è¡Œè”åˆé¢„è®­ç»ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å­—å¹•å’Œè¿‡æ»¤&lt;/strong&gt; ( &lt;code&gt;CapFilt, Captioning and Filtering&lt;/code&gt; ): ä¸€ç§æ–°çš„æ•°æ®é›† &lt;code&gt;bootstrap&lt;/code&gt;  æ–¹æ³•ï¼Œç”¨äºä»å™ªå£°å›¾åƒ - æ–‡æœ¬å¯¹ä¸­å­¦ä¹ ã€‚ &lt;code&gt;BLIP&lt;/code&gt;  å°†é¢„è®­ç»ƒçš„ &lt;code&gt;MED&lt;/code&gt;  è°ƒæ•´ä¸ºä¸¤ä¸ªæ¨¡å—ï¼šä¸€ä¸ª &lt;code&gt;captioner&lt;/code&gt;  ç”¨äºç”Ÿæˆç»™å®š web å›¾åƒçš„åˆæˆå­—å¹•ï¼Œä¸€ä¸ª &lt;code&gt;filter&lt;/code&gt;  ç”¨äºä»åŸå§‹ &lt;code&gt;web&lt;/code&gt;  æ–‡æœ¬å’Œåˆæˆæ–‡æœ¬ä¸­å»é™¤å˜ˆæ‚çš„å­—å¹•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;äºŒ-ç›¸å…³å·¥ä½œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äºŒ-ç›¸å…³å·¥ä½œ&#34;&gt;#&lt;/a&gt; äºŒã€ç›¸å…³å·¥ä½œ&lt;/h1&gt;
&lt;h2 id=&#34;21-è§†è§‰è¯­è¨€é¢„è®­ç»ƒ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#21-è§†è§‰è¯­è¨€é¢„è®­ç»ƒ&#34;&gt;#&lt;/a&gt; 2.1 è§†è§‰è¯­è¨€é¢„è®­ç»ƒ&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒè§†è§‰è¯­è¨€é¢„è®­ç»ƒ ( &lt;code&gt;VLP&lt;/code&gt; ) æ—¨åœ¨é€šè¿‡å¯¹å¤§è§„æ¨¡å›¾åƒ - æ–‡æœ¬å¯¹æ¨¡å‹è¿›è¡Œé¢„è®­ç»ƒæ¥æé«˜ä¸‹æ¸¸è§†è§‰å’Œè¯­è¨€ä»»åŠ¡çš„æ€§èƒ½ã€‚ç”±äºè·å–äººå·¥æ³¨é‡Šæ–‡æœ¬çš„è´¹ç”¨è¿‡é«˜ï¼Œå¤§å¤šæ•°æ–¹æ³•ä½¿ç”¨ä»ç½‘ç»œæŠ“å–çš„å›¾åƒå’Œæ›¿ä»£æ–‡æœ¬å¯¹ã€‚å°½ç®¡ä½¿ç”¨äº†ç®€å•çš„åŸºäºè§„åˆ™çš„è¿‡æ»¤å™¨ï¼Œå™ªå£°åœ¨ç½‘ç»œæ–‡æœ¬ä¸­ä»ç„¶æ™®éå­˜åœ¨ã€‚ç„¶è€Œï¼Œå™ªå£°çš„è´Ÿé¢å½±å“åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šè¢«å¿½ç•¥äº†ï¼Œè¢«é€šè¿‡æ‰©å¤§æ•°æ®é›†è·å¾—çš„æ€§èƒ½å¢ç›Šæ‰€æ©ç›–ã€‚ &lt;code&gt;BLIP&lt;/code&gt;  çš„è®ºæ–‡è¡¨æ˜ï¼Œå™ªå£°ç½‘ç»œæ–‡æœ¬å¯¹äºè§†è§‰è¯­è¨€å­¦ä¹ æ˜¯æ¬¡ä¼˜çš„ï¼Œå¹¶æå‡º &lt;code&gt;CapFilt&lt;/code&gt;  ä»¥æ›´æœ‰æ•ˆçš„æ–¹å¼åˆ©ç”¨ç½‘ç»œæ•°æ®é›†çš„ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå·²ç»æœ‰å¾ˆå¤šå°è¯•å°†å„ç§è§†è§‰å’Œè¯­è¨€ä»»åŠ¡ç»Ÿä¸€åˆ°ä¸€ä¸ªæ¡†æ¶ä¸­ã€‚æœ€å¤§çš„æŒ‘æˆ˜æ˜¯è®¾è®¡æ—¢èƒ½æ‰§è¡ŒåŸºäºç†è§£çš„ä»»åŠ¡ (å¦‚å›¾åƒæ–‡æœ¬æ£€ç´¢) åˆèƒ½æ‰§è¡ŒåŸºäºç”Ÿæˆçš„ä»»åŠ¡ (å¦‚å›¾åƒå­—å¹•) çš„æ¨¡å‹æ¶æ„ã€‚ä¸¤è€…éƒ½ä¸æ˜¯åŸºäºç¼–ç å™¨çš„æ¨¡å‹å’Œç¼–ç å™¨ - è§£ç å™¨æ¨¡å‹å¯ä»¥åœ¨è¿™ä¸¤ç§ç±»å‹çš„ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ï¼Œè€Œå•ä¸€çš„ç»Ÿä¸€ç¼–ç å™¨ - è§£ç å™¨ä¹Ÿé™åˆ¶äº†æ¨¡å‹çš„èƒ½åŠ›ã€‚ &lt;code&gt;BLIP&lt;/code&gt;  æå‡ºçš„å¤šæ¨¡æ€ç¼–ç å™¨ - è§£ç å™¨æ··åˆæ¨¡å‹åœ¨å¹¿æ³›çš„ä¸‹æ¸¸ä»»åŠ¡ä¸Šæä¾›äº†æ›´å¤§çš„çµæ´»æ€§å’Œæ›´å¥½çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¿æŒäº†é¢„è®­ç»ƒçš„ç®€å•å’Œé«˜æ•ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;22-çŸ¥è¯†è’¸é¦&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#22-çŸ¥è¯†è’¸é¦&#34;&gt;#&lt;/a&gt; 2.2 çŸ¥è¯†è’¸é¦&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒçŸ¥è¯†è’¸é¦ï¼ˆ &lt;code&gt;KD, Knowledge Distillation&lt;/code&gt; ï¼‰æ—¨åœ¨é€šè¿‡ä»æ•™å¸ˆæ¨¡å‹ä¸­æå–çŸ¥è¯†æ¥æé«˜å­¦ç”Ÿæ¨¡å‹çš„æ€§èƒ½ã€‚è‡ªæˆ‘è’¸é¦æ˜¯ &lt;code&gt;KD&lt;/code&gt;  çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå…¶ä¸­æ•™å¸ˆå’Œå­¦ç”Ÿçš„è§„æ¨¡ç›¸ç­‰ã€‚å·²ç»è¯æ˜åªæ˜¯è’¸é¦å¯¹äºå›¾åƒåˆ†ç±»ï¼Œä»¥åŠ &lt;code&gt;VLP&lt;/code&gt;  æ˜¯æœ‰æ•ˆçš„ã€‚ä¸å¤§å¤šæ•°ç°æœ‰çš„ &lt;code&gt;KD&lt;/code&gt;  æ–¹æ³•åªæ˜¯ç®€å•åœ°å¼ºåˆ¶å­¦ç”Ÿå…·æœ‰ä¸æ•™å¸ˆç›¸åŒçš„ç±»é¢„æµ‹ä¸åŒï¼Œ &lt;code&gt;BLIP&lt;/code&gt;  æå‡ºçš„ &lt;code&gt;CapFilt&lt;/code&gt;  å¯ä»¥è¢«è§£é‡Šä¸ºåœ¨ &lt;code&gt;VLP&lt;/code&gt;  ç¯å¢ƒä¸‹æ‰§è¡Œ &lt;code&gt;KD&lt;/code&gt;  çš„ä¸€ç§æ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå…¶ä¸­å­—å¹•å™¨é€šè¿‡è¯­ä¹‰ä¸°å¯Œçš„åˆæˆå­—å¹•æå–å…¶çŸ¥è¯†ï¼Œè€Œè¿‡æ»¤å™¨é€šè¿‡å»é™¤å™ªå£°å­—å¹•æå–å…¶çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;23-æ•°æ®å¢å¼º&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#23-æ•°æ®å¢å¼º&#34;&gt;#&lt;/a&gt; 2.3 æ•°æ®å¢å¼º&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒè™½ç„¶æ•°æ®å¢å¼ºï¼ˆ &lt;code&gt;DA, Data Augmentation&lt;/code&gt; ï¼‰å·²è¢«å¹¿æ³›åº”ç”¨äºè®¡ç®—æœºè§†è§‰ï¼Œä½†ç”¨äºè¯­è¨€ä»»åŠ¡çš„ &lt;code&gt;DA&lt;/code&gt;  å¹¶ä¸é‚£ä¹ˆç›´æ¥ã€‚è¿‘å¹´æ¥ï¼Œç”Ÿæˆè¯­è¨€æ¨¡å‹å·²è¢«ç”¨äºåˆæˆå„ç§ &lt;code&gt;NLP&lt;/code&gt;  ä»»åŠ¡çš„ç¤ºä¾‹ã€‚ä¸åŒäºè¿™äº›æ–¹æ³•åªå…³æ³¨ä½èµ„æºçš„è¯­è¨€ä»»åŠ¡ï¼Œ &lt;code&gt;BLIP&lt;/code&gt;  çš„æ–¹æ³•å±•ç¤ºäº†åˆæˆå­—å¹•åœ¨å¤§è§„æ¨¡è§†è§‰è¯­è¨€é¢„è®­ç»ƒä¸­çš„ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸‰-æ–¹æ³•&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸‰-æ–¹æ³•&#34;&gt;#&lt;/a&gt; ä¸‰ã€æ–¹æ³•&lt;/h1&gt;
&lt;h2 id=&#34;31-æ¨¡å‹æ¶æ„&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#31-æ¨¡å‹æ¶æ„&#34;&gt;#&lt;/a&gt; 3.1 æ¨¡å‹æ¶æ„&lt;/h2&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/BLIP/3.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;BLIP&lt;/code&gt;  é‡‡ç”¨äº†ç¼–ç å™¨ - è§£ç å™¨çš„å¤šæ¨¡æ€æ··åˆç»“æ„ ( &lt;code&gt;MED&lt;/code&gt; )ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªå•æ¨¡æ€ç¼–ç å™¨ã€ä¸€ä¸ªä»¥å›¾åƒä¸ºåŸºç¡€çš„æ–‡æœ¬ç¼–ç å™¨å’Œä¸€ä¸ªä»¥å›¾åƒä¸ºåŸºç¡€çš„æ–‡æœ¬è§£ç å™¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•æ¨¡æ€ç¼–ç å™¨&lt;/strong&gt;  &lt;code&gt;lmage Encoder&lt;/code&gt; ï¼šåŸºäº &lt;code&gt;transformer&lt;/code&gt;  çš„ &lt;code&gt;ViT&lt;/code&gt;  çš„æ¶æ„ï¼Œå°†è¾“å…¥å›¾åƒåˆ†å‰²ä¸ºå¤šä¸ªçš„ &lt;code&gt;patch&lt;/code&gt;  å¹¶å°†å®ƒä»¬ç¼–ç ä¸ºä¸€ç³»åˆ— &lt;code&gt;Image Embedding&lt;/code&gt; ï¼Œå¹¶ä½¿ç”¨ [CLS] token æ¥è¡¨ç¤ºå…¨å±€çš„å›¾åƒç‰¹å¾ã€‚ &lt;code&gt;lmage Encoder&lt;/code&gt;  ç”¨æ¥æå–å›¾åƒç‰¹å¾åšå¯¹æ¯”å­¦ä¹ ï¼Œç›¸å½“äº &lt;code&gt;CLIP&lt;/code&gt;  ä¸­çš„  &lt;code&gt;Image Encoder&lt;/code&gt; ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å•æ¨¡æ€ç¼–ç å™¨&lt;/strong&gt;  &lt;code&gt;Text Encoder&lt;/code&gt; ï¼šåŸºäº &lt;code&gt;BERT&lt;/code&gt;  çš„æ¶æ„ï¼Œå°† [CLS] token åŠ åˆ°è¾“å…¥æ–‡æœ¬çš„å¼€å¤´ä»¥æ€»ç»“å¥å­ã€‚ &lt;code&gt;Text Encoder&lt;/code&gt;  ç”¨æ¥æå–æ–‡æœ¬ç‰¹å¾åšå¯¹æ¯”å­¦ä¹ ï¼Œç›¸å½“äº &lt;code&gt;CLIP&lt;/code&gt;  ä¸­çš„ &lt;code&gt;Text Encoder&lt;/code&gt; ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»¥å›¾åƒä¸ºåŸºç¡€çš„ç¼–ç å™¨&lt;/strong&gt;  &lt;code&gt;Image-grounded text encoder&lt;/code&gt; ï¼šå¯¹ &lt;code&gt;Text Encoder&lt;/code&gt;  çš„æ¯ä¸€ä¸ª &lt;code&gt;transformer&lt;/code&gt;  å—ï¼Œåœ¨ è‡ªæ³¨æ„åŠ› ( &lt;code&gt;self-attention, SA&lt;/code&gt; ) å±‚å’Œå‰é¦ˆç½‘ç»œä¹‹é—´æ·»åŠ ä¸€ä¸ªäº¤å‰æ³¨æ„ ( &lt;code&gt;cross-attention, CA&lt;/code&gt; ) å±‚ç”¨æ¥æ³¨å…¥è§†è§‰ä¿¡æ¯ï¼Œè¿˜å°† [Encode] token åŠ åˆ°è¾“å…¥æ–‡æœ¬çš„å¼€å¤´ä»¥æ ‡è¯†ç‰¹å®šä»»åŠ¡ã€‚ &lt;code&gt;Image-grounded text encoder&lt;/code&gt;  ç”¨æ¥æå–æ–‡æœ¬ç‰¹å¾å¹¶å°†å…¶å’Œå›¾åƒç‰¹å¾å¯¹é½ï¼Œç›¸å½“äº &lt;code&gt;CLIP&lt;/code&gt;  ä¸­æ›´ç²¾ç»†åŒ–çš„ &lt;code&gt;Text-Image&lt;/code&gt;  å¯¹é½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä»¥å›¾åƒä¸ºåŸºç¡€çš„è§£ç å™¨&lt;/strong&gt;  &lt;code&gt;Image-grounded text decoder&lt;/code&gt; ï¼šå°† &lt;code&gt;Image-grounded text encoder&lt;/code&gt;  çš„ &lt;code&gt;self-attention&lt;/code&gt;  å±‚æ¢æˆ &lt;code&gt;causal self-attention&lt;/code&gt;  å±‚ï¼Œè¿˜å°† [Decode] token å’Œ [EOS] token åŠ åˆ°è¾“å…¥æ–‡æœ¬çš„å¼€å¤´å’Œç»“å°¾ä»¥æ ‡è¯†åºåˆ—çš„å¼€å§‹å’Œç»“æŸã€‚ &lt;code&gt;Image-grounded text decoder&lt;/code&gt;  ç”¨æ¥ç”Ÿæˆç¬¦åˆå›¾åƒå’Œæ–‡æœ¬ç‰¹å¾çš„æ–‡æœ¬æè¿°ï¼Œè¿™æ˜¯ &lt;code&gt;CLIP&lt;/code&gt;  ä¸­æ‰€æ²¡æœ‰çš„ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;note primary no-icon&#34;&gt;
&lt;p&gt;â€ƒâ€ƒæ³¨æ„ï¼Œ &lt;code&gt;Image-grounded text decoder&lt;/code&gt;  ç”Ÿæˆçš„æ–‡æœ¬æè¿°ä¸åŒäºè¾“å…¥çš„å›¾åƒ - æ–‡æœ¬å¯¹ä¸­çš„æ–‡æœ¬ï¼Œå›¾åƒ - æ–‡æœ¬å¯¹ä¸­çš„æ–‡æœ¬æ˜¯äº’è”ç½‘ä¸Šæ‰¾åˆ°çš„å›¾ç‰‡çš„ä¸Šä¸‹æ–‡ï¼Œæ‹¥æœ‰å¤§é‡çš„å™ªéŸ³ï¼›è€Œ &lt;code&gt;Image-grounded text decoder&lt;/code&gt;  ç”Ÿæˆçš„æ–‡æœ¬æè¿°æ˜¯é’ˆå¯¹å›¾åƒç‰¹å¾å’Œæ–‡æœ¬ç‰¹å¾çš„ç‰¹å®šæè¿°ï¼Œæ›´åŠ ç²¾ç‚¼ã€‚è¿™é‡Œå…¶å®å°±å·²ç»æ˜¯ &lt;code&gt;Captioner&lt;/code&gt;  çš„é›å½¢äº†ï¼Œä¸‹æ–‡çš„ &lt;code&gt;Captioner&lt;/code&gt;  ä¹Ÿæ˜¯åŸºäºè®­ç»ƒå®Œæˆçš„ &lt;code&gt;Image-grounded text decoder&lt;/code&gt;  å†è¿›è¡Œçš„ä¼˜åŒ–å’Œå¾®è°ƒã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&#34;32-é¢„è®­ç»ƒç›®æ ‡&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#32-é¢„è®­ç»ƒç›®æ ‡&#34;&gt;#&lt;/a&gt; 3.2 é¢„è®­ç»ƒç›®æ ‡&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;BLIP&lt;/code&gt;  åœ¨é¢„è®­ç»ƒæœŸé—´è”åˆä¼˜åŒ–ä¸‰ä¸ªç›®æ ‡ï¼Œå…¶ä¸­ä¸¤ä¸ªåŸºäºç†è§£çš„ç›®æ ‡å’Œä¸€ä¸ªåŸºäºç”Ÿæˆçš„ç›®æ ‡ã€‚æ¯ä¸ªå›¾åƒ - æ–‡æœ¬å¯¹ä»…éœ€è¦é€šè¿‡è®¡ç®—é‡è¾ƒå¤§çš„è§†è§‰ &lt;code&gt;Transformer&lt;/code&gt;  çš„ä¸€æ¬¡æ­£å‘ä¼ é€’ï¼Œä»¥åŠé€šè¿‡æ–‡æœ¬ &lt;code&gt;Transformer&lt;/code&gt;  çš„ä¸‰æ¬¡æ­£å‘ä¼ é€’ï¼Œå…¶ä¸­ä¸åŒçš„åŠŸèƒ½è¢«æ¿€æ´»ä»¥è®¡ç®—å¦‚ä¸‹æ‰€è¿°çš„ä¸‰ä¸ªæŸå¤±ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å›¾æ–‡å¯¹æ¯”æŸå¤±&lt;/strong&gt; ( &lt;code&gt;Image-Text Contrastive Loss, ITC&lt;/code&gt; )ï¼š &lt;code&gt;ITC&lt;/code&gt;  ç”¨äºè®­ç»ƒ &lt;code&gt;lmage Encoder&lt;/code&gt;  å’Œ &lt;code&gt;Text Encoder&lt;/code&gt; ï¼Œé€šè¿‡å¯¹æ¯”å­¦ä¹ å¯¹é½å›¾åƒå’Œæ–‡æœ¬çš„ç‰¹å¾ç©ºé—´ã€‚å…·ä½“æ–¹æ³•æ˜¯æœ€å¤§åŒ–æ­£æ ·æœ¬å›¾åƒ - æ–‡æœ¬å¯¹çš„ç›¸ä¼¼åº¦ä¸”æœ€å°åŒ–è´Ÿæ ·æœ¬å›¾åƒ - æ–‡æœ¬å¯¹çš„ç›¸ä¼¼åº¦ã€‚ &lt;code&gt;BLIP&lt;/code&gt;  è¿˜ä½¿ç”¨äº† &lt;code&gt;ALBEF&lt;/code&gt;  ä¸­çš„åŠ¨é‡ç¼–ç å™¨æ¥ç”Ÿæˆç‰¹å¾ï¼Œå¹¶ä»åŠ¨é‡ç¼–ç å™¨åˆ›å»ºè½¯æ ‡ç­¾ä½œä¸ºè®­ç»ƒç›®æ ‡ï¼Œä»¥è§£é‡Šè´Ÿæ ·æœ¬å¯¹ä¸­çš„æ½œåœ¨æ­£æ ·æœ¬ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å›¾æ–‡åŒ¹é…æŸå¤±&lt;/strong&gt; ( &lt;code&gt;Image-Text Matching Loss, ITM&lt;/code&gt; )ï¼š &lt;code&gt;ITM&lt;/code&gt;  ç”¨äºè®­ç»ƒ &lt;code&gt;Image-grounded text encoder&lt;/code&gt; ï¼Œé€šè¿‡å­¦ä¹ å›¾åƒ - æ–‡æœ¬å¯¹çš„è”åˆè¡¨å¾å®ç°è§†è§‰å’Œè¯­è¨€ä¹‹é—´çš„ç»†ç²’åº¦å¯¹é½ã€‚å…·ä½“æ–¹æ³•æ˜¯é€šè¿‡ä¸€ä¸ªäºŒåˆ†ç±»ä»»åŠ¡ï¼Œé¢„æµ‹å›¾åƒæ–‡æœ¬å¯¹æ˜¯æ­£æ ·æœ¬è¿˜æ˜¯è´Ÿæ ·æœ¬ã€‚è¿™é‡Œè¿˜ä½¿ç”¨äº† &lt;code&gt;ALBEF&lt;/code&gt;  ä¸­çš„ &lt;code&gt;hard negative mining&lt;/code&gt;  æŠ€æœ¯ä»¥æ›´å¥½åœ°æ•æ‰è´Ÿæ ·æœ¬ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;note primary no-icon&#34;&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;ITM&lt;/code&gt;  ä¸ &lt;code&gt;ITC&lt;/code&gt;  å¹¶ä¸ä¸€æ ·ï¼Œ &lt;code&gt;ITC&lt;/code&gt;  è™½ç„¶ä¹Ÿå¯¹é½äº†å›¾åƒå’Œæ–‡æœ¬çš„ç‰¹å¾ç©ºé—´ï¼Œä½†å¹¶æ²¡æœ‰æ˜¾å¼åœ°åŒºåˆ†æ­£è´Ÿæ ·æœ¬ï¼Œä¸»è¦æ˜¯ç”¨äºè¯„ä»·å›¾åƒå’Œæ–‡æœ¬çš„åŒ¹é…æƒ…å†µï¼Œç»™å‡ºä»»æ„è¾“å…¥å›¾åƒ - æ–‡æœ¬å¯¹çš„ç›¸ä¼¼åº¦ã€‚è€Œ &lt;code&gt;ITM&lt;/code&gt;  åˆ™æ˜¯é€šè¿‡è®¡ç®—æ ·æœ¬çš„æŸå¤±è¾¾åˆ°åŒºåˆ†æ­£è´Ÿæ ·æœ¬çš„ç›®çš„ï¼Œæ¿€åŠ±æ­£æ ·æœ¬çš„å›¾åƒå’Œæ–‡æœ¬ä½¿å…¶æ›´åŠ åŒ¹é…ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯­è¨€å»ºæ¨¡æŸå¤±&lt;/strong&gt; ( &lt;code&gt;Language Modeling Loss, LM&lt;/code&gt; )ï¼š &lt;code&gt;LM&lt;/code&gt;  ç”¨äºè®­ç»ƒ &lt;code&gt;Image-grounded text decoder&lt;/code&gt; ï¼Œå®ç°ç”Ÿæˆå›¾åƒçš„æ–‡æœ¬æè¿°ä»»åŠ¡ã€‚å…·ä½“æ–¹æ³•æ˜¯é€šè¿‡ä¼˜åŒ–äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œè®­ç»ƒæ¨¡å‹ä»¥è‡ªå›å½’çš„æ–¹å¼æœ€å¤§åŒ–æ–‡æœ¬çš„æ¦‚ç‡ã€‚åœ¨è®¡ç®—æŸå¤±æ—¶ï¼Œ &lt;code&gt;BLIP&lt;/code&gt;  åº”ç”¨ 0.1 çš„æ ‡ç­¾å¹³æ»‘ã€‚ä¸ &lt;code&gt;VLP&lt;/code&gt;  ä¸­å¹¿æ³›ä½¿ç”¨çš„ &lt;code&gt;MLM&lt;/code&gt;  æŸå¤±ç›¸æ¯”ï¼Œ &lt;code&gt;LM&lt;/code&gt;  ä½¿è¯¥æ¨¡å‹å…·æœ‰æ³›åŒ–èƒ½åŠ›ï¼Œèƒ½å¤Ÿå°†è§†è§‰ä¿¡æ¯è½¬æ¢ä¸ºè¿è´¯çš„å­—å¹•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;note primary no-icon&#34;&gt;
&lt;p&gt;â€ƒâ€ƒä¸ºäº†åœ¨åˆ©ç”¨å¤šä»»åŠ¡å­¦ä¹ çš„åŒæ—¶æ‰§è¡Œæœ‰æ•ˆçš„é¢„è®­ç»ƒï¼Œæ–‡æœ¬ç¼–ç å™¨å’Œæ–‡æœ¬è§£ç å™¨å…±äº«é™¤äº† &lt;code&gt;SA&lt;/code&gt;  å±‚ä¹‹å¤–çš„æ‰€æœ‰å‚æ•°ã€‚åŸå› æ˜¯ç¼–ç å’Œè§£ç ä»»åŠ¡ä¹‹é—´çš„å·®å¼‚æœ€å¥½ç”± &lt;code&gt;SA&lt;/code&gt;  å±‚æ¥æ•è·ã€‚å…·ä½“åœ°ï¼Œç¼–ç å™¨é‡‡ç”¨åŒå‘è‡ªæ³¨æ„æ¥æ„å»ºå½“å‰è¾“å…¥æ ‡è®°çš„è¡¨ç¤ºï¼Œè€Œè§£ç å™¨é‡‡ç”¨å› æœè‡ªæ³¨æ„æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨ç¼–ç å’Œè§£ç ä»»åŠ¡ä¹‹é—´ï¼ŒåµŒå…¥å±‚ã€ &lt;code&gt;CA&lt;/code&gt;  å±‚å’Œ &lt;code&gt;FFN&lt;/code&gt;  çš„åŠŸèƒ½ç±»ä¼¼ï¼Œå› æ­¤å…±äº«è¿™äº›å±‚å¯ä»¥æé«˜è®­ç»ƒæ•ˆç‡ï¼ŒåŒæ—¶å—ç›Šäºå¤šä»»åŠ¡å­¦ä¹ ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&#34;33-capfiltæœºåˆ¶&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#33-capfiltæœºåˆ¶&#34;&gt;#&lt;/a&gt; 3.3 CapFilt æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;COCO&lt;/code&gt;  æ•°æ®é›†çš„é«˜è´¨é‡äººå·¥æ³¨é‡Šå›¾åƒ - æ–‡æœ¬å¯¹&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo stretchy=&#34;false&#34;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&#34;false&#34;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;{(I_h,T_h)}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.07847em;&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.33610799999999996em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathnormal mtight&#34;&gt;h&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.33610799999999996em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathnormal mtight&#34;&gt;h&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; æ•°é‡æœ‰é™ï¼Œå› æ­¤ &lt;code&gt;CLIP&lt;/code&gt; ã€ &lt;code&gt;BLIP&lt;/code&gt;  ç­‰ &lt;code&gt;VLP&lt;/code&gt;  éƒ½æ˜¯ä»ç½‘ç»œä¸­æ”¶é›†å¤§é‡å›¾åƒ - æ–‡æœ¬å¯¹&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mo stretchy=&#34;false&#34;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&#34;false&#34;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;{(I_w,T_w)}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:1em;vertical-align:-0.25em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mopen&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.07847em;&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.151392em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathnormal mtight&#34; style=&#34;margin-right:0.02691em;&#34;&gt;w&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.151392em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathnormal mtight&#34; style=&#34;margin-right:0.02691em;&#34;&gt;w&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mclose&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ä½œä¸ºè®­ç»ƒé›†ã€‚ä½†è¿™äº›ç½‘ç»œå›¾åƒ - æ–‡æœ¬å¯¹çš„æ–‡æœ¬æ¥è‡ªå›¾åƒä¸Šä¸‹æ–‡ï¼Œéš¾ä»¥ç²¾å‡†åœ°æè¿°å›¾åƒå†…å®¹ï¼Œå­˜åœ¨å¤§é‡å™ªå£°ã€‚äºæ˜¯ï¼Œ &lt;code&gt;BLIP&lt;/code&gt;  æå‡ºäº†å­—å¹•å’Œè¿‡æ»¤ ( &lt;code&gt;Captioning and Filtering, CapFilt&lt;/code&gt; ) æœºåˆ¶ï¼Œä¸‹å›¾ç»™å‡ºäº† &lt;code&gt;CapFilt&lt;/code&gt;  çš„è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/BLIP/3.2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä¸Šå›¾ç»™å‡ºäº† &lt;code&gt;CapFilt&lt;/code&gt;  çš„å›¾ç¤ºï¼ŒåŒ…å«å­—å¹•å™¨å’Œè¿‡æ»¤å™¨ä¸¤ä¸ªæ¨¡å—ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­—å¹•å™¨&lt;/strong&gt;  &lt;code&gt;Captioner&lt;/code&gt; ï¼šä¸€ä¸ªè§†è§‰æ–‡æœ¬è§£ç å™¨ï¼ŒåŸºäº &lt;code&gt;Image-grounded text decoder&lt;/code&gt; ï¼Œç”¨äºç”Ÿæˆç»™å®šå›¾åƒçš„å­—å¹•ï¼Œä½¿ç”¨ &lt;code&gt;LM&lt;/code&gt;  æŸå¤±å‡½æ•°åœ¨ &lt;code&gt;COCO&lt;/code&gt;  æ•°æ®é›†ä¸Šè¿›è¡Œå¾®è°ƒã€‚ç»™å®šç½‘ç»œå›¾ç‰‡&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;I_w&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.07847em;&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.151392em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathnormal mtight&#34; style=&#34;margin-right:0.02691em;&#34;&gt;w&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;ï¼ŒCaptioner ç”Ÿæˆå­—å¹•&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T_w&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.151392em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathnormal mtight&#34; style=&#34;margin-right:0.02691em;&#34;&gt;w&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;ã€‚&lt;br&gt;
â€‹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æ»¤å™¨&lt;/strong&gt;  &lt;code&gt;Filter&lt;/code&gt; ï¼šä¸€ä¸ªè§†è§‰æ–‡æœ¬ç¼–ç å™¨ï¼ŒåŸºäº &lt;code&gt;Image-grounded text encoder&lt;/code&gt; ï¼Œç”¨äºå»é™¤æ–‡æœ¬å™ªå£°ï¼Œä½¿ç”¨ &lt;code&gt;ITC&lt;/code&gt;  å’Œ &lt;code&gt;ITM&lt;/code&gt;  æŸå¤±å‡½æ•°åœ¨ &lt;code&gt;COCO&lt;/code&gt;  æ•°æ®é›†ä¸Šè¿›è¡Œå¾®è°ƒã€‚ &lt;code&gt;Filter&lt;/code&gt;  é€šè¿‡æ¯”å¯¹æ–‡æœ¬å’Œå›¾åƒçš„åŒ¹é…æƒ…å†µï¼Œåˆ é™¤åŸå§‹ &lt;code&gt;Web&lt;/code&gt;  æ–‡æœ¬&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T_w&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.151392em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathnormal mtight&#34; style=&#34;margin-right:0.02691em;&#34;&gt;w&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; å’Œåˆæˆæ–‡æœ¬&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;T_s&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.83333em;vertical-align:-0.15em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.151392em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mathnormal mtight&#34;&gt;s&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ä¸­çš„å™ªå£°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;note primary no-icon&#34;&gt;
&lt;p&gt;&lt;code&gt;Captioner&lt;/code&gt;  å’Œ &lt;code&gt;Filter&lt;/code&gt;  éƒ½æ˜¯åœ¨é¢„è®­ç»ƒå®Œæˆåçš„ &lt;code&gt;MED&lt;/code&gt;  æ¨¡å‹ä¸Šåˆå§‹åŒ–çš„ï¼Œå¹¶å„è‡ªåœ¨äººå·¥æ³¨é‡Šçš„å›¾åƒ - æ–‡æœ¬å¯¹æ•°æ®é›† &lt;code&gt;COCO&lt;/code&gt;  ä¸Šè¿›è¡Œå¾®è°ƒ ( &lt;code&gt;finetune&lt;/code&gt; )ã€‚æœ€åï¼Œå°†è¿‡æ»¤åçš„å›¾åƒ - æ–‡æœ¬å¯¹ä¸äººå·¥æ³¨é‡Šå¯¹ç›¸ç»“åˆï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼ˆè¿™ä¹Ÿæ˜¯ &lt;code&gt;Bootstrapping&lt;/code&gt;  çš„ç”±æ¥ï¼‰ï¼Œæœ€åå†ç”¨å®ƒæ¥è®­ç»ƒä¸€éæ¨¡å‹ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&#34;34-æ•´ä½“æ€è·¯æ•´ç†&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#34-æ•´ä½“æ€è·¯æ•´ç†&#34;&gt;#&lt;/a&gt; 3.4 æ•´ä½“æ€è·¯æ•´ç†&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å…ˆä½¿ç”¨å«æœ‰å™ªå£°çš„ç½‘ç»œæ•°æ®è®­ç»ƒä¸€é &lt;code&gt;BLIP&lt;/code&gt; ï¼›&lt;/li&gt;
&lt;li&gt;å†åœ¨ &lt;code&gt;COCO&lt;/code&gt;  æ•°æ®é›†ä¸Šè¿›è¡Œå¾®è°ƒä»¥è®­ç»ƒ &lt;code&gt;Captioner&lt;/code&gt;  å’Œ &lt;code&gt;Filter&lt;/code&gt; ï¼›&lt;/li&gt;
&lt;li&gt;ç„¶åä½¿ç”¨ &lt;code&gt;Filter&lt;/code&gt;  ä»åŸå§‹ç½‘ç»œæ–‡æœ¬å’Œ &lt;code&gt;Captioner&lt;/code&gt;  åˆæˆçš„æ–‡æœ¬ä¸­åˆ é™¤å˜ˆæ‚çš„å­—å¹•ï¼Œå¾—åˆ°å¹²å‡€çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;æœ€åå†ä½¿ç”¨å¹²å‡€çš„æ•°æ®è®­ç»ƒä¸€éå¾—åˆ°é«˜æ€§èƒ½çš„ &lt;code&gt;BLIP&lt;/code&gt; ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;å››-å‚è€ƒç¨‹åº&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å››-å‚è€ƒç¨‹åº&#34;&gt;#&lt;/a&gt; å››ã€å‚è€ƒç¨‹åº&lt;/h1&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9TYWxlc2ZvcmNlL2JsaXAtaW1hZ2UtY2FwdGlvbmluZy1sYXJnZQ==&#34;&gt;https://huggingface.co/Salesforce/blip-image-captioning-large&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;from&lt;/span&gt; PIL &lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; Image&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;from&lt;/span&gt; transformers &lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; BlipProcessor&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; BlipForConditionalGeneration&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;processor &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; BlipProcessor&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;from_pretrained&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;E:/python/else/LLM_learn/5_BLIP/model&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; BlipForConditionalGeneration&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;from_pretrained&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;E:/python/else/LLM_learn/5_BLIP/model&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;cuda&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;raw_image &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; Image&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;1.jpg&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;convert&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;RGB&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# conditional image captioning&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;text &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;a photography of&#34;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;inputs &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; processor&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;raw_image&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; text&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; return_tensors&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;pt&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;cuda&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;out &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;generate&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;**&lt;/span&gt;inputs&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;processor&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;decode&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;out&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; skip_special_tokens&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# unconditional image captioning&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;inputs &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; processor&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;raw_image&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; return_tensors&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;pt&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;cuda&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;out &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;generate&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;**&lt;/span&gt;inputs&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;processor&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;decode&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;out&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; skip_special_tokens&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://qianqiu-cell.github.io/2024/09/12/AI/CLIP/</guid>
            <title>CLIP</title>
            <link>http://qianqiu-cell.github.io/2024/09/12/AI/CLIP/</link>
            <category>AI</category>
            <pubDate>Thu, 12 Sep 2024 00:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;ä¸€-ç®€ä»‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸€-ç®€ä»‹&#34;&gt;#&lt;/a&gt; ä¸€ã€ç®€ä»‹&lt;/h1&gt;
&lt;h2 id=&#34;11-å‰è¨€&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#11-å‰è¨€&#34;&gt;#&lt;/a&gt; 1.1 å‰è¨€&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;CLIP&lt;/code&gt;  æ˜¯ &lt;code&gt;OpenAI&lt;/code&gt;  åœ¨ &lt;code&gt;2021&lt;/code&gt;  å¹´ &lt;code&gt;2&lt;/code&gt;  æœˆå‘è¡¨çš„ä¸€ç¯‡æ–‡ç« ï¼Œå…¶å…¨ç§°ä¸º &lt;code&gt;Contrastive Language-Image Pre-training&lt;/code&gt; ï¼Œå³ä¸€ç§åŸºäºå¯¹æ¯”æ–‡æœ¬ - å›¾åƒå¯¹çš„é¢„è®­ç»ƒæ–¹æ³•ã€‚ &lt;code&gt;CLIP&lt;/code&gt;  ç”¨æ–‡æœ¬ä½œä¸ºç›‘ç£ä¿¡å·æ¥è®­ç»ƒå¯è¿ç§»çš„è§†è§‰æ¨¡å‹ï¼Œä½¿å¾—æœ€ç»ˆæ¨¡å‹çš„ &lt;code&gt;zero-shot&lt;/code&gt;  æ•ˆæœå ªæ¯” &lt;code&gt;ResNet50&lt;/code&gt; ï¼Œæ³›åŒ–æ€§éå¸¸å¥½ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;zero-shot&lt;/code&gt;  å°±æ˜¯ç›´æ¥æ¨ç†ï¼Œç”¨è§è¿‡çš„å›¾ç‰‡ç‰¹å¾å»åˆ¤æ–­æ²¡è§è¿‡çš„å›¾ç‰‡çš„ç±»åˆ«ï¼Œè€Œå®Œå…¨ä¸ç”¨ä¸‹æ¸¸ä»»åŠ¡è®­ç»ƒé›†è¿›è¡Œå¾®è°ƒã€‚ï¼ˆç›¸å½“äºæŠŠæ¨¡å‹ç”¨ä½œç‰¹å¾æå–ï¼Œä½†æ˜¯æ²¡æœ‰åˆ†ç±»å¤´ï¼‰&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä½œè€…åœ¨ 30 å¤šä¸ªä¸åŒçš„è®¡ç®—æœºè§†è§‰æ•°æ®é›†ä¸Šè¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œï¼ˆè¿™äº›æ•°æ®é›†æ¶µç›–äº† &lt;code&gt;OCR&lt;/code&gt; ( &lt;code&gt;Optical Character Recognition&lt;/code&gt; , å…‰å­¦å­—ç¬¦è¯†åˆ«)ã€è§†é¢‘ä¸­çš„åŠ¨ä½œè¯†åˆ«ã€åœ°ç†å®šä½å’Œè®¸å¤šç±»å‹çš„ç»†ç²’åº¦å¯¹è±¡åˆ†ç±»ç­‰ä»»åŠ¡ï¼‰ï¼Œ &lt;code&gt;CLIP&lt;/code&gt;  é€šå¸¸éƒ½èƒ½å¤Ÿä¸ç›‘ç£æ¨¡å‹çš„ &lt;code&gt;baseline&lt;/code&gt;  æ•ˆæœç›¸åª²ç¾ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä¾‹å¦‚åœ¨ &lt;code&gt;ImageNet&lt;/code&gt;  æ•°æ®é›†ä¸Šï¼Œ &lt;code&gt;CLIP&lt;/code&gt;  æ¨¡å‹åœ¨ä¸ä½¿ç”¨ &lt;code&gt;ImageNet&lt;/code&gt;  æ•°æ®é›†çš„ä»»ä½•ä¸€å¼ å›¾ç‰‡è¿›è¡Œè®­ç»ƒçš„çš„æƒ…å†µä¸‹ï¼Œæœ€ç»ˆæ¨¡å‹ç²¾åº¦èƒ½è·Ÿä¸€ä¸ªæœ‰ç›‘ç£çš„è®­ç»ƒå¥½çš„ &lt;code&gt;ResNet-50&lt;/code&gt;  æ‰“æˆå¹³æ‰‹ï¼ˆåœ¨ &lt;code&gt;ImageNet&lt;/code&gt;  ä¸Š &lt;code&gt;zero-shot&lt;/code&gt;  ç²¾åº¦ä¸º &lt;code&gt;76.2%&lt;/code&gt; ï¼Œè¿™åœ¨ä¹‹å‰ä¸€åº¦è¢«è®¤ä¸ºæ˜¯ä¸å¯èƒ½çš„ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;12-è‡ªç„¶è¯­è¨€ç›‘ç£çš„ä¼˜åŠ¿&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#12-è‡ªç„¶è¯­è¨€ç›‘ç£çš„ä¼˜åŠ¿&#34;&gt;#&lt;/a&gt; 1.2 è‡ªç„¶è¯­è¨€ç›‘ç£çš„ä¼˜åŠ¿&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒä½¿ç”¨è‡ªç„¶è¯­è¨€ç›‘ç£ä¿¡å·æ¥è®­ç»ƒè§†è§‰æ¨¡å‹ï¼Œæœ‰ä¸¤ä¸ªæœ€é‡è¦çš„ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸éœ€è¦é‡‡ç”¨ç‰¹åˆ«çš„æ ‡æ³¨æ•°æ®&lt;/strong&gt;ï¼Œæ‰©å±•æ€§æ›´å¼ºã€‚æ¯”å¦‚ &lt;code&gt;ImageNet&lt;/code&gt;  éœ€è¦å…ˆå®šä¹‰å¥½ &lt;code&gt;1000&lt;/code&gt;  ä¸ªç±»ï¼Œç„¶åæ ¹æ®è¿™äº›ç±»å»ä¸‹è½½å›¾ç‰‡ï¼Œæ¸…ç†æ•°æ®é›†ï¼Œå†å»æ ‡æ³¨æ‰€æœ‰å›¾ç‰‡ï¼Œè¿‡ç¨‹å¾ˆå¤æ‚ã€‚è€Œ CLIP ä¸è¦æ±‚è¿™ç§ç»å…¸çš„ &amp;quot;æœºå™¨å­¦ä¹ å…¼å®¹&amp;quot; çš„æ ‡æ³¨æ ¼å¼ï¼Œåªéœ€è¦ä¸‹è½½æ–‡å­— - å›¾ç‰‡å¯¹ï¼›ä¸”æ²¡æœ‰ n é€‰ 1 çš„æ ‡ç­¾ä¹‹åï¼Œæ¨¡å‹çš„è¾“å…¥è¾“å‡ºè‡ªç”±åº¦å¤§äº†å¾ˆå¤šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CLIP&lt;/code&gt;  å­¦ä¹ åˆ°çš„æ˜¯å›¾åƒç»“åˆæ–‡å­—çš„å¤šæ¨¡æ€ç‰¹å¾ï¼Œä»è€Œ&lt;strong&gt;å®ç°çµæ´»çš„ zero-shot è¿ç§»&lt;/strong&gt;ã€‚å¦‚æœåªæ˜¯å•æ¨¡æ€çš„ç‰¹å¾ï¼Œæ— è®ºæ˜¯ç±»ä¼¼ &lt;code&gt;MOCO&lt;/code&gt;  è¿˜æ˜¯ &lt;code&gt;MAE&lt;/code&gt; ï¼Œéƒ½å¾ˆéš¾åšåˆ°è¿™ä¸€ç‚¹ï¼ˆ &lt;code&gt;zero-shot&lt;/code&gt;  å¿…é¡»è¦åŠ å…¥æ–‡å­—ç‰¹å¾æ‰èƒ½åšåˆ°ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;13-æ€»ç»“&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#13-æ€»ç»“&#34;&gt;#&lt;/a&gt; 1.3 æ€»ç»“&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒç°æœ‰çš„ &lt;code&gt;CV&lt;/code&gt;  æ¨¡å‹åŸºæœ¬éƒ½æ˜¯åŸºäºäººå·¥æ ‡æ³¨çš„æ•°æ®é›†è¿›è¡Œè®­ç»ƒçš„ï¼Œç„¶åç”¨æ¥é¢„æµ‹ä¸€ç»„æå‰å®šä¹‰å¥½çš„ç‰©ä½“ç±»åˆ«ã€‚è¿™ç§æå‰å®šä¹‰å¥½çš„æ ‡ç­¾é›†åˆï¼Œä¼šå¤§å¤§ç®€åŒ–é—®é¢˜æœ¬èº«ï¼ˆæ¯”å¦‚ &lt;code&gt;ImageNet&lt;/code&gt;  å›ºå®šçš„ &lt;code&gt;1000&lt;/code&gt;  ä¸ªç±»ï¼Œ &lt;code&gt;COCO&lt;/code&gt;  æ•°æ®é›†å›ºå®š &lt;code&gt;80&lt;/code&gt;  ä¸ªç±»ç­‰ç­‰ï¼‰ã€‚ä½†æ­£å› å¦‚æ­¤ï¼Œè¿™ç§å—é™çš„ç›‘ç£ä¿¡å·é™åˆ¶äº†æ¨¡å‹çš„æ³›åŒ–æ€§å’Œå¯ç”¨æ€§ã€‚æ¯”å¦‚å¤§å¤šæ•°æ¨¡å‹éƒ½åªèƒ½é¢„æµ‹å·²çŸ¥çš„å›¾åƒç±»åˆ«ã€‚å¯¹äºæ²¡æœ‰è§è¿‡çš„å›¾åƒç±»åˆ«ï¼Œéœ€è¦é¢å¤–çš„ä¿¡æ¯æ‰èƒ½è¯†åˆ«ã€‚è¿™æ ·&lt;strong&gt;æ¯æ¬¡æ–°å¢ä¸€äº›ç±»åˆ«ï¼Œéƒ½éœ€è¦é‡æ–°æ”¶é›†æ•°æ®ï¼Œè®­ç»ƒä¸€ä¸ªæ–°çš„æ¨¡å‹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä½œè€…è®¤ä¸ºï¼Œç›´æ¥ä»è‡ªç„¶è¯­è¨€ä¸­å¾—åˆ°ç›‘ç£ä¿¡æ¯æ˜¯ä¸€ä¸ªå¾ˆæœ‰å‰é€”çš„é€‰æ‹©ï¼Œå› ä¸ºå…¶æ¶µç›–çš„èŒƒå›´æ›´å¹¿ï¼ˆåªè¦æ˜¯è¯­è¨€æè¿°è¿‡çš„ç‰©ä½“ï¼Œéƒ½æœ‰å¯èƒ½è®©è§†è§‰æ¨¡å‹å»è¯†åˆ«ï¼‰ã€‚ &lt;code&gt;CLIP&lt;/code&gt;  åˆ©ç”¨å¤šæ¨¡æ€çš„å¯¹æ¯”å­¦ä¹ ï¼Œä½¿å¾—è‡ªç„¶è¯­è¨€å¯ä»¥å¼•å¯¼æ¨¡å‹å­¦ä¹ åˆ°è§†è§‰æ¦‚å¿µï¼Œä»è€Œå®ç°éå¸¸çµæ´»çš„ &lt;code&gt;zero-shot&lt;/code&gt;  è¿ç§»ï¼ˆæŠŠåˆ†ç±»é—®é¢˜è½¬åŒ–ä¸ºäº†è·¨æ¨¡æ€æ£€ç´¢é—®é¢˜ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä¹‹å‰ä½¿ç”¨è‡ªç„¶è¯­è¨€ç›‘ç£è¿›è¡Œå›¾åƒè¡¨ç¤ºå­¦ä¹ çš„å·¥ä½œå¾ˆå°‘ï¼Œå¹¶ä¸”æ•ˆæœå¾€å¾€ä¸å¦‚æœ‰ç›‘ç£æ¨¡å‹ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—©æœŸ nlp æ¨¡å‹ä¸å¤ªå¥½å­¦&lt;/strong&gt;ã€‚æ¯”å¦‚æ—©æœŸçš„ &lt;code&gt;n-gram&lt;/code&gt;  æ¨¡å‹éå¸¸å¤æ‚ï¼Œä¸å¥½è·¨æ¨¡æ€è®­ç»ƒã€‚ä½†æ˜¯éšç€ &lt;code&gt;transformer&lt;/code&gt;  çš„å…´èµ·ï¼Œåƒ &lt;code&gt;BERT&lt;/code&gt;  å’Œ &lt;code&gt;GPT&lt;/code&gt;  è¿™ç§å…·æœ‰ä¸Šä¸‹æ–‡è¡¨ç¤ºçš„è‡ªç›‘ç£è®­ç»ƒæ¨¡å‹åšçš„è¶Šæ¥è¶Šå¥½ï¼Œ &lt;code&gt;nlp&lt;/code&gt;  æ¨¡å‹ä¹Ÿç»ˆäºæœ‰äº†å–ä¹‹ä¸å°½çš„æ–‡æœ¬ç›‘ç£ä¿¡å·ï¼Œè€Œä¸”ä½¿ç”¨ç®€å•ï¼Œæ³›åŒ–æ€§å¥½ï¼Œä¸ºå¤šæ¨¡æ€è®­ç»ƒé“ºå¹³äº†é“è·¯ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®é›†æˆ–æ¨¡å‹çš„è§„æ¨¡ä¸å¤Ÿã€‚æ¯”å¦‚ &lt;code&gt;VirTex&lt;/code&gt;  å’Œ &lt;code&gt;ICMLM&lt;/code&gt;  éƒ½åªè®­ç»ƒäº†&lt;strong&gt;åå‡ ä¸‡çš„å›¾ç‰‡&lt;/strong&gt;ï¼› &lt;code&gt;ConVIRT&lt;/code&gt;  éå¸¸ç±»ä¼¼ &lt;code&gt;CLIP&lt;/code&gt; ï¼Œä½†&lt;strong&gt;åªåœ¨åŒ»ç–—å›¾åƒä¸Šåšäº†é¢„è®­ç»ƒ&lt;/strong&gt;ã€‚ä»æœ¬è´¨ä¸Šæ¥è®²ï¼Œ &lt;code&gt;CLIP&lt;/code&gt;  å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„åˆ›æ–°ï¼Œå®ƒåªæ˜¯&lt;strong&gt;å°† ConVIRT æ–¹æ³•è¿›è¡Œç®€åŒ–ï¼Œå¹¶é‡‡ç”¨æ›´å¤§è§„æ¨¡çš„æ–‡æœ¬ - å›¾åƒå¯¹æ•°æ®é›†æ¥è®­ç»ƒ&lt;/strong&gt;ã€‚ä¹Ÿå¯ä»¥è¯´ï¼Œç›¸å¯¹äºä¹‹å‰çš„å¯¹æ¯”å­¦ä¹ ï¼Œ &lt;code&gt;CLIP&lt;/code&gt;  åªæ˜¯å°†å•æ¨¡æ€çš„æ ·æœ¬ï¼Œæ¢æˆäº†å¤šæ¨¡æ€çš„æ ·æœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;äºŒ-æ–¹æ³•&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äºŒ-æ–¹æ³•&#34;&gt;#&lt;/a&gt; äºŒã€æ–¹æ³•&lt;/h1&gt;
&lt;h2 id=&#34;21-æ¨¡å‹ç»“æ„&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#21-æ¨¡å‹ç»“æ„&#34;&gt;#&lt;/a&gt; 2.1 æ¨¡å‹ç»“æ„&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ &lt;code&gt;CLIP&lt;/code&gt;  çš„è¾“å…¥æ˜¯ä¸€å¯¹å¯¹é…å¯¹å¥½çš„çš„&lt;strong&gt;å›¾ç‰‡ - æ–‡æœ¬å¯¹&lt;/strong&gt;ï¼ˆæ¯”å¦‚è¾“å…¥æ˜¯ä¸€å¼ ç‹—çš„å›¾ç‰‡ï¼Œå¯¹åº”æ–‡æœ¬ä¹Ÿè¡¨ç¤ºè¿™æ˜¯ä¸€åªç‹—ï¼‰ã€‚è¿™äº›æ–‡æœ¬å’Œå›¾ç‰‡åˆ†åˆ«é€šè¿‡ &lt;code&gt;Text Encoder&lt;/code&gt;  å’Œ &lt;code&gt;Image Encoder&lt;/code&gt;  è¾“å‡ºå¯¹åº”çš„ç‰¹å¾ã€‚ç„¶ååœ¨è¿™äº›è¾“å‡ºçš„æ–‡å­—ç‰¹å¾å’Œå›¾ç‰‡ç‰¹å¾ä¸Šè¿›è¡Œ&lt;strong&gt;å¯¹æ¯”å­¦ä¹ &lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/CLIP/2.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå‡å¦‚æ¨¡å‹è¾“å…¥çš„æ˜¯&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; å¯¹å›¾ç‰‡ - æ–‡æœ¬å¯¹ï¼Œé‚£ä¹ˆè¿™&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; å¯¹äº’ç›¸é…å¯¹çš„å›¾åƒâ€“æ–‡æœ¬å¯¹æ˜¯&lt;strong&gt;æ­£æ ·æœ¬&lt;/strong&gt;ï¼ˆä¸‹å›¾è¾“å‡ºç‰¹å¾çŸ©é˜µå¯¹è§’çº¿ä¸Šæ ‡è¯†è“è‰²çš„éƒ¨ä½ï¼‰ï¼Œå…¶å®ƒ&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;âˆ’&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n^2 - n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.897438em;vertical-align:-0.08333em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.8141079999999999em;&#34;&gt;&lt;span style=&#34;top:-3.063em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;âˆ’&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; å¯¹æ ·æœ¬éƒ½æ˜¯&lt;strong&gt;è´Ÿæ ·æœ¬&lt;/strong&gt;ã€‚è¿™æ ·æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹å°±æ˜¯æœ€å¤§åŒ–&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ä¸ªæ­£æ ·æœ¬çš„ç›¸ä¼¼åº¦ï¼ŒåŒæ—¶æœ€å°åŒ–&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;âˆ’&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n^2 - n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.897438em;vertical-align:-0.08333em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.8141079999999999em;&#34;&gt;&lt;span style=&#34;top:-3.063em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;âˆ’&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ä¸ªè´Ÿæ ·æœ¬çš„ç›¸ä¼¼åº¦ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Text Encoder&lt;/code&gt;  å¯ä»¥é‡‡ç”¨ &lt;code&gt;NLP&lt;/code&gt;  ä¸­å¸¸ç”¨çš„ &lt;code&gt;text transformer&lt;/code&gt;  æ¨¡å‹ï¼›è€Œ &lt;code&gt;Image Encoder&lt;/code&gt;  å¯ä»¥é‡‡ç”¨å¸¸ç”¨ &lt;code&gt;CNN&lt;/code&gt;  æ¨¡å‹æˆ–è€… &lt;code&gt;vision transformer&lt;/code&gt;  ç­‰æ¨¡å‹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›¸ä¼¼åº¦æ˜¯è®¡ç®—æ–‡æœ¬ç‰¹å¾å’Œå›¾åƒç‰¹å¾çš„ä½™å¼¦ç›¸ä¼¼æ€§ &lt;code&gt;cosine similarity&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºäº†è®­ç»ƒ &lt;code&gt;CLIP&lt;/code&gt; ï¼Œ &lt;code&gt;OpenAI&lt;/code&gt;  ä»äº’è”ç½‘æ”¶é›†äº†å…±&lt;strong&gt; 4 ä¸ªäº¿çš„æ–‡æœ¬ - å›¾åƒå¯¹&lt;/strong&gt;ï¼Œè®ºæ–‡ç§°ä¹‹ä¸º &lt;code&gt;WIT(Web Image Text)&lt;/code&gt; ã€‚ &lt;code&gt;WIT&lt;/code&gt;  è´¨é‡å¾ˆé«˜ï¼Œè€Œä¸”æ¸…ç†çš„éå¸¸å¥½ï¼Œå…¶è§„æ¨¡ç›¸å½“äº &lt;code&gt;JFT-300M&lt;/code&gt; ï¼Œè¿™ä¹Ÿæ˜¯ &lt;code&gt;CLIP&lt;/code&gt;  å¦‚æ­¤å¼ºå¤§çš„åŸå› ä¹‹ä¸€ï¼ˆåç»­åœ¨ &lt;code&gt;WIT&lt;/code&gt;  ä¸Šè¿˜å­•è‚²å‡ºäº† &lt;code&gt;DALL-E&lt;/code&gt;  æ¨¡å‹ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åˆ†ç±»&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;CLIP&lt;/code&gt;  å¯ä»¥ç›´æ¥å®ç° &lt;code&gt;zero-shot&lt;/code&gt;  çš„å›¾åƒåˆ†ç±»ï¼Œå³ä¸éœ€è¦ä»»ä½•è®­ç»ƒå’Œå¾®è°ƒï¼Œè¿™ä¹Ÿæ˜¯ &lt;code&gt;CLIP&lt;/code&gt;  äº®ç‚¹å’Œå¼ºå¤§ä¹‹å¤„ã€‚ç”¨ &lt;code&gt;CLIP&lt;/code&gt;  å®ç° &lt;code&gt;zero-shot&lt;/code&gt;  åˆ†ç±»åªéœ€è¦ç®€å•çš„ä¸¤æ­¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ¹æ®ä»»åŠ¡çš„åˆ†ç±»æ ‡ç­¾æ„å»ºæ¯ä¸ªç±»åˆ«çš„æè¿°æ–‡æœ¬&lt;/strong&gt;ï¼š &lt;code&gt;A photo of &amp;#123;label&amp;#125;&lt;/code&gt; ï¼Œç„¶åå°†è¿™äº›æ–‡æœ¬é€å…¥ &lt;code&gt;Text Encoder&lt;/code&gt;  å¾—åˆ°å¯¹åº”çš„æ–‡æœ¬ç‰¹å¾ã€‚å¦‚æœç±»åˆ«æ•°ç›®ä¸º&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;ï¼Œé‚£ä¹ˆå°†å¾—åˆ°&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ä¸ªæ–‡æœ¬ç‰¹å¾ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†è¦é¢„æµ‹çš„å›¾åƒé€å…¥ &lt;code&gt;Image Encoder&lt;/code&gt;  å¾—åˆ°å›¾åƒç‰¹å¾ï¼Œç„¶åä¸&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;n&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; ä¸ªæ–‡æœ¬ç‰¹å¾è®¡ç®—ç¼©æ”¾çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆå’Œè®­ç»ƒè¿‡ç¨‹ä¿æŒä¸€è‡´ï¼‰ï¼Œç„¶å&lt;strong&gt;é€‰æ‹©ç›¸ä¼¼åº¦æœ€å¤§çš„æ–‡æœ¬å¯¹åº”çš„ç±»åˆ«ä½œä¸ºå›¾åƒåˆ†ç±»é¢„æµ‹ç»“æœ&lt;/strong&gt;ã€‚è¿›ä¸€æ­¥åœ°ï¼Œå¯ä»¥å°†è¿™äº›ç›¸ä¼¼åº¦çœ‹æˆ &lt;code&gt;logits&lt;/code&gt; ï¼Œé€å…¥ &lt;code&gt;softmax&lt;/code&gt;  åå¯ä»¥åˆ°æ¯ä¸ªç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒæˆ‘ä»¬ä¸å†éœ€è¦é¢„å…ˆå®šä¹‰å¥½çš„æ ‡ç­¾ï¼ˆç±»åˆ«ï¼‰åˆ—è¡¨ï¼Œç›´æ¥å°†å›¾ç‰‡å–‚ç»™ä¸åŒçš„æ–‡æœ¬å¥å­ï¼Œå°±å¯ä»¥çŸ¥é“å›¾ç‰‡ä¸­æ˜¯å¦æœ‰æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç‰©ä½“ã€‚å³ï¼Œ &lt;code&gt;CLIP&lt;/code&gt;  çš„å¤šæ¨¡æ€ç‰¹æ€§ï¼ˆåˆ©ç”¨æ–‡æœ¬ç›‘ç£ä¿¡å·ï¼‰ä¸ºå…·ä½“çš„ä»»åŠ¡æ„å»ºäº†åŠ¨æ€çš„åˆ†ç±»å™¨ï¼Œ&lt;strong&gt;ä½¿å¾—æ¨¡å‹ä¸å†å—é™äºé¢„å…ˆå®šä¹‰å¥½çš„ç±»åˆ«ï¼Œæ›´åŠ å…·æœ‰é€šç”¨æ€§å’Œå¯ç”¨æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;22-é¢„è®­ç»ƒæ–¹æ³•&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#22-é¢„è®­ç»ƒæ–¹æ³•&#34;&gt;#&lt;/a&gt; 2.2 é¢„è®­ç»ƒæ–¹æ³•&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;CV&lt;/code&gt;  é¢†åŸŸçš„æ¨¡å‹éƒ½å¾ˆå¤§ï¼Œè®­ç»ƒèµ·æ¥ä¹Ÿå¾ˆè´µã€‚æ¯”å¦‚ &lt;code&gt;noise student&lt;/code&gt;  ä¹‹å‰åœ¨ &lt;code&gt;ImageNet&lt;/code&gt;  ä¸€ç›´éœ¸æ¦œï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å‹éœ€è¦åœ¨ä¸€ä¸ª &lt;code&gt;TPUv3&lt;/code&gt;  ä¸Šè®­ç»ƒ &lt;code&gt;33&lt;/code&gt;  å¹´ï¼Œè¿™è¿˜åªæ˜¯åœ¨åŒ…å« &lt;code&gt;1000&lt;/code&gt;  ç±»çš„ &lt;code&gt;ImageNet&lt;/code&gt;  ä¸Šé¢„è®­ç»ƒçš„ï¼Œè€Œä¸”åªè®­ç»ƒè§†è§‰ç‰¹å¾ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒç”±äºè®­ç»ƒæ•°æ®é‡å’Œæ¨¡å‹è®¡ç®—é‡éƒ½å¾ˆå¤§ï¼Œè®­ç»ƒæ•ˆç‡æˆä¸ºä¸€ä¸ªè‡³å…³é‡è¦çš„å› ç´ ã€‚ä½œè€…åšäº†å¾ˆå¤šå°è¯•ï¼Œæœ€ç»ˆé€‰æ‹©äº†å¯¹æ¯”å­¦ä¹ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;VirTex&lt;/code&gt;  æ¨¡å‹ï¼šé¢„æµ‹æ–‡æœ¬ï¼Œå¯¹åº”ä¸‹å›¾è“è‰²çº¿ &lt;code&gt;Transformer Language Model&lt;/code&gt; ï¼š &lt;code&gt;Image Encoder&lt;/code&gt;  ä½¿ç”¨ &lt;code&gt;CNN&lt;/code&gt;  æ¨¡å‹ï¼Œ &lt;code&gt;Text Encoder&lt;/code&gt;  ä½¿ç”¨ &lt;code&gt;transformer&lt;/code&gt;  æ¨¡å‹ï¼Œä¸¤ä¸ªæ¨¡å‹ä¸€èµ·ä»å¤´è®­ç»ƒï¼Œä»»åŠ¡æ˜¯é¢„æµ‹å›¾ç‰‡å¯¹åº”çš„æ–‡æœ¬ï¼ˆ &lt;code&gt;image caption&lt;/code&gt; ï¼‰ã€‚è¿™ç§æ–¹æ³•çš„è®­ç»ƒæ•ˆç‡å¤ªæ…¢ï¼Œå› ä¸ºæ ¹æ®å›¾ç‰‡è¿›è¡Œæ–‡æœ¬æè¿°ï¼Œå¯èƒ½æ€§å¤ªå¤šäº†ï¼Œä½ å¯ä»¥ä»å„ä¸ªè§’åº¦å»æè¿°ä¸€å¼ å›¾ç‰‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Bag of Words Prediction&lt;/code&gt; ï¼ˆæ©˜è‰²çº¿ï¼‰ï¼šä¸è¦æ±‚æ¯ä¸ªè¯éƒ½æ˜¯æŒ‰é¡ºåºçš„è¿›è¡Œé¢„æµ‹ï¼Œæ‰€æœ‰è¯éƒ½é¢„æµ‹å‡ºæ¥å°±è¡Œã€‚è¿™æ ·æ”¾å®½äº†çº¦æŸï¼Œè®­ç»ƒé€Ÿåº¦æé«˜äº†ä¸‰å€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CLIP&lt;/code&gt; ï¼šç®€åŒ–ç‰ˆçš„ &lt;code&gt;ConVIRT&lt;/code&gt; ï¼ŒåŸºäºå¯¹æ¯”å­¦ä¹ ã€‚åªéœ€è¦åˆ¤æ–­å›¾æ–‡æ˜¯å¦é…å¯¹ï¼Œè¿›ä¸€æ­¥ç®€åŒ–äº†è®­ç»ƒä»»åŠ¡ï¼Œè®­ç»ƒæ•ˆç‡ä¸€ä¸‹å­æå‡ &lt;code&gt;4&lt;/code&gt;  å€ï¼ˆç»¿è‰²çº¿ï¼‰è®­ç»ƒä»»åŠ¡æ›´åŠ åˆç†ã€‚å› ä¸ºè®­ç»ƒæ•°æ®æ‰€åŒ…å«çš„æ–‡æœ¬ - å›¾åƒå¯¹æ˜¯ä»äº’è”ç½‘æ”¶é›†æ¥çš„ï¼Œå®ƒä»¬å­˜åœ¨ä¸€å®šçš„å™ªéŸ³ï¼ŒäºŒè€…å¹¶ä¸å®Œå…¨åŒ¹é…ã€‚é€‚å½“çš„é™ä½è®­ç»ƒç›®æ ‡ï¼Œåè€Œèƒ½å–å¾—æ›´å¥½çš„æ”¶æ•›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/CLIP/2.2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;(1)  &lt;code&gt;Text Encoder&lt;/code&gt;  æ¶æ„&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆ &lt;code&gt;Text Encoder&lt;/code&gt;  å›ºå®šé€‰æ‹©ä¸€ä¸ªåŒ…å« &lt;code&gt;63M&lt;/code&gt;  å‚æ•°çš„ &lt;code&gt;text transformer&lt;/code&gt;  æ¨¡å‹ï¼Œ&lt;/p&gt;
&lt;p&gt;(2)  &lt;code&gt;Image Encoder&lt;/code&gt;  æ¶æ„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ResNet&lt;/code&gt; ï¼š &lt;code&gt;ResNet50&lt;/code&gt; ï¼Œ &lt;code&gt;ResNet101&lt;/code&gt; ï¼Œ &lt;code&gt;RN50x4&lt;/code&gt; ï¼Œ &lt;code&gt;RN50x16&lt;/code&gt;  å’Œ &lt;code&gt;RNx64&lt;/code&gt; ï¼ˆåé¢ä¸‰ä¸ªæ¨¡å‹æ˜¯æŒ‰ç…§ &lt;code&gt;EfficientNet&lt;/code&gt;  ç¼©æ”¾è§„åˆ™å¯¹ &lt;code&gt;ResNet&lt;/code&gt;  åˆ†åˆ«å¢å¤§ &lt;code&gt;4x&lt;/code&gt; ï¼Œ &lt;code&gt;16x&lt;/code&gt;  å’Œ &lt;code&gt;64x&lt;/code&gt;  å¾—åˆ°ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ViT&lt;/code&gt; ï¼š &lt;code&gt;ViT-B/32&lt;/code&gt; ï¼Œ &lt;code&gt;ViT-B/16&lt;/code&gt;  å’Œ &lt;code&gt;ViT-L/14&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(3) æ‰€æœ‰çš„æ¨¡å‹éƒ½è®­ç»ƒ 32 ä¸ª epochsï¼Œé‡‡ç”¨ AdamW ä¼˜åŒ–å™¨ï¼Œbatch size=32768&lt;/p&gt;
&lt;p&gt;(4) åªåœ¨ ResNet50 ä¸Šè®­ç»ƒä¸€ä¸ª epoch è¿›è¡Œè¶…å‚æœç´¢ï¼Œæ²¡æœ‰è¿›è¡Œè¿›ä¸€æ­¥çš„è°ƒå‚&lt;/p&gt;
&lt;p&gt;(5) &lt;strong&gt;æ•°æ®é›†éå¸¸å¤§ï¼Œå‡ ä¹ä¸ä¼šå‡ºç°è¿‡æ‹Ÿåˆï¼Œæ‰€ä»¥ Image Encoder å’Œ Text Encoder ä¸éœ€è¦æå‰è¿›è¡Œé¢„è®­ç»ƒ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;(6) åªä½¿ç”¨çº¿æ€§æŠ•å°„å±‚ï¼ˆçº¿æ€§éçº¿æ€§å½±å“ä¸å¤§ï¼‰&lt;/p&gt;
&lt;p&gt;(7) æ•°æ®å¢å¼ºåªä½¿ç”¨å›¾ç‰‡çš„éšæœºå‰ªè£ï¼Œè¿™æ˜¯å› ä¸ºæ•°æ®é›†éå¸¸å¤§&lt;/p&gt;
&lt;p&gt;(8) å¯¹æ¯”å­¦ä¹ ç›®æ ‡å‡½æ•°ä¸­çš„è¶…å‚æ•° Ï„ï¼Œè®¾ç½®æˆå¯å­¦ä¹ çš„æ ‡é‡ï¼Œåœ¨è®­ç»ƒä¸­è‡ªåŠ¨ä¼˜åŒ–ï¼Œè€Œä¸ç”¨æ…¢æ…¢è°ƒå‚ï¼ˆè¿˜æ˜¯å› ä¸ºæ•°æ®é›†å¤ªå¤§ï¼Œè®­ç»ƒå¾ˆè´µï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;23-ä¼ªä»£ç &#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#23-ä¼ªä»£ç &#34;&gt;#&lt;/a&gt; 2.3 ä¼ªä»£ç &lt;/h2&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# image_encoder - ResNet or Vision Transformer&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# text_encoder - CBOW or Text Transformer&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# I [n, h, w, c] - è¾“å…¥å›¾ç‰‡ç»´åº¦&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# T [n, l] - è¾“å…¥æ–‡æœ¬ç»´åº¦ï¼Œl è¡¨ç¤ºåºåˆ—é•¿åº¦&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# W_i[d_i, d_e] - learned proj of image to embed&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# W_t[d_t, d_e] - learned proj of text to embed&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# t - learned temperature parameter&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;#  åˆ†åˆ«æå–å›¾åƒç‰¹å¾å’Œæ–‡æœ¬ç‰¹å¾&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;I_f &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; image_encoder&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;I&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;#[n, d_i]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;T_f &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; text_encoder&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;T&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;#[n, d_t]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# å¯¹ä¸¤ä¸ªç‰¹å¾è¿›è¡Œçº¿æ€§æŠ•å°„ï¼Œå¾—åˆ°ç›¸åŒç»´åº¦çš„ç‰¹å¾ d_eï¼Œå¹¶è¿›è¡Œ l2 å½’ä¸€åŒ–ï¼Œä¿æŒæ•°æ®å°ºåº¦çš„ä¸€è‡´æ€§&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# å¤šæ¨¡æ€ embedding [n, d_e]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;I_e &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; l2_normalize&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;np&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dot&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;I_f&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; W_i&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; axis&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;T_e &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; l2_normalize&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;np&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dot&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;T_f&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; W_t&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; axis&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# è®¡ç®—ç¼©æ”¾çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼š[n, n]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;logits &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; np&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dot&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;I_e&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; T_e&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;T&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; np&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;exp&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;t&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# symmetric loss function&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;labels &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; np&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;arange&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;n&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;#  å¯¹è§’çº¿å…ƒç´ çš„ labels&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;loss_i &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; cross_entropy_loss&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;logits&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; labels&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; axis&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;# image loss&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;loss_t &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; cross_entropy_loss&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;logits&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; labels&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; axis&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;# text loss&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;loss &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;loss_i &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; loss_t&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;# å¯¹ç§°å¼çš„ç›®æ ‡å‡½æ•°&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;â€ƒâ€ƒåœ¨ &lt;code&gt;MOCO&lt;/code&gt;  ä¸­ï¼ŒçœŸå®æ ‡ç­¾éƒ½æ˜¯ &lt;code&gt;0&lt;/code&gt; ï¼Œå› ä¸ºå…¶æ­£æ ·æœ¬éƒ½æ˜¯æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œæ‰€ä»¥æ­£æ ·æœ¬å¯¹åº”çš„ç´¢å¼•æ°¸è¿œæ˜¯ &lt;code&gt;0&lt;/code&gt; ï¼›ä½†æ˜¯åœ¨ &lt;code&gt;CLIP&lt;/code&gt;  ä¸­ï¼Œæ­£æ ·æœ¬éƒ½æ˜¯åœ¨å¯¹è§’çº¿ä¸Šï¼Œå³&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo separator=&#34;true&#34;&gt;,&lt;/mo&gt;&lt;mo&gt;â€¦&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;I_1,T_1,I_2,T_2,\dots&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.8777699999999999em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.07847em;&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.07847em;&#34;&gt;I&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;&lt;span class=&#34;mord mathnormal&#34; style=&#34;margin-right:0.13889em;&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;msupsub&#34;&gt;&lt;span class=&#34;vlist-t vlist-t2&#34;&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.30110799999999993em;&#34;&gt;&lt;span style=&#34;top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;&#34;&gt;&lt;span class=&#34;pstrut&#34; style=&#34;height:2.7em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;sizing reset-size6 size3 mtight&#34;&gt;&lt;span class=&#34;mord mtight&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-s&#34;&gt;â€‹&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;vlist-r&#34;&gt;&lt;span class=&#34;vlist&#34; style=&#34;height:0.15em;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;mpunct&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.16666666666666666em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;minner&#34;&gt;â€¦&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;ï¼Œæ‰€ä»¥çœŸå®æ ‡ç­¾ä¸º &lt;code&gt;np.arange(n)&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸‰-å‚è€ƒç¨‹åº&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸‰-å‚è€ƒç¨‹åº&#34;&gt;#&lt;/a&gt; ä¸‰ã€å‚è€ƒç¨‹åº&lt;/h1&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9vcGVuYWkvY2xpcC12aXQtbGFyZ2UtcGF0Y2gxNA==&#34;&gt;https://huggingface.co/openai/clip-vit-large-patch14&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;from&lt;/span&gt; PIL &lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; Image&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;from&lt;/span&gt; transformers &lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; CLIPProcessor&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; CLIPModel&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; CLIPModel&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;from_pretrained&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;E:/python/else/LLM_learn/4_CLIP/model&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;processor &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; CLIPProcessor&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;from_pretrained&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;E:/python/else/LLM_learn/4_CLIP/model&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;image &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; Image&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;1.jpg&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;inputs &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; processor&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;text&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;a photo of a cat&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#34;a photo of a dog&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; images&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;image&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; return_tensors&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;pt&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; padding&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;outputs &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; model&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;**&lt;/span&gt;inputs&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;logits_per_image &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; outputs&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;logits_per_image  &lt;span class=&#34;token comment&#34;&gt;# this is the image-text similarity score&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;logits_per_image&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;probs &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; logits_per_image&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;softmax&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# we can take the softmax to get the label probabilities&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;probs&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://qianqiu-cell.github.io/2024/07/29/AI/LLM_finetune/</guid>
            <title>å¤§æ¨¡å‹å¾®è°ƒ</title>
            <link>http://qianqiu-cell.github.io/2024/07/29/AI/LLM_finetune/</link>
            <category>AI</category>
            <pubDate>Mon, 29 Jul 2024 00:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;å‚è€ƒé“¾æ¥ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzU2NTkxODE0L2FydGljbGUvZGV0YWlscy8xMzEyOTM5NDA=&#34;&gt;https://blog.csdn.net/qq_56591814/article/details/131293940&lt;/span&gt;ã€&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMVdrYnplVUVWRC8/c3BtX2lkX2Zyb209MzMzLjg4MC5teV9oaXN0b3J5LnBhZ2UuY2xpY2smYW1wO3ZkX3NvdXJjZT1lMDExNzJlYTI5MmMxYzYwNWIzNDYxMDFkNzAwNmM2MQ==&#34;&gt;https://www.bilibili.com/video/BV1WkbzeUEVD/?spm_id_from=333.880.my_history.page.click&amp;amp;vd_source=e01172ea292c1c605b346101d7006c61&lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&#34;ä¸€-ä¸ºä»€ä¹ˆè¦å¯¹å¤§æ¨¡å‹è¿›è¡Œå¾®è°ƒ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸€-ä¸ºä»€ä¹ˆè¦å¯¹å¤§æ¨¡å‹è¿›è¡Œå¾®è°ƒ&#34;&gt;#&lt;/a&gt; ä¸€ã€ä¸ºä»€ä¹ˆè¦å¯¹å¤§æ¨¡å‹è¿›è¡Œå¾®è°ƒ&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒé€šå¸¸ï¼Œè¦å¯¹å¤§æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œæœ‰ä»¥ä¸‹ä¸€äº›åŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªåŸå› æ˜¯ï¼Œå› ä¸ºå¤§æ¨¡å‹çš„å‚æ•°é‡éå¸¸å¤§ï¼Œè®­ç»ƒæˆæœ¬éå¸¸é«˜ï¼Œæ¯å®¶å…¬å¸éƒ½å»ä»å¤´è®­ç»ƒä¸€ä¸ªè‡ªå·±çš„å¤§æ¨¡å‹ï¼Œè¿™ä¸ªäº‹æƒ…çš„æ€§ä»·æ¯”éå¸¸ä½ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒä¸ªåŸå› æ˜¯ï¼Œ &lt;code&gt;Prompt Engineering&lt;/code&gt;  çš„æ–¹å¼æ˜¯ä¸€ç§ç›¸å¯¹æ¥è¯´å®¹æ˜“ä¸Šæ‰‹çš„ä½¿ç”¨å¤§æ¨¡å‹çš„æ–¹å¼ï¼Œä½†æ˜¯å®ƒçš„ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ã€‚å› ä¸ºé€šå¸¸å¤§æ¨¡å‹çš„å®ç°åŸç†ï¼Œéƒ½ä¼šå¯¹è¾“å…¥åºåˆ—çš„é•¿åº¦æœ‰é™åˆ¶ï¼Œ &lt;code&gt;Prompt Engineering&lt;/code&gt;  çš„æ–¹å¼ä¼šæŠŠ &lt;code&gt;Prompt&lt;/code&gt;  æå¾—å¾ˆé•¿ã€‚è¶Šé•¿çš„ &lt;code&gt;Prompt&lt;/code&gt; ï¼Œå¤§æ¨¡å‹çš„æ¨ç†æˆæœ¬è¶Šé«˜ï¼Œå› ä¸ºæ¨ç†æˆæœ¬æ˜¯è·Ÿ &lt;code&gt;Prompt&lt;/code&gt;  é•¿åº¦çš„å¹³æ–¹æ­£å‘ç›¸å…³çš„ã€‚å¦å¤–ï¼Œ &lt;code&gt;Prompt&lt;/code&gt;  å¤ªé•¿ä¼šå› è¶…è¿‡é™åˆ¶è€Œè¢«æˆªæ–­ï¼Œè¿›è€Œå¯¼è‡´å¤§æ¨¡å‹çš„è¾“å‡ºè´¨é‡æ‰“æŠ˜å£ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ã€‚å¯¹äºä¸ªäººä½¿ç”¨è€…è€Œè¨€ï¼Œå¦‚æœæ˜¯è§£å†³è‡ªå·±æ—¥å¸¸ç”Ÿæ´»ã€å·¥ä½œä¸­çš„ä¸€äº›é—®é¢˜ï¼Œç›´æ¥ç”¨ &lt;code&gt;Prompt Engineering&lt;/code&gt;  çš„æ–¹å¼ï¼Œé€šå¸¸é—®é¢˜ä¸å¤§ã€‚ä½†å¯¹äºå¯¹å¤–æä¾›æœåŠ¡çš„ä¼ä¸šæ¥è¯´ï¼Œè¦æƒ³åœ¨è‡ªå·±çš„æœåŠ¡ä¸­æ¥å…¥å¤§æ¨¡å‹çš„èƒ½åŠ›ï¼Œæ¨ç†æˆæœ¬æ˜¯ä¸å¾—ä¸è¦è€ƒè™‘çš„ä¸€ä¸ªå› ç´ ï¼Œå¾®è°ƒç›¸å¯¹æ¥è¯´å°±æ˜¯ä¸€ä¸ªæ›´ä¼˜çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬ä¸‰ä¸ªåŸå› æ˜¯ï¼Œ &lt;code&gt;Prompt Engineering&lt;/code&gt;  çš„æ•ˆæœè¾¾ä¸åˆ°è¦æ±‚ï¼Œä¼ä¸šåˆæœ‰æ¯”è¾ƒå¥½çš„è‡ªæœ‰æ•°æ®ï¼Œèƒ½å¤Ÿé€šè¿‡è‡ªæœ‰æ•°æ®ï¼Œæ›´å¥½çš„æå‡å¤§æ¨¡å‹åœ¨ç‰¹å®šé¢†åŸŸçš„èƒ½åŠ›ã€‚è¿™æ—¶å€™å¾®è°ƒå°±éå¸¸é€‚ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬å››ä¸ªåŸå› æ˜¯ï¼Œè¦åœ¨ä¸ªæ€§åŒ–çš„æœåŠ¡ä¸­ä½¿ç”¨å¤§æ¨¡å‹çš„èƒ½åŠ›ï¼Œè¿™æ—¶å€™é’ˆå¯¹æ¯ä¸ªç”¨æˆ·çš„æ•°æ®ï¼Œè®­ç»ƒä¸€ä¸ªè½»é‡çº§çš„å¾®è°ƒæ¨¡å‹ï¼Œå°±æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äº”ä¸ªåŸå› æ˜¯ï¼Œæ•°æ®å®‰å…¨çš„é—®é¢˜ã€‚å¦‚æœæ•°æ®æ˜¯ä¸èƒ½ä¼ é€’ç»™ç¬¬ä¸‰æ–¹å¤§æ¨¡å‹æœåŠ¡çš„ï¼Œé‚£ä¹ˆæ­å»ºè‡ªå·±çš„å¤§æ¨¡å‹å°±éå¸¸å¿…è¦ã€‚é€šå¸¸è¿™äº›å¼€æºçš„å¤§æ¨¡å‹éƒ½æ˜¯éœ€è¦ç”¨è‡ªæœ‰æ•°æ®è¿›è¡Œå¾®è°ƒï¼Œæ‰èƒ½å¤Ÿæ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œè¿™æ—¶å€™ä¹Ÿéœ€è¦å¯¹å¤§æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;äºŒ-å¤§æ¨¡å‹å¾®è°ƒçš„æŠ€æœ¯æ‰‹æ®µ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äºŒ-å¤§æ¨¡å‹å¾®è°ƒçš„æŠ€æœ¯æ‰‹æ®µ&#34;&gt;#&lt;/a&gt; äºŒã€å¤§æ¨¡å‹å¾®è°ƒçš„æŠ€æœ¯æ‰‹æ®µ&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒæ ¹æ®å¾®è°ƒå¯¹æ•´ä¸ªé¢„è®­ç»ƒæ¨¡å‹çš„è°ƒæ•´ç¨‹åº¦ï¼Œå¾®è°ƒå¯ä»¥åˆ†ä¸ºå…¨å¾®è°ƒå’Œéƒ¨åˆ†å¾®è°ƒä¸¤ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å…¨å¾®è°ƒï¼ˆ &lt;code&gt;Full Fine-tuning, FFT&lt;/code&gt; ï¼‰ï¼š &lt;code&gt;FFT&lt;/code&gt;  æ˜¯æŒ‡å¯¹æ•´ä¸ªé¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„æ¨¡å‹å‚æ•°ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œé¢„è®­ç»ƒæ¨¡å‹çš„æ‰€æœ‰å±‚å’Œå‚æ•°éƒ½ä¼šè¢«æ›´æ–°å’Œä¼˜åŒ–ï¼Œä»¥é€‚åº”ç›®æ ‡ä»»åŠ¡çš„éœ€æ±‚ã€‚è¿™ç§å¾®è°ƒæ–¹æ³•é€šå¸¸é€‚ç”¨äºä»»åŠ¡å’Œé¢„è®­ç»ƒæ¨¡å‹ä¹‹é—´å­˜åœ¨è¾ƒå¤§å·®å¼‚çš„æƒ…å†µï¼Œæˆ–è€…ä»»åŠ¡éœ€è¦æ¨¡å‹å…·æœ‰é«˜åº¦çµæ´»æ€§å’Œè‡ªé€‚åº”èƒ½åŠ›çš„æƒ…å†µã€‚ &lt;code&gt;FFT&lt;/code&gt;  éœ€è¦è¾ƒå¤§çš„è®¡ç®—èµ„æºå’Œæ—¶é—´ï¼Œä½†å¯ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‚æ•°é«˜æ•ˆå¾®è°ƒï¼ˆ &lt;code&gt;Parameter-Efficient Fine-Tuning, PEFT&lt;/code&gt; ï¼‰ï¼š &lt;code&gt;PEFT&lt;/code&gt;  æ—¨åœ¨é€šè¿‡æœ€å°åŒ–å¾®è°ƒå‚æ•°æ•°é‡å’Œè®¡ç®—å¤æ‚åº¦ï¼Œæå‡é¢„è®­ç»ƒæ¨¡å‹åœ¨æ–°ä»»åŠ¡ä¸Šçš„è¡¨ç°ï¼Œä»è€Œå‡è½»å¤§å‹é¢„è®­ç»ƒæ¨¡å‹çš„è®­ç»ƒè´Ÿæ‹…ã€‚ &lt;code&gt;PEFT&lt;/code&gt;  æ–¹æ³•å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚æ ¹æ®å…¶åŸºæœ¬æ–¹æ³•æˆ–ç»“æ„è¿›è¡ŒåŒºåˆ† â€”â€” æ˜¯å¦å‘æ¨¡å‹å¼•å…¥æ–°çš„å‚æ•°ï¼Œè¿˜æ˜¯ä»…å¾®è°ƒä¸åˆ†ç°æœ‰çš„å‚æ•°ï¼›æ ¹æ®å¾®è°ƒç›®çš„è¿›è¡Œåˆ†ç±» â€”â€” æ˜¯å¦æ—¨åœ¨æœ€å°åŒ–å†…å­˜å ç”¨æˆ–ä»…è¿½æ±‚å­˜å‚¨æ•ˆç‡ã€‚æˆ‘ä»¬é¦–å…ˆåŸºäºåŸºæœ¬æ–¹æ³• &amp;amp; ç»“æ„è¿›è¡Œåˆ†ç±»ï¼Œä¸‹å›¾å±•ç¤ºäº†è¿™ä¸ªåˆ†ç±»ä½“ç³»çš„ &lt;code&gt;30&lt;/code&gt;  ç§ &lt;code&gt;PEFT&lt;/code&gt;  æ–¹æ³•ã€‚æ¥ä¸‹æ¥å¯¹ &lt;code&gt;PEFT&lt;/code&gt;  çš„åˆ†ç±»è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/LLM_finetune/2.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;21-additive-methods&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#21-additive-methods&#34;&gt;#&lt;/a&gt; 2.1 Additive methods&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒä¸»è¦æ€æƒ³æ˜¯é€šè¿‡&lt;mark&gt;æ·»åŠ é¢å¤–çš„å‚æ•°æˆ–å±‚æ¥æ‰©å……ç°æœ‰çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¹¶ä»…è®­ç»ƒæ–°æ·»åŠ çš„å‚æ•°&lt;/mark&gt;ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™æ˜¯å‚æ•°é«˜æ•ˆå¾®è°ƒæ–¹æ³•ä¸­æœ€å¤§ä¸”å¹¿æ³›æ¢ç´¢çš„ç±»åˆ«ã€‚è¿™ç§æ–¹æ³•åˆåˆ†ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Adapters&lt;/code&gt; ï¼šå³åœ¨ &lt;code&gt;Transformer&lt;/code&gt;  å­å±‚åå¼•å…¥å°å‹å…¨è¿æ¥ç½‘ç»œï¼Œè¿™ç§æ–¹æ³•è¢«å¹¿æ³›é‡‡ç”¨ã€‚ &lt;code&gt;Adapters&lt;/code&gt;  æœ‰å¤šç§å˜ä½“ï¼Œä¾‹å¦‚ä¿®æ”¹é€‚é…å™¨çš„ä½ç½®ã€å‰ªæä»¥åŠä½¿ç”¨é‡å‚æ•°åŒ–æ¥å‡å°‘å¯è®­ç»ƒå‚æ•°çš„æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Soft Prompts&lt;/code&gt; ï¼š &lt;code&gt;GPT-2&lt;/code&gt;  æ—¨åœ¨é€šè¿‡ä¿®æ”¹è¾“å…¥æ–‡æœ¬æ¥æ§åˆ¶è¯­è¨€æ¨¡å‹çš„è¡Œä¸ºã€‚ç„¶è€Œï¼Œè¿™äº›æ–¹æ³•å¾ˆéš¾è¿›è¡Œä¼˜åŒ–ï¼Œä¸”å­˜åœ¨æ¨¡å‹è¾“å…¥é•¿åº¦ã€è®­ç»ƒç¤ºä¾‹çš„æ•°é‡ç­‰é™åˆ¶ï¼Œç”±æ­¤å¼•å…¥äº† &lt;code&gt;soft&lt;/code&gt;  æ¦‚å¿µã€‚ &lt;code&gt;Soft Prompts&lt;/code&gt; &lt;mark&gt; å°†æ¨¡å‹çš„ä¸€éƒ¨åˆ†è¾“å…¥åµŒå…¥é€šè¿‡æ¢¯åº¦ä¸‹é™è¿›è¡Œå¾®è°ƒ&lt;/mark&gt;ï¼Œå°†åœ¨ç¦»æ•£ç©ºé—´ä¸­å¯»æ‰¾æç¤ºçš„é—®é¢˜è½¬åŒ–ä¸ºè¿ç»­ä¼˜åŒ–é—®é¢˜ã€‚ &lt;code&gt;Soft Prompts&lt;/code&gt;  å¯ä»¥ä»…å¯¹è¾“å…¥å±‚è¿›è¡Œè®­ç»ƒï¼ˆ&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9wYXBlcnN3aXRoY29kZS5jb20vcGFwZXIvZ3B0LXVuZGVyc3RhbmRzLXRvbw==&#34;&gt;ã€ŠGPT Understands, Tooã€‹&lt;/span&gt;ã€&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9wYXBlcnN3aXRoY29kZS5jb20vcGFwZXIvdGhlLXBvd2VyLW9mLXNjYWxlLWZvci1wYXJhbWV0ZXItZWZmaWNpZW50&#34;&gt;Prompt Tuning&lt;/span&gt;ï¼‰ï¼Œä¹Ÿå¯ä»¥å¯¹æ‰€æœ‰å±‚è¿›è¡Œè®­ç»ƒï¼ˆ&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9wYXBlcnN3aXRoY29kZS5jb20vcGFwZXIvcHJlZml4LXR1bmluZy1vcHRpbWl6aW5nLWNvbnRpbnVvdXMtcHJvbXB0cw==&#34;&gt;Prefix-Tuning&lt;/span&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;others&lt;/code&gt; ï¼šä¾‹å¦‚ &lt;code&gt;LeTS&lt;/code&gt; ,  &lt;code&gt;LST&lt;/code&gt;  å’Œ &lt;code&gt;(IA)^3&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒå°½ç®¡è¿™äº›æ–¹æ³•å¼•å…¥äº†é¢å¤–çš„å‚æ•°åˆ°ç½‘ç»œä¸­ï¼Œä½†å®ƒä»¬é€šè¿‡å‡å°‘æ¢¯åº¦å’Œä¼˜åŒ–å™¨çŠ¶æ€çš„å¤§å°ï¼Œå‡å°‘äº†è®­ç»ƒæ—¶é—´ï¼Œæå‡äº†å†…å­˜æ•ˆç‡ã€‚æ­¤å¤–å¯ä»¥å¯¹å†»ç»“çš„æ¨¡å‹å‚æ•°è¿›è¡Œé‡åŒ–ï¼ˆ&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzU2NTkxODE0L2FydGljbGUvZGV0YWlscy8xMzEyOTM5NDA=&#34;&gt;å‚è€ƒè®ºæ–‡&lt;/span&gt;ï¼‰ï¼Œ &lt;code&gt;additive PEFT&lt;/code&gt;  æ–¹æ³•èƒ½å¤Ÿå¾®è°ƒæ›´å¤§çš„ç½‘ç»œæˆ–ä½¿ç”¨æ›´å¤§çš„æ‰¹æ¬¡å¤§å°ï¼Œè¿™æé«˜äº†åœ¨ &lt;code&gt;GPU&lt;/code&gt;  ä¸Šçš„è®­ç»ƒååé‡ã€‚æ­¤å¤–ï¼Œåœ¨åˆ†å¸ƒå¼è®¾ç½®ä¸­ä¼˜åŒ–è¾ƒå°‘çš„å‚æ•°å¤§å¤§å‡å°‘äº†é€šä¿¡é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;22-selective-methods&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#22-selective-methods&#34;&gt;#&lt;/a&gt; 2.2 Selective methods&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒæœ€æ—©çš„ &lt;code&gt;selective PEFT&lt;/code&gt;  æ–¹æ³•æ˜¯ä»…å¾®è°ƒç½‘ç»œçš„å‡ ä¸ªé¡¶å±‚ï¼ˆå†»ç»“å‰å±‚ï¼‰ï¼Œç°ä»£æ–¹æ³•é€šå¸¸åŸºäºå±‚çš„ç±»å‹ï¼ˆ&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9wYXBlcnN3aXRoY29kZS5jb20vcGFwZXIvb24tdGhlLXN0cmVuZ3Rocy1vZi1jcm9zcy1hdHRlbnRpb24taW4=&#34;&gt;Cross-Attention is All You Need&lt;/span&gt;ï¼‰æˆ–å†…éƒ¨ç»“æ„ï¼Œä¾‹å¦‚ä»…å¾®è°ƒæ¨¡å‹çš„åç½®ï¼ˆ&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9wYXBlcnN3aXRoY29kZS5jb20vcGFwZXIvYml0Zml0LXNpbXBsZS1wYXJhbWV0ZXItZWZmaWNpZW50LWZpbmUtdHVuaW5n&#34;&gt;BitFit&lt;/span&gt;ï¼‰æˆ–ä»…ç‰¹å®šçš„è¡Œï¼ˆ&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9wYXBlcnN3aXRoY29kZS5jb20vcGFwZXIvZWZmaWNpZW50LWZpbmUtdHVuaW5nLW9mLWJlcnQtbW9kZWxzLW9uLXRoZQ==&#34;&gt;Efficient Fine-Tuning of BERT Models on the Edge&lt;/span&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;23-reparametrization-based-pefté‡å‚æ•°åŒ–&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#23-reparametrization-based-pefté‡å‚æ•°åŒ–&#34;&gt;#&lt;/a&gt; 2.3 Reparametrization-based PEFTï¼ˆé‡å‚æ•°åŒ–ï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒåˆ©ç”¨ä½ç§©è¡¨ç¤ºæ¥æœ€å°åŒ–å¯è®­ç»ƒå‚æ•°çš„æ•°é‡ã€‚Aghajanyan ç­‰äººï¼ˆ2020ï¼‰è¯æ˜äº†åœ¨ä½ç§©å­ç©ºé—´ä¸­å¯ä»¥æœ‰æ•ˆåœ°è¿›è¡Œå¾®è°ƒï¼Œå¯¹äºæ›´å¤§çš„æ¨¡å‹æˆ–ç»è¿‡æ›´é•¿æ—¶é—´é¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œéœ€è¦è¿›è¡Œè°ƒæ•´çš„å­ç©ºé—´æ›´å°ã€‚æœ€çŸ¥åçš„åŸºäºé‡å‚æ•°åŒ–çš„æ–¹æ³• &lt;code&gt;LoRa&lt;/code&gt; ï¼Œå®ƒå°†å‚æ•°çŸ©é˜µè¿›è¡Œç®€å•çš„ä½ç§©åˆ†è§£æ¥æ›´æ–°æƒé‡ã€‚æœ€è¿‘çš„ç ”ç©¶ï¼ˆKarimi Mahabadi ç­‰ï¼Œ2021ï¼›Edalati ç­‰ï¼Œ2022ï¼‰è¿˜æ¢ç´¢äº† &lt;code&gt;Kronecker product reparametrization&lt;/code&gt;  çš„ä½¿ç”¨ï¼Œå®ƒåœ¨ç§©å’Œå‚æ•°æ•°é‡ä¹‹é—´å–å¾—äº†æ›´æœ‰åˆ©çš„æƒè¡¡ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;LoRA&lt;/code&gt;  èƒŒåæœ‰ä¸€ä¸ªå‡è®¾ï¼šæˆ‘ä»¬ç°åœ¨çœ‹åˆ°çš„è¿™äº›å¤§è¯­è¨€æ¨¡å‹ï¼Œå®ƒä»¬éƒ½æ˜¯è¢«è¿‡åº¦å‚æ•°åŒ–çš„ã€‚è€Œè¿‡åº¦å‚æ•°åŒ–çš„å¤§æ¨¡å‹èƒŒåï¼Œéƒ½æœ‰ä¸€ä¸ªä½ç»´çš„æœ¬è´¨æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå¤§ç™½è¯è¯´ï¼šå¤§æ¨¡å‹å‚æ•°å¾ˆå¤šï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯å‘æŒ¥åŒæ ·ä½œç”¨çš„ï¼›å¤§æ¨¡å‹ä¸­æœ‰å…¶ä¸­ä¸€éƒ¨åˆ†å‚æ•°ï¼Œæ˜¯éå¸¸é‡è¦çš„ï¼Œæ˜¯å½±å“å¤§æ¨¡å‹ç”Ÿæˆç»“æœçš„å…³é”®å‚æ•°ï¼Œè¿™éƒ¨åˆ†å…³é”®å‚æ•°å°±æ˜¯ä¸Šé¢æåˆ°çš„ä½ç»´çš„æœ¬è´¨æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;LoRA&lt;/code&gt;  çš„åŸºæœ¬æ€è·¯ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ æ­¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆï¼Œè¦é€‚é…ç‰¹å®šçš„ä¸‹æ¸¸ä»»åŠ¡ï¼Œè¦è®­ç»ƒä¸€ä¸ªç‰¹å®šçš„æ¨¡å‹ï¼Œå°† &lt;code&gt;Y=WX&lt;/code&gt;  å˜æˆ &lt;code&gt;Y=(W+âˆ†W)X&lt;/code&gt; ï¼Œè¿™é‡Œé¢ &lt;code&gt;âˆ†W&lt;/code&gt;  ä¸»æ˜¯æˆ‘ä»¬è¦å¾®è°ƒå¾—åˆ°çš„ç»“æœï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œå°† &lt;code&gt;âˆ†W&lt;/code&gt;  è¿›è¡Œä½ç»´åˆ†è§£ &lt;code&gt;âˆ†W=AB&lt;/code&gt;  ( &lt;code&gt;âˆ†W&lt;/code&gt;  ä¸º &lt;code&gt;m*n&lt;/code&gt;  ç»´ï¼Œ &lt;code&gt;A&lt;/code&gt;  ä¸º &lt;code&gt;m*r&lt;/code&gt;  ç»´ï¼Œ &lt;code&gt;B&lt;/code&gt;  ä¸º &lt;code&gt;r*n&lt;/code&gt;  ç»´ï¼Œ &lt;code&gt;r&lt;/code&gt;  å°±æ˜¯ä¸Šè¿°å‡è®¾ä¸­çš„ä½ç»´)ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œç”¨ç‰¹å®šçš„è®­ç»ƒæ•°æ®ï¼Œè®­ç»ƒå‡º &lt;code&gt;A&lt;/code&gt;  å’Œ &lt;code&gt;B&lt;/code&gt;  å³å¯å¾—åˆ° &lt;code&gt;âˆ†W&lt;/code&gt; ï¼Œåœ¨æ¨ç†çš„è¿‡ç¨‹ä¸­ç›´æ¥å°† &lt;code&gt;âˆ†W&lt;/code&gt;  åŠ åˆ° &lt;code&gt;W&lt;/code&gt;  ä¸Šå»ï¼Œå†æ²¡æœ‰é¢å¤–çš„æˆæœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦å¤–ï¼Œå¦‚æœè¦ç”¨ &lt;code&gt;LoRA&lt;/code&gt;  é€‚é…ä¸åŒçš„åœºæ™¯ï¼Œåˆ‡æ¢ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œåšç®€å•çš„çŸ©é˜µåŠ æ³•å³å¯ï¼š &lt;code&gt;(W+âˆ†W)-âˆ†W+âˆ†W&#39;&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒè¯¥æ–¹æ³•è®¤ä¸ºæ¨¡å‹æƒé‡çŸ©é˜µåœ¨ç‰¹å®šå¾®è°ƒåå…·æœ‰è¾ƒä½çš„æœ¬å¾ç§©ï¼Œæ•…åŸºäºç§©åˆ†è§£çš„æ¦‚å¿µï¼Œå°†é¢„è®­ç»ƒæ¨¡å‹çš„ç°æœ‰æƒé‡çŸ©é˜µåˆ†æˆä¸¤ä¸ªè¾ƒå°çš„çŸ©é˜µã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/LLM_finetune/2.2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;24-hybrid-methods&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#24-hybrid-methods&#34;&gt;#&lt;/a&gt; 2.4 Hybrid methods&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒæ··åˆå¤šç§ &lt;code&gt;PEFT&lt;/code&gt;  æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œ &lt;code&gt;MAM Adapter&lt;/code&gt;  ç»“åˆäº† &lt;code&gt;Adapters&lt;/code&gt;  å’Œ &lt;code&gt;Prompt tuning&lt;/code&gt; ï¼› &lt;code&gt;UniPELT&lt;/code&gt;  åŠ å…¥äº† &lt;code&gt;LoRa&lt;/code&gt; ,  &lt;code&gt;Compacter&lt;/code&gt;  å’Œ &lt;code&gt;KronAB&lt;/code&gt;  å¯¹é€‚é…å™¨è¿›è¡Œäº†é‡å‚æ•°åŒ–ä»¥å‡å°‘å…¶å‚æ•°æ•°é‡ï¼›æœ€åï¼Œ &lt;code&gt;S4&lt;/code&gt;  æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–ç®—æ³•æœç´¢çš„ç»“æœï¼Œå®ƒç»“åˆäº†æ‰€æœ‰çš„ &lt;code&gt;PEFT&lt;/code&gt;  ç±»åˆ«ï¼Œé¢å¤–å‚æ•°æ•°é‡å¢åŠ  0.5% çš„æƒ…å†µä¸‹æœ€å¤§åŒ–å‡†ç¡®æ€§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;ä¸‰-ä½¿ç”¨llama-factoryå¾®è°ƒqwen2æ¨¡å‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸‰-ä½¿ç”¨llama-factoryå¾®è°ƒqwen2æ¨¡å‹&#34;&gt;#&lt;/a&gt; ä¸‰ã€ä½¿ç”¨ LLaMA-Factory å¾®è°ƒ Qwen2 æ¨¡å‹&lt;/h1&gt;
&lt;h2 id=&#34;31-è¿è¡Œqwen2æ¨¡å‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#31-è¿è¡Œqwen2æ¨¡å‹&#34;&gt;#&lt;/a&gt; 3.1 è¿è¡Œ Qwen2 æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒé¦–å…ˆè¿›å…¥ä¸‹è½½ Qwen2 çš„&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL1F3ZW5MTS9Rd2VuMg==&#34;&gt; github ç½‘é¡µ&lt;/span&gt;çš„è¿è¡Œæ–‡ä»¶ã€‚è¿è¡Œ &lt;code&gt;Qwen2/examples/demo/web_demo.py&lt;/code&gt;  å³å¯åœ¨ç½‘é¡µç«¯è¿è¡Œ &lt;code&gt;Qwen2&lt;/code&gt;  æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒè‹¥æœ¬åœ°æ²¡æœ‰å¤§æ¨¡å‹å‚æ•°æ–‡ä»¶ï¼Œåˆ™ä¼šä¸‹è½½ &lt;code&gt;hugging face&lt;/code&gt;  ä¸­çš„å‚æ•°æ–‡ä»¶ã€‚ä½†æ˜¯ &lt;code&gt;hugging face&lt;/code&gt;  ç”±äºç½‘ç»œåŸå› ä¼šå¯¼è‡´æ¨¡å‹ä¸‹è½½å¤±è´¥ã€‚å› æ­¤é€‰æ‹©å›½å†…çš„&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cubW9kZWxzY29wZS5jbi9teS9vdmVydmlldw==&#34;&gt; ModelScope&lt;/span&gt; ç½‘ç«™ä¸‹è½½æ‰€éœ€è¦çš„ &lt;code&gt;Qwen2&lt;/code&gt;  å¤§æ¨¡å‹å‚æ•°æ–‡ä»¶ã€‚æ‰¾åˆ°å¯¹åº”çš„æ¨¡å‹å‚æ•°æ–‡ä»¶ï¼Œä¾æ¬¡ç‚¹å‡»æ¨¡å‹æ–‡ä»¶ - ä¸‹è½½æ¨¡å‹ - SDK ä¸‹è½½ï¼Œå³å¯è·å¾—æ¨¡å‹å‚æ•°æ–‡ä»¶çš„ä¸‹è½½æ–¹å¼ï¼Œä¸€ä¸ªç¤ºä¾‹ä¸‹è½½çš„ &lt;code&gt;python&lt;/code&gt;  ç¨‹åºå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;#æ¨¡å‹ä¸‹è½½&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;from&lt;/span&gt; modelscope &lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; snapshot_download&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;model_dir &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; snapshot_download&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;qwen/Qwen2-1.5B-Instruct&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;â€ƒâ€ƒå¾…ä¸‹è½½å®Œæˆæ¨¡å‹æ–‡ä»¶åï¼Œæ›´æ”¹ &lt;code&gt;web_demo.py&lt;/code&gt;  æ–‡ä»¶çš„ &lt;code&gt;DEFAULT_CKPT_PATH&lt;/code&gt;  å‚æ•°ä¸ºæ‰€ä¸‹è½½æ¨¡å‹å‚æ•°æ–‡ä»¶çš„è·¯å¾„ï¼Œä¸€ä¸ªç¤ºä¾‹çš„è·¯å¾„ä¸ºï¼š &lt;code&gt;DEFAULT_CKPT_PATH = &#39;E:/python/9_LLM/2_FineTuning/4_Qwen/qwen/Qwen2-1___5B-Instruct&#39;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä¹‹åå³å¯æˆåŠŸè¿è¡Œ &lt;code&gt;web_demo.py&lt;/code&gt; ï¼Œå¹¶ä¸æ‰€ä¸‹è½½çš„å¤§æ¨¡å‹å‚æ•°æ–‡ä»¶å¯¹åº”çš„å¤§æ¨¡å‹è¿›è¡Œå¯¹è¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/LLM_finetune/3.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;32-ä¸‹è½½å¹¶è¿è¡Œllama-factory&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#32-ä¸‹è½½å¹¶è¿è¡Œllama-factory&#34;&gt;#&lt;/a&gt; 3.2 ä¸‹è½½å¹¶è¿è¡Œ LLaMA-Factory&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒé¦–å…ˆè¿›å…¥ &lt;code&gt;github&lt;/code&gt;  çš„&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2hpeW91Z2EvTExhTUEtRmFjdG9yeQ==&#34;&gt; LLaMA-Factory ç½‘é¡µ&lt;/span&gt;ï¼Œä¸‹è½½ &lt;code&gt;LLaMA-Factory&lt;/code&gt;  å·¥å…·ç®±ã€‚è¿è¡Œ &lt;code&gt;LLaMA-Factory-main/src/webui.py&lt;/code&gt;  å³å¯è¿è¡Œ &lt;code&gt;LLaMA-Factory&lt;/code&gt;  çš„ç½‘é¡µå¯è§†åŒ–ç•Œé¢ã€‚å¯è§†åŒ–ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/LLM_finetune/3.2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;33-å‡†å¤‡æ•°æ®é›†&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#33-å‡†å¤‡æ•°æ®é›†&#34;&gt;#&lt;/a&gt; 3.3 å‡†å¤‡æ•°æ®é›†&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨ &lt;code&gt;LLaMA-Factory-main/data&lt;/code&gt;  æ–‡ä»¶å¤¹ä¸‹ä¿å­˜äº†å‡ ç»„ç¤ºä¾‹æ•°æ®é›†çš„ &lt;code&gt;json&lt;/code&gt;  æ–‡ä»¶ã€‚å…¶ä¸­ &lt;code&gt;dataset_info.json&lt;/code&gt;  åŒ…å«äº†æ‰€æœ‰å¯ç”¨çš„æ•°æ®é›†ã€‚å‚è€ƒ&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2hpeW91Z2EvTExhTUEtRmFjdG9yeS9ibG9iL21haW4vZGF0YS9SRUFETUVfemgubWQ=&#34;&gt; LLaMA-Factory çš„è¯´æ˜æ–‡ä»¶&lt;/span&gt;ï¼Œå¦‚æœå¸Œæœ›ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®é›†ï¼Œéœ€è¦åœ¨ &lt;code&gt;dataset_info.json&lt;/code&gt;  æ–‡ä»¶ä¸­æ·»åŠ æ•°æ®é›†æè¿°ï¼Œç›®å‰ &lt;code&gt;LLaMA-Factory&lt;/code&gt;  ä»…æ”¯æŒ &lt;code&gt;alpaca&lt;/code&gt;  æ ¼å¼å’Œ &lt;code&gt;sharegpt&lt;/code&gt;  æ ¼å¼çš„æ•°æ®é›†ã€‚å®Œæ•´çš„æ•°æ®é›†æè¿°å¦‚ä¸‹ï¼Œå…·ä½“çš„ç¤ºä¾‹å¯ä»¥å‚è€ƒåˆå§‹ &lt;code&gt;dataset_info.json&lt;/code&gt;  æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight markdown&#34;&gt;&lt;figcaption data-lang=&#34;markdown&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&#34;æ•°æ®é›†åç§°&#34;: &amp;#123;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;hf_hub_url&#34;: &#34;Hugging Face çš„æ•°æ®é›†ä»“åº“åœ°å€ï¼ˆè‹¥æŒ‡å®šï¼Œåˆ™å¿½ç•¥ script_url å’Œ file_nameï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;ms_hub_url&#34;: &#34;ModelScope çš„æ•°æ®é›†ä»“åº“åœ°å€ï¼ˆè‹¥æŒ‡å®šï¼Œåˆ™å¿½ç•¥ script_url å’Œ file_nameï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;script_url&#34;: &#34;åŒ…å«æ•°æ®åŠ è½½è„šæœ¬çš„æœ¬åœ°æ–‡ä»¶å¤¹åç§°ï¼ˆè‹¥æŒ‡å®šï¼Œåˆ™å¿½ç•¥ file_nameï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;file_name&#34;: &#34;è¯¥ç›®å½•ä¸‹æ•°æ®é›†æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶çš„åç§°ï¼ˆè‹¥ä¸Šè¿°å‚æ•°æœªæŒ‡å®šï¼Œåˆ™æ­¤é¡¹å¿…éœ€ï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;formatting&#34;: &#34;æ•°æ®é›†æ ¼å¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤ï¼šalpacaï¼Œå¯ä»¥ä¸º alpaca æˆ– sharegptï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;ranking&#34;: &#34;æ˜¯å¦ä¸ºåå¥½æ•°æ®é›†ï¼ˆå¯é€‰ï¼Œé»˜è®¤ï¼šFalseï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;subset&#34;: &#34;æ•°æ®é›†å­é›†çš„åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;split&#34;: &#34;æ‰€ä½¿ç”¨çš„æ•°æ®é›†åˆ‡åˆ†ï¼ˆå¯é€‰ï¼Œé»˜è®¤ï¼štrainï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;folder&#34;: &#34;Hugging Face ä»“åº“çš„æ–‡ä»¶å¤¹åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;num_samples&#34;: &#34;è¯¥æ•°æ®é›†æ‰€ä½¿ç”¨çš„æ ·æœ¬æ•°é‡ã€‚ï¼ˆå¯é€‰ï¼Œé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;columnsï¼ˆå¯é€‰ï¼‰&#34;: &amp;#123;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;prompt&#34;: &#34;æ•°æ®é›†ä»£è¡¨æç¤ºè¯çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šinstructionï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;query&#34;: &#34;æ•°æ®é›†ä»£è¡¨è¯·æ±‚çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šinputï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;response&#34;: &#34;æ•°æ®é›†ä»£è¡¨å›ç­”çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šoutputï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;history&#34;: &#34;æ•°æ®é›†ä»£è¡¨å†å²å¯¹è¯çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;messages&#34;: &#34;æ•°æ®é›†ä»£è¡¨æ¶ˆæ¯åˆ—è¡¨çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šconversationsï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;system&#34;: &#34;æ•°æ®é›†ä»£è¡¨ç³»ç»Ÿæç¤ºçš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;tools&#34;: &#34;æ•°æ®é›†ä»£è¡¨å·¥å…·æè¿°çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;images&#34;: &#34;æ•°æ®é›†ä»£è¡¨å›¾åƒè¾“å…¥çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;chosen&#34;: &#34;æ•°æ®é›†ä»£è¡¨æ›´ä¼˜å›ç­”çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;rejected&#34;: &#34;æ•°æ®é›†ä»£è¡¨æ›´å·®å›ç­”çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šNoneï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;kto_tag&#34;: &#34;æ•°æ®é›†ä»£è¡¨ KTO æ ‡ç­¾çš„è¡¨å¤´åç§°ï¼ˆé»˜è®¤ï¼šNoneï¼‰&#34;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &amp;#125;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &#34;tagsï¼ˆå¯é€‰ï¼Œç”¨äº sharegpt æ ¼å¼ï¼‰&#34;: &amp;#123;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;role_tag&#34;: &#34;æ¶ˆæ¯ä¸­ä»£è¡¨å‘é€è€…èº«ä»½çš„é”®åï¼ˆé»˜è®¤ï¼šfromï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;27&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;content_tag&#34;: &#34;æ¶ˆæ¯ä¸­ä»£è¡¨æ–‡æœ¬å†…å®¹çš„é”®åï¼ˆé»˜è®¤ï¼švalueï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;28&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;user_tag&#34;: &#34;æ¶ˆæ¯ä¸­ä»£è¡¨ç”¨æˆ·çš„ role_tagï¼ˆé»˜è®¤ï¼šhumanï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;29&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;assistant_tag&#34;: &#34;æ¶ˆæ¯ä¸­ä»£è¡¨åŠ©æ‰‹çš„ role_tagï¼ˆé»˜è®¤ï¼šgptï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;30&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;observation_tag&#34;: &#34;æ¶ˆæ¯ä¸­ä»£è¡¨å·¥å…·è¿”å›ç»“æœçš„ role_tagï¼ˆé»˜è®¤ï¼šobservationï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;31&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;function_tag&#34;: &#34;æ¶ˆæ¯ä¸­ä»£è¡¨å·¥å…·è°ƒç”¨çš„ role_tagï¼ˆé»˜è®¤ï¼šfunction_callï¼‰&#34;,&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;32&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &#34;system_tag&#34;: &#34;æ¶ˆæ¯ä¸­ä»£è¡¨ç³»ç»Ÿæç¤ºçš„ role_tagï¼ˆé»˜è®¤ï¼šsystemï¼Œä¼šè¦†ç›– system columnï¼‰&#34;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;33&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &amp;#125;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;34&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&amp;#125;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;â€ƒâ€ƒæ·»åŠ å®Œæˆæ•°æ®é›†æè¿°åï¼Œå³å¯åœ¨åœ¨ &lt;code&gt;LLaMA-Factory-main/data&lt;/code&gt;  æ–‡ä»¶å¤¹å†…åˆ›å»ºå¯¹åº”æ•°æ®é›†åç§°çš„ &lt;code&gt;json&lt;/code&gt;  æ–‡ä»¶ï¼Œå³å¯å®Œæˆè‡ªå®šä¹‰æ•°æ®é›†çš„æ·»åŠ ã€‚æ•°æ®é›†çš„æ ¼å¼éœ€è¦å’Œæ•°æ®é›†æè¿°ä¸€è‡´ï¼Œè¯¦ç»†çš„ç¤ºä¾‹å¯ä»¥å‚è€ƒåˆå§‹åœ¨ &lt;code&gt;LLaMA-Factory-main/data&lt;/code&gt;  æ–‡ä»¶å¤¹ä¸‹çš„å…¶ä»– &lt;code&gt;json&lt;/code&gt;  æ•°æ®é›†æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;34-ä½¿ç”¨llama-factoryè¿›è¡Œå¤§æ¨¡å‹å¾®è°ƒ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#34-ä½¿ç”¨llama-factoryè¿›è¡Œå¤§æ¨¡å‹å¾®è°ƒ&#34;&gt;#&lt;/a&gt; 3.4 ä½¿ç”¨ LLaMA-Factory è¿›è¡Œå¤§æ¨¡å‹å¾®è°ƒ&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨å‡†å¤‡å¥½å¾®è°ƒçš„æ•°æ®é›†ä¹‹åï¼Œå³å¯å†æ¬¡è¿è¡Œ &lt;code&gt;LLaMA-Factory-main/src/webui.py&lt;/code&gt; ï¼Œå¯åŠ¨ LLaMA-Factory çš„å¯è§†åŒ–ç•Œé¢ï¼Œå…¶ä¸­çš„éƒ¨åˆ†å‚æ•°å®šä¹‰å¦‚ä¸‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ•°æ®è·¯å¾„åº”è¯¥æŒ‡å®šä¸ºæœ¬åœ°è®¡ç®—æœº &lt;code&gt;LLaMA-Factory-main/data&lt;/code&gt;  æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/LLM_finetune/3.2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå®šä¹‰å®Œæˆè®­ç»ƒå‚æ•°åå³å¯ç‚¹å‡» â€œå¼€å§‹â€ æŒ‰é’®ï¼Œå¼€å§‹æ¨¡å‹çš„å¾®è°ƒè®­ç»ƒã€‚æ¨¡å‹è®­ç»ƒå®Œæ¯•åï¼Œç‚¹å‡» &lt;code&gt;Chat&lt;/code&gt;  é€‰é¡¹å¡ï¼Œæ£€æŸ¥ç‚¹è·¯å¾„é€‰æ‹©è®­ç»ƒå¥½çš„å¤§æ¨¡å‹ï¼Œå³å¯å¼€å§‹ä¸å¾®è°ƒå®Œæˆçš„å¤§æ¨¡å‹è¿›è¡Œåœ¨çº¿å¯¹è¯ã€‚ç‚¹å‡» &lt;code&gt;Export&lt;/code&gt;  é€‰é¡¹å¡ï¼ŒæŒ‡å®šå¯¼å‡ºç›®å½•ä»¥åŠå…¶ä»–è®¾ç½®ï¼Œç‚¹å‡» â€œå¼€å§‹å¯¼å‡ºâ€ï¼Œå³å¯å¯¼å‡ºè®­ç»ƒå®Œæ¯•çš„å¤§æ¨¡å‹ã€‚è‡³æ­¤ï¼Œå·²ç»å®Œæˆä½¿ç”¨ &lt;code&gt;LLaMA-Factory&lt;/code&gt;  è¿›è¡Œå¤§æ¨¡å‹å¾®è°ƒçš„å…¨éƒ¨è¿‡ç¨‹ã€‚&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://qianqiu-cell.github.io/2024/07/23/AI/Prompt_engineering/</guid>
            <title>å¤§æ¨¡å‹æç¤ºè¯å·¥ç¨‹ï¼ˆPrompt Engineeringï¼‰</title>
            <link>http://qianqiu-cell.github.io/2024/07/23/AI/Prompt_engineering/</link>
            <category>AI</category>
            <pubDate>Tue, 23 Jul 2024 00:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;å‚è€ƒé“¾æ¥ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3dzeWFkYy9nZW5lcmF0aXZlLWFpLWZvci1iZWdpbm5lcnM=&#34;&gt;https://github.com/wsyadc/generative-ai-for-beginners&lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&#34;ä¸€-ä»€ä¹ˆæ˜¯æç¤ºè¯å·¥ç¨‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸€-ä»€ä¹ˆæ˜¯æç¤ºè¯å·¥ç¨‹&#34;&gt;#&lt;/a&gt; ä¸€ã€ä»€ä¹ˆæ˜¯æç¤ºè¯å·¥ç¨‹&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒæç¤ºå·¥ç¨‹è¢«å®šä¹‰ä¸ºè®¾è®¡å’Œä¼˜åŒ–æ–‡æœ¬è¾“å…¥ï¼ˆæç¤ºï¼‰ä»¥æä¾›ä¸€è‡´ä¸”é«˜è´¨é‡å“åº”ï¼ˆå®Œæˆï¼‰çš„è¿‡ç¨‹ï¼Œä»¥å®ç°ç‰¹å®šçš„åº”ç”¨ç›®æ ‡å’Œæ¨¡å‹ã€‚æç¤ºå·¥ç¨‹æ˜¯åˆ›å»ºå°†äº§ç”Ÿæ‰€éœ€ç»“æœçš„æç¤ºçš„è¿‡ç¨‹ã€‚ æç¤ºå·¥ç¨‹ä¸ä»…ä»…æ˜¯ç¼–å†™æ–‡æœ¬æç¤ºã€‚æç¤ºå·¥ç¨‹ä¸æ˜¯ä¸€é—¨å·¥ç¨‹å­¦ç§‘ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ç»„å¯ä»¥åº”ç”¨ä»¥è·å¾—æ‰€éœ€ç»“æœçš„æŠ€æœ¯ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªä¸¤æ­¥è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸ºç‰¹å®šæ¨¡å‹å’Œç›®æ ‡è®¾è®¡åˆå§‹æç¤º&lt;/li&gt;
&lt;li&gt;è¿­ä»£åœ°ä¼˜åŒ–æç¤ºä»¥æé«˜å“åº”è´¨é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒè¿™å¿…ç„¶æ˜¯ä¸€ä¸ªéœ€è¦ç”¨æˆ·ç›´è§‰å’ŒåŠªåŠ›çš„è¯•é”™è¿‡ç¨‹ï¼Œä»¥è·å¾—æœ€ä½³ç»“æœã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼Ÿè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ä¸‰ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tokenization = æ¨¡å‹å¦‚ä½• â€œçœ‹åˆ°â€ æç¤º&lt;/li&gt;
&lt;li&gt;Base LLMs = åŸºç¡€æ¨¡å‹å¦‚ä½• â€œå¤„ç†â€ æç¤º&lt;/li&gt;
&lt;li&gt;Instruction-Tuned LLMs = æ¨¡å‹ç°åœ¨å¦‚ä½•çœ‹åˆ° â€œä»»åŠ¡â€&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;äºŒ-ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æç¤ºè¯å·¥ç¨‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äºŒ-ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æç¤ºè¯å·¥ç¨‹&#34;&gt;#&lt;/a&gt; äºŒã€ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æç¤ºè¯å·¥ç¨‹&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒç°åœ¨æˆ‘ä»¬çŸ¥é“äº† LLMs å¦‚ä½•å¤„ç†æç¤ºï¼Œè®©æˆ‘ä»¬è°ˆè°ˆä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æç¤ºå·¥ç¨‹ã€‚ ç­”æ¡ˆåœ¨äºï¼Œå½“å‰çš„ LLMs çš„ç®—æ³•ä¹Ÿæœ‰è®¸å¤šæŒ‘æˆ˜ï¼Œå¦‚æœä¸åŠæ—¶ä¼˜åŒ–ï¼Œå°±å¾ˆéš¾å®ç° â€œå¯é ä¸”ä¸€è‡´çš„è¡¥å…¨â€ã€‚ ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;== æ¨¡å‹å“åº”æ˜¯éšæœºçš„ã€‚== ç›¸åŒçš„æç¤ºå¯èƒ½ä¼šé’ˆå¯¹ä¸åŒçš„æ¨¡å‹æˆ–æ¨¡å‹ç‰ˆæœ¬äº§ç”Ÿä¸åŒçš„å“åº”ã€‚ ç”šè‡³å¯èƒ½åœ¨ä¸åŒæ—¶é—´ä½¿ç”¨ç›¸åŒæ¨¡å‹äº§ç”Ÿä¸åŒçš„ç»“æœã€‚ æç¤ºå·¥ç¨‹æŠ€æœ¯å¯ä»¥é€šè¿‡æä¾›æ›´å¥½å¸®åŠ©æˆ‘ä»¬æœ€å¤§é™åº¦åœ°å‡å°‘è¿™äº›å˜åŒ–æ‰€å¸¦æ¥çš„å½±å“ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;== æ¨¡å‹å¯ä»¥äº§ç”Ÿå¹»è§‰å“åº”ã€‚== æ¨¡å‹æ˜¯ä½¿ç”¨å¤§å‹ä½†æœ‰é™æ•°æ®é›†è¿›è¡Œé¢„è®­ç»ƒçš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ç¼ºä¹æœ‰å…³è®­ç»ƒèŒƒå›´ä¹‹å¤–çš„æ¦‚å¿µçš„çŸ¥è¯†ã€‚ å› æ­¤ï¼Œå®ƒä»¬å¯èƒ½ä¼šäº§ç”Ÿä¸å‡†ç¡®ã€è™šæ„æˆ–ä¸å·²çŸ¥äº‹å®ç›´æ¥çŸ›ç›¾çš„å®Œæˆç»“æœã€‚ æç¤ºå·¥ç¨‹æŠ€æœ¯å¯ä»¥å¸®åŠ©ç”¨æˆ·è¯†åˆ«å’Œå‡è½»å¹»è§‰ï¼Œä¾‹å¦‚é€šè¿‡å‘äººå·¥æ™ºèƒ½è¯¢é—®å‡ºå¤„æˆ–æ¨ç†è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;== æ¨¡å‹åŠŸèƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ == è¾ƒæ–°çš„æ¨¡å‹æˆ–æ¨¡å‹è¿­ä»£å°†å…·æœ‰æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥ç‹¬ç‰¹çš„æ€ªç™–ä»¥åŠæˆæœ¬å’Œå¤æ‚æ€§æ–¹é¢çš„å¹³è¡¡ã€‚ æç¤ºå·¥ç¨‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¼€å‘æœ€ä½³å®è·µå’Œå·¥ä½œæµç¨‹ï¼Œä»¥å¯æ‰©å±•å’Œæ— ç¼çš„æ–¹å¼æ¶ˆé™¤å·®å¼‚å¹¶é€‚åº”ç‰¹å®šäºæ¨¡å‹çš„è¦æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸‰-æç¤ºå·¥ç¨‹çš„æŠ€å·§&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸‰-æç¤ºå·¥ç¨‹çš„æŠ€å·§&#34;&gt;#&lt;/a&gt; ä¸‰ã€æç¤ºå·¥ç¨‹çš„æŠ€å·§&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒç®€å•æç¤ºçš„å±€é™æ€§ï¼šç®€å•æç¤ºå¯èƒ½æ— æ³•å¾—åˆ°ä½ æƒ³è¦çš„ç»“æœï¼ŒåŸå› å¦‚ä¸‹ï¼šï¼ˆ1ï¼‰å¤§è¯é¢˜ï¼›ï¼ˆ2ï¼‰æ²¡æœ‰é™å®šè¾“å‡ºæ ¼å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›åŸºæœ¬æŠ€å·§æ¥æç¤º LLMã€‚&lt;/p&gt;
&lt;h2 id=&#34;31-zero-shot-prompting-é›¶æ ·æœ¬æç¤º&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#31-zero-shot-prompting-é›¶æ ·æœ¬æç¤º&#34;&gt;#&lt;/a&gt; 3.1 Zero-shot prompting ï¼ˆé›¶æ ·æœ¬æç¤ºï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒè¿™ç§æç¤ºé£æ ¼éå¸¸ç®€å•ï¼Œå®ƒåªæœ‰ä¸€ä¸ªæç¤ºã€‚å½“ä½ å¼€å§‹å­¦ä¹  LLM æ—¶ï¼Œå¯èƒ½å°±ä¼šç”¨åˆ°è¿™ç§æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prompt: â€œWhat is Algebra?â€&lt;/li&gt;
&lt;li&gt;Answer: â€œAlgebra is a branch of mathematics that studies mathematical symbols and the rules for manipulating these symbols.â€&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;32-few-shot-prompting-å°‘æ ·æœ¬æç¤º&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#32-few-shot-prompting-å°‘æ ·æœ¬æç¤º&#34;&gt;#&lt;/a&gt; 3.2 Few-shot prompting ï¼ˆå°‘æ ·æœ¬æç¤ºï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒè¿™ç§æç¤ºæ–¹å¼é€šè¿‡åœ¨æå‡ºè¯·æ±‚çš„åŒæ—¶æä¾›ä¸€äº›ç¤ºä¾‹æ¥å¸®åŠ©æ¨¡å‹ã€‚å®ƒç”±å•ä¸ªæç¤ºå’Œé™„åŠ çš„ç‰¹å®šä»»åŠ¡æ•°æ®ç»„æˆã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prompt: &amp;quot;ä»¥èå£«æ¯”äºšçš„é£æ ¼å†™ä¸€é¦–è¯—ã€‚ä¸‹é¢æ˜¯ä¸€äº›èå£«æ¯”äºšåå››è¡Œè¯—çš„ä¾‹å­ï¼šåå››è¡Œè¯—ç¬¬ 18 é¦–ï¼š&amp;quot; æˆ‘è¦æŠŠä½ æ¯”ä½œå¤æ—¥å—ï¼Ÿä½ æ›´å¯çˆ±ï¼Œæ›´æœ‰èŠ‚åˆ¶â€¦&#39; ç¬¬ 116 é¦–åå››è¡Œè¯—ï¼š&amp;quot; è®©æˆ‘ä¸è¦ä¸ºçœŸæ­£å¿ƒçµçš„ç»“åˆè®¾ç½®éšœç¢ã€‚çˆ±ä¸æ˜¯çˆ±ï¼Œå½“å®ƒå‘ç°æ”¹å˜æ—¶å°±ä¼šæ”¹å˜â€¦&#39; åå››è¡Œè¯—ç¬¬ 132 é¦–ï¼šâ€œæˆ‘çˆ±ä½ çš„çœ¼ç›ï¼Œå®ƒä»¬æ€œæ‚¯æˆ‘ï¼ŒçŸ¥é“ä½ çš„å¿ƒåœ¨æŠ˜ç£¨æˆ‘ï¼Œå¯¹æˆ‘ä¸å±‘ä¸€é¡¾â€¦ ç°åœ¨ï¼Œè¯·å†™ä¸€é¦–å…³äºæœˆäº®ä¹‹ç¾çš„åå››è¡Œè¯—ã€‚â€&lt;/li&gt;
&lt;li&gt;Answerï¼šâ€œåœ¨å¤©ç©ºä¸­ï¼Œæœˆäº®é—ªçƒç€æŸ”å’Œçš„å…‰èŠ’ï¼Œæ•£å‘ç€æ¸©æŸ”çš„å…‰è¾‰ï¼Œâ€¦â€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒç¤ºä¾‹ä¸º LLM æä¾›äº†æ‰€éœ€è¾“å‡ºçš„èƒŒæ™¯ã€æ ¼å¼æˆ–é£æ ¼ã€‚å®ƒä»¬æœ‰åŠ©äºæ¨¡å‹ç†è§£å…·ä½“ä»»åŠ¡ï¼Œå¹¶ç”Ÿæˆæ›´å‡†ç¡®ã€æ›´ç›¸å…³çš„å›å¤ã€‚&lt;/p&gt;
&lt;h2 id=&#34;33-chain-of-thought-cot-æ€ç»´é“¾&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#33-chain-of-thought-cot-æ€ç»´é“¾&#34;&gt;#&lt;/a&gt; 3.3 Chain-of-thought ï¼ˆCoT, æ€ç»´é“¾ï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒé“¾å¼æ€ç»´æ˜¯ä¸€ç§éå¸¸æœ‰è¶£çš„æŠ€æœ¯ï¼Œå› ä¸ºå®ƒæ¶‰åŠè®©å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ç»è¿‡ä¸€ç³»åˆ—æ­¥éª¤ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯ä»¥ä¸€ç§æ–¹å¼æŒ‡å¯¼ LLMï¼Œä½¿å…¶ç†è§£å¦‚ä½•å®ŒæˆæŸé¡¹ä»»åŠ¡ã€‚è¯·è€ƒè™‘ä»¥ä¸‹å¸¦æœ‰å’Œä¸å¸¦é“¾å¼æ€ç»´çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prompt: â€œAlice has 5 apples, throws 3 apples, gives 2 to Bob and Bob gives one back, how many apples does Alice have?â€&lt;/li&gt;
&lt;li&gt;Answer: 5&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒLLM ç»™å‡ºçš„ç­”æ¡ˆä¸º 5ï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚ æ ¹æ®è®¡ç®—ç»“æœ (5 -3 -2 + 1 = 1)ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ 1 ä¸ªè‹¹æœã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒé‚£ä¹ˆæˆ‘ä»¬æ€æ ·æ‰èƒ½æ•™ LLM æ­£ç¡®åœ°åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹æ€ç»´é“¾ã€‚ åº”ç”¨æ€ç»´é“¾æ„å‘³ç€ï¼š&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒç»™ LLM ä¸€ä¸ªç±»ä¼¼çš„ä¾‹å­ã€‚å±•ç¤ºè®¡ç®—ç»“æœï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®è®¡ç®—ã€‚æä¾›åŸå§‹æç¤ºã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prompt: â€œLisa has 7 apples, throws 1 apple, gives 4 apples to Bart and Bart gives one back: 7 -1 = 6 6 -4 = 2 2 +1 = 3&lt;br&gt;
Alice has 5 apples, throws 3 apples, gives 2 to Bob and Bob gives one back, how many apples does Alice have?â€&lt;/li&gt;
&lt;li&gt;Answer: 1&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒè¯·æ³¨æ„æˆ‘ä»¬å¦‚ä½•ç”¨å¦ä¸€ä¸ªç¤ºä¾‹ã€è®¡ç®—å’ŒåŸå§‹æç¤ºç¼–å†™æ›´é•¿çš„æç¤ºï¼Œç„¶åå¾—å‡ºæ­£ç¡®ç­”æ¡ˆ 1ã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæ€ç»´é“¾æ˜¯ä¸€ç§éå¸¸å¼ºå¤§çš„æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå…¶ä»–æ›´åŠ ä¸°å¯Œçš„ CoTï¼Œå¦‚é›¶æ ·æœ¬æ€ç»´é“¾ï¼Œè‡ªæ´½æ€§ç­‰å¯ä»¥å‚è€ƒ&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9wcm9tcHRkZXYuYWkvemgtSGFucy9kb2NzL2ludGVybWVkaWF0ZS9zZWxmX2NvbnNpc3RlbmN5&#34;&gt; https://promptdev.ai/zh-Hans/docs/intermediate/self_consistency&lt;/span&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;34-generated-knowledge-çŸ¥è¯†ç”Ÿæˆ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#34-generated-knowledge-çŸ¥è¯†ç”Ÿæˆ&#34;&gt;#&lt;/a&gt; 3.4 Generated knowledge ï¼ˆçŸ¥è¯†ç”Ÿæˆï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒç”Ÿæˆçš„çŸ¥è¯†æ–¹æ³•ï¼ˆGenerated Knowledge Approachï¼‰1 è¦æ±‚ LLM åœ¨ç”Ÿæˆå“åº”ä¹‹å‰ç”Ÿæˆä¸é—®é¢˜ç›¸å…³çš„å¯èƒ½æœ‰ç”¨çš„ä¿¡æ¯ã€‚è¯¥æ–¹æ³•ç”±ä¸¤ä¸ªä¸­é—´æ­¥éª¤ç»„æˆï¼Œå³&lt;mark&gt;çŸ¥è¯†ç”Ÿæˆå’ŒçŸ¥è¯†é›†æˆ&lt;/mark&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/Prompt_engineering/3.4.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ï¼ˆ1ï¼‰çŸ¥è¯†ç”Ÿæˆ&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨çŸ¥è¯†ç”Ÿæˆæ­¥éª¤ä¸­ï¼Œè¦æ±‚ LLM ç”Ÿæˆæœ‰å…³é—®é¢˜çš„ä¸€ç»„äº‹å®ã€‚å¤§è¯­è¨€æ¨¡å‹å°†ä»¥ few-shot æ–¹å¼è¿›è¡Œæç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ä½¿ç”¨ç›¸åŒæç¤ºç”Ÿæˆ M ä¸ªä¸åŒçš„å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/Prompt_engineering/3.4.2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ï¼ˆ2ï¼‰çŸ¥è¯†é›†æˆ&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”Ÿæˆ â€œçŸ¥è¯†å¢å¼ºâ€ é—®é¢˜ï¼Œå¹¶ç”¨å®ƒä»¬æç¤º LLM è·å¾—æœ€ç»ˆç­”æ¡ˆã€‚æœ€å¥½çš„ç†è§£æ–¹æ³•æ˜¯é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå‡è®¾æˆ‘ä»¬æ­£åœ¨å°è¯•å›ç­”é—®é¢˜ â€œå¤§å¤šæ•°è¢‹é¼ æœ‰ &lt;mask&gt; è‚¢ä½“â€ã€‚å‡è®¾åœ¨çŸ¥è¯†ç”Ÿæˆæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬ç”Ÿæˆäº† 2 ä¸ªçŸ¥è¯†ï¼ˆM=2ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;çŸ¥è¯† 1ï¼šâ€œè¢‹é¼ æ˜¯ç”Ÿæ´»åœ¨æ¾³å¤§åˆ©äºšçš„æœ‰è¢‹åŠ¨ç‰©ã€‚â€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çŸ¥è¯† 2ï¼šâ€œè¢‹é¼ æ˜¯æœ‰ 5 æ¡è‚¢ä½“çš„æœ‰è¢‹åŠ¨ç‰©ã€‚â€&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒç°åœ¨ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªçŸ¥è¯†ä¸é—®é¢˜è¿æ¥èµ·æ¥ï¼Œç”ŸæˆçŸ¥è¯†å¢å¼ºçš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;çŸ¥è¯†å¢å¼ºé—®é¢˜ 1ï¼šâ€œå¤§å¤šæ•°è¢‹é¼ æœ‰ &lt;mask&gt; è‚¢ä½“ã€‚è¢‹é¼ æ˜¯ç”Ÿæ´»åœ¨æ¾³å¤§åˆ©äºšçš„æœ‰è¢‹åŠ¨ç‰©ã€‚â€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çŸ¥è¯†å¢å¼ºé—®é¢˜ 2ï¼šâ€œå¤§å¤šæ•°è¢‹é¼ æœ‰ &lt;mask&gt; è‚¢ä½“ã€‚è¢‹é¼ æ˜¯æœ‰ 5 æ¡è‚¢ä½“çš„æœ‰è¢‹åŠ¨ç‰©ã€‚â€&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒç„¶åï¼Œæˆ‘ä»¬ç”¨è¿™äº›çŸ¥è¯†å¢å¼ºçš„é—®é¢˜æç¤º LLMï¼Œå¹¶è·å¾—æœ€ç»ˆç­”æ¡ˆçš„ææ¡ˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç­”æ¡ˆ 1ï¼šâ€œ4â€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç­”æ¡ˆ 2ï¼šâ€œ5â€&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒæˆ‘ä»¬é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„ç­”æ¡ˆä½œä¸ºæœ€ç»ˆç­”æ¡ˆã€‚æœ€é«˜æ¦‚ç‡å¯èƒ½æ˜¯ç­”æ¡ˆä»¤ç‰Œçš„ softmax æ¦‚ç‡ï¼Œæˆ–ç­”æ¡ˆä»¤ç‰Œçš„å¯¹æ•°æ¦‚ç‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;35-least-to-most-ltm-ä»å°‘åˆ°å¤š&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#35-least-to-most-ltm-ä»å°‘åˆ°å¤š&#34;&gt;#&lt;/a&gt; 3.5 Least to Most ï¼ˆLtM, ä»å°‘åˆ°å¤šï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒä»æœ€å°‘åˆ°æœ€å¤šæç¤º (LtM) 1 ä½¿ CoT æç¤ºæ›´è¿›ä¸€æ­¥ï¼Œé¦–å…ˆå°†é—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜ï¼Œç„¶åè§£å†³æ¯ä¸ªé—®é¢˜ã€‚è¿™æ˜¯ä¸€ç§å—ç°å®ä¸–ç•Œå„¿ç«¥æ•™è‚²ç­–ç•¥å¯å‘çš„æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä¸ CoT æç¤ºä¸€æ ·ï¼Œè¦è§£å†³çš„é—®é¢˜è¢«åˆ†è§£ä¸ºä¸€ç»„ç›¸äº’æ„å»ºçš„å­é—®é¢˜ã€‚ç¬¬äºŒæ­¥ï¼Œå°†è¿™äº›å­é—®é¢˜ä¸€ä¸€è§£å†³ã€‚ä¸æ€ç»´é“¾ç›¸åï¼Œå…ˆå‰å­é—®é¢˜çš„è§£å†³æ–¹æ¡ˆè¢«è¾“å…¥åˆ°å°è¯•è§£å†³ä¸‹ä¸€ä¸ªé—®é¢˜çš„æç¤ºä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/Prompt_engineering/3.5.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;36-self-refine-critique-the-results-è‡ªæˆ‘å®Œå–„è´¨ç–‘ç»“æœ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#36-self-refine-critique-the-results-è‡ªæˆ‘å®Œå–„è´¨ç–‘ç»“æœ&#34;&gt;#&lt;/a&gt; 3.6 Self-refine, critique the results ï¼ˆè‡ªæˆ‘å®Œå–„ï¼Œè´¨ç–‘ç»“æœï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒå¯¹äºç”Ÿæˆå¼äººå·¥æ™ºèƒ½å’Œ LLMsï¼Œä½ ä¸èƒ½ç›¸ä¿¡å…¶è¾“å‡ºã€‚ ä½ éœ€è¦éªŒè¯ä¸€ä¸‹ã€‚ æ¯•ç«Ÿï¼Œ LLMs åªæ˜¯å‘æ‚¨å±•ç¤ºä¸‹ä¸€ä¸ªæœ€æœ‰å¯èƒ½è¯´çš„è¯ï¼Œè€Œä¸æ˜¯æ­£ç¡®çš„å†…å®¹ã€‚ å› æ­¤ï¼Œä¸€ä¸ªå¥½ä¸»æ„æ˜¯è¦æ±‚ LLMs è‡ªæˆ‘æ‰¹è¯„ï¼Œè¿™å¼•å¯¼æˆ‘ä»¬è‡ªæˆ‘å®Œå–„æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå…¶å·¥ä½œåŸç†æ˜¯æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¦æ±‚ LLM è§£å†³é—®é¢˜çš„åˆå§‹æç¤º&lt;/li&gt;
&lt;li&gt;LLM äº§ç”Ÿç­”æ¡ˆ&lt;/li&gt;
&lt;li&gt;è´¨ç–‘ç­”æ¡ˆå¹¶è¦æ±‚äººå·¥æ™ºèƒ½æ”¹è¿›&lt;/li&gt;
&lt;li&gt;LLM å†æ¬¡å›ç­”ï¼Œè¿™æ¬¡è€ƒè™‘äº†è´¨ç–‘å¹¶æå‡ºäº†è§£å†³æ–¹æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒæ‚¨å¯ä»¥æ ¹æ®éœ€è¦å¤šæ¬¡é‡å¤æ­¤è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;37-maieutic-prompting-å¤šç»´åº¦çš„æç¤º&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#37-maieutic-prompting-å¤šç»´åº¦çš„æç¤º&#34;&gt;#&lt;/a&gt; 3.7 Maieutic prompting ï¼ˆå¤šç»´åº¦çš„æç¤ºï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒå¤šç»´åº¦çš„æç¤ºæ˜¯ä¸€ç§ç±»ä¼¼äºè‡ªæˆ‘å®Œå–„çš„æŠ€æœ¯ï¼Œä½†å®ƒæ›´å¤šçš„æ˜¯è¦æ±‚ LLMs è§£é‡Šè‡ªå·±ã€‚ ç›®æ ‡æ˜¯å‡å°‘ LLMs è¾“å‡ºä¸ä¸€è‡´ï¼Œä»¥ç¡®ä¿å¾—å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚ è¦éµå¾ªçš„å·¥ä½œæµç¨‹æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯· LLM å›ç­”é—®é¢˜&lt;/li&gt;
&lt;li&gt;å¯¹äºç­”æ¡ˆçš„æ¯ä¸€éƒ¨åˆ†ï¼Œè¯· LLM æ›´æ·±å…¥åœ°è§£é‡Šã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå­˜åœ¨ä¸ä¸€è‡´ï¼Œåˆ™ä¸¢å¼ƒä¸ä¸€è‡´çš„éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€ƒâ€ƒé‡å¤ 2 å’Œ 3ï¼Œç›´åˆ°æ‚¨å®Œæˆæ‰€æœ‰éƒ¨åˆ†å¹¶å¯¹ç­”æ¡ˆæ„Ÿåˆ°æ»¡æ„ä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å››-æç¤ºçš„å…³é”®è¦ç´ &#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å››-æç¤ºçš„å…³é”®è¦ç´ &#34;&gt;#&lt;/a&gt; å››ã€æç¤ºçš„å…³é”®è¦ç´ &lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨ä¹‹å‰çš„é¡µé¢ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†å‡ ç§ä¸åŒçš„æç¤ºç­–ç•¥ã€‚æœ¬é¡µå°†æä¾›ä¸€èˆ¬å»ºè®®ï¼Œè¿™äº›å»ºè®®å¯¹äºæç¤ºçš„å®é™…ç¼–å†™å¾ˆé‡è¦&lt;/p&gt;
&lt;p&gt;ï¼ˆ1ï¼‰åŸºæœ¬äº‹å®çš„é‡è¦æ€§ä¸å¤§&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œåœ¨æç¤ºä¸­æä¾›å°‘é‡ exemplars æ—¶ï¼Œå®é™…ç­”æ¡ˆ (gold) å¹¶ä¸é‡è¦ã€‚å³ä½¿åœ¨æ ·æœ¬ä¸­æä¾›éšæœºæ ‡ç­¾ï¼Œæ€§èƒ½ä¹Ÿå‡ ä¹ä¸å—å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆ2ï¼‰æ ‡ç­¾ç©ºé—´å¾ˆé‡è¦&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå°½ç®¡æ ·æœ¬ä¸­çš„é»„é‡‘æ ‡ç­¾å¹¶ä¸é‡è¦ï¼Œä½† labelspace å¾ˆé‡è¦ã€‚å³ä½¿ä»æ ‡ç­¾ç©ºé—´ä¸­æä¾›éšæœºæ ‡ç­¾ï¼Œä¹Ÿæœ‰åŠ©äºå¤§è¯­è¨€æ¨¡å‹æ›´å¥½åœ°ç†è§£æ ‡ç­¾ç©ºé—´å¹¶æé«˜ç»“æœã€‚æ­¤å¤–ï¼Œæ­£ç¡®åœ°åœ¨ç¤ºä¾‹ä¸­è¡¨ç¤ºæ ‡ç­¾ç©ºé—´çš„åˆ†å¸ƒå¾ˆé‡è¦ã€‚ä¸åœ¨ç¤ºä¾‹ä¸­ä»æ ‡ç­¾ç©ºé—´ä¸­å‡åŒ€é‡‡æ ·ä¸åŒï¼Œæœ€å¥½æŒ‰ç…§æ ‡ç­¾çš„çœŸå®åˆ†å¸ƒè¿›è¡Œé‡‡æ ·ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆ3ï¼‰æ ¼å¼å¾ˆé‡è¦&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒæ ·æœ¬çš„æ ¼å¼æˆ–è®¸æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒæŒ‡ç¤ºå¤§è¯­è¨€æ ¼å¼å¦‚ä½•æ­£ç¡®åœ°æ ¼å¼åŒ–å…¶å¯¹æç¤ºçš„ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä¾‹å¦‚ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹æ ·æœ¬ã€‚å®ƒä»¬ä½¿ç”¨å…¨å¤§å†™çš„å•è¯ä½œä¸ºç­”æ¡ˆã€‚å°½ç®¡è¿™äº›ç­”æ¡ˆå®Œå…¨é”™è¯¯ï¼ˆ2+2 ä¸æ˜¯ 50ï¼‰ï¼Œä½† GPT-3 æ­£ç¡®åœ°å›ç­”äº†æœ€åä¸€ä¸ªé—®é¢˜ï¼Œå¹¶æŒ‰ç…§å…¶ä»–æ ·æœ¬çš„æ ¼å¼è¿›è¡Œå›ç­”ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight markdown&#34;&gt;&lt;figcaption data-lang=&#34;markdown&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;2+2ç­‰äºå¤šå°‘ï¼Ÿ &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;äº”å&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;20+5ç­‰äºå¤šå°‘ï¼Ÿ&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;å››åä¸‰&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;12+9ç­‰äºå¤šå°‘ï¼Ÿ&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;äºŒåä¸€&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;â€ƒâ€ƒä»¥ä¸‹æ˜¯ä¸€äº›å€¼å¾—è€ƒè™‘çš„è‰¯å¥½åšæ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŒ‡å®šä¸Šä¸‹æ–‡ã€‚ ä¸Šä¸‹æ–‡å¾ˆé‡è¦ï¼Œæ‚¨å¯ä»¥æŒ‡å®šçš„é¢†åŸŸã€ä¸»é¢˜ç­‰è¶Šå¤šè¶Šå¥½ã€‚&lt;/li&gt;
&lt;li&gt;é™åˆ¶è¾“å‡ºã€‚ å¦‚æœæ‚¨æƒ³è¦ç‰¹å®šæ•°é‡çš„é¡¹ç›®æˆ–ç‰¹å®šé•¿åº¦ï¼Œè¯·æŒ‡å®šã€‚&lt;/li&gt;
&lt;li&gt;æŒ‡å®šå†…å®¹å’Œæ–¹å¼ã€‚ è¯·è®°ä½æåŠæ‚¨æƒ³è¦ä»€ä¹ˆä»¥åŠæ‚¨æƒ³è¦å¦‚ä½•å®ç°ï¼Œä¾‹å¦‚ â€œåˆ›å»ºä¸€ä¸ªåŒ…å«è·¯ç”±äº§å“å’Œå®¢æˆ·çš„ Python Web APIï¼Œå°†å…¶åˆ†ä¸º 3 ä¸ªæ–‡ä»¶â€ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ¨¡æ¿ã€‚ é€šå¸¸ï¼Œæ‚¨ä¼šå¸Œæœ›ä½¿ç”¨å…¬å¸çš„æ•°æ®æ¥ä¸°å¯Œæç¤ºã€‚ ä½¿ç”¨æ¨¡æ¿æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚ æ¨¡æ¿å¯ä»¥åŒ…å«ç”¨å®é™…æ•°æ®æ›¿æ¢çš„å˜é‡ã€‚&lt;/li&gt;
&lt;li&gt;æ‹¼å†™æ­£ç¡®ã€‚ LLMs å¯èƒ½ä¼šä¸ºæ‚¨æä¾›æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†å¦‚æœæ‚¨æ‹¼å†™æ­£ç¡®ï¼Œæ‚¨ä¼šå¾—åˆ°æ›´å¥½çš„ç­”æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;äº”-din-sqlå’Œpet-sql&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äº”-din-sqlå’Œpet-sql&#34;&gt;#&lt;/a&gt; äº”ã€DIN-SQL å’Œ PET-SQL&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒç”¨äºå‚èµ›ã€Šä¸­å…´æ§æœˆå¤§èµ› - ç²¾è¨€å¦™å–»ã€‹ï¼Œä¸»è¦å‚è€ƒè®ºæ–‡æœ‰ DIN-SQLï¼šã€ŠDIN-SQL: Decomposed In-Context Learning of Text-to-SQL with Self-Correctionã€‹ï¼ŒPET-SQLï¼šã€ŠPET-SQL: A Prompt-Enhanced Two-Round Refinement of Text-to-SQL with Cross-consistencyã€‹ã€‚ä¸¤ç¯‡è®ºæ–‡çš„ä¸»è¦æ€è·¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/Prompt_engineering/5.1.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;å…­-ä¸­å…´æ§æœˆå¤§èµ›-ç²¾è¨€å¦™å–»ä¸ªäººåˆèµ›ä»£ç åŠæ€è·¯&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å…­-ä¸­å…´æ§æœˆå¤§èµ›-ç²¾è¨€å¦™å–»ä¸ªäººåˆèµ›ä»£ç åŠæ€è·¯&#34;&gt;#&lt;/a&gt; å…­ã€ã€Šä¸­å…´æ§æœˆå¤§èµ› - ç²¾è¨€å¦™å–»ã€‹ä¸ªäººåˆèµ›ä»£ç åŠæ€è·¯&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒå…·ä½“æ–‡ä»¶å¯è§ U ç›˜å¤‡ä»½â€“&amp;gt; ç§‘ç ”æ–‡ä»¶â€“&amp;gt;9ã€ç¬¬åå››å±Šä¸­å…´æ§æœˆå…¨çƒç²¾è‹±æŒ‘æˆ˜èµ›ç­‰ã€‚&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://qianqiu-cell.github.io/2024/05/16/AI/Transformer/</guid>
            <title>Transformeræ¨¡å‹</title>
            <link>http://qianqiu-cell.github.io/2024/05/16/AI/Transformer/</link>
            <category>AI</category>
            <pubDate>Thu, 16 May 2024 00:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;&lt;img data-src=&#34;/images/AI/Transformer/0.1.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒé“¾æ¥ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93YXlsYW5kemhhbmcuZ2l0aHViLmlvL2VuL3RyYW5zZm9ybWVyLWFyY2hpdGVjdHVyZS5odG1sIzQtNy1jYWxjdWxhdGUtdi1hdHRlbnRpb24=&#34;&gt;https://waylandzhang.github.io/en/transformer-architecture.html#4-7-calculate-v-attention&lt;/span&gt;ã€&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMzU0NjYxMTUyNzQ1MzE2MT9zcG1faWRfZnJvbT0zMzMuNzg4LjAuMA==&#34;&gt;https://space.bilibili.com/3546611527453161?spm_id_from=333.788.0.0&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;Transformer&lt;/code&gt;  æ¨¡å‹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç¼–ç å™¨å’Œè§£ç å™¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»…ç¼–ç å™¨çš„æ¶æ„ç²¾é€šäºä»æ–‡æœ¬ä¸­æå–ä¿¡æ¯ï¼Œç”¨äºåˆ†ç±»å’Œå›å½’ç­‰ä»»åŠ¡ï¼Œè€Œä»…è§£ç å™¨çš„æ¨¡å‹ä¸“é—¨ç”¨äºç”Ÿæˆæ–‡æœ¬ã€‚ä¾‹å¦‚ï¼Œ&lt;mark&gt;ä¸“æ³¨äºæ–‡æœ¬ç”Ÿæˆçš„ &lt;code&gt;GPT&lt;/code&gt;  å±äºä»…è§£ç å™¨æ¨¡å‹çš„ç±»åˆ«&lt;/mark&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;Transformer&lt;/code&gt;  çš„å¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç³»åˆ—è¾“å…¥å­—ç¬¦ä½œä¸ºè®­ç»ƒæ•°æ®ã€‚è¿™äº›è¾“å…¥è¢«è½¬æ¢æˆçŸ¢é‡åµŒå…¥æ ¼å¼ã€‚&lt;/li&gt;
&lt;li&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½ç½®ç¼–ç æ·»åŠ åˆ°çŸ¢é‡åµŒå…¥ä¸­ï¼Œä»¥æ•è·åºåˆ—ä¸­æ¯ä¸ªå­—ç¬¦çš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;éšåï¼Œè¯¥æ¨¡å‹é€šè¿‡ä¸€ç³»åˆ—è®¡ç®—æ“ä½œå¤„ç†è¿™äº›è¾“å…¥åµŒå…¥ï¼Œæœ€ç»ˆä¸ºç»™å®šçš„è¾“å…¥æ–‡æœ¬ç”Ÿæˆå¯èƒ½çš„ä¸‹ä¸€ä¸ªå­—ç¬¦çš„æ¦‚ç‡åˆ†å¸ƒã€‚&lt;/li&gt;
&lt;li&gt;è¯¥æ¨¡å‹æ ¹æ®è®­ç»ƒæ•°æ®é›†ä¸­çš„å®é™…åç»­ç‰¹å¾æ¥è¯„ä¼°é¢„æµ‹ç»“æœï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´æ¦‚ç‡æˆ– â€œæƒé‡â€ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œè¯¥æ¨¡å‹è¿­ä»£åœ°ç»†åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œä¸æ–­æ›´æ–°å…¶å‚æ•°ï¼Œä»¥æé«˜æœªæ¥é¢„æµ‹çš„ç²¾åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ä¸€-tokenizer&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸€-tokenizer&#34;&gt;#&lt;/a&gt; ä¸€ã€Tokenizer&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;Tokenizer&lt;/code&gt;  åˆ†è¯ç®—æ³•æ˜¯ &lt;code&gt;NLP&lt;/code&gt;  å¤§æ¨¡å‹æœ€åŸºç¡€çš„ç»„ä»¶ï¼ŒåŸºäº &lt;code&gt;Tokenizer&lt;/code&gt;  å¯ä»¥&lt;mark&gt;å°†æ–‡æœ¬è½¬æ¢æˆç‹¬ç«‹çš„ &lt;code&gt;token&lt;/code&gt;  åˆ—è¡¨ï¼Œè¿›è€Œè½¬æ¢æˆè¾“å…¥çš„å‘é‡æˆä¸ºè®¡ç®—æœºå¯ä»¥ç†è§£çš„è¾“å…¥å½¢å¼&lt;/mark&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;tiktoken&lt;/code&gt;  æ˜¯ä¸€ç§å¿«é€Ÿ  &lt;code&gt;BPE&lt;/code&gt;  æ ‡è®°å™¨ï¼Œå¯ä¸ &lt;code&gt;OpenAI&lt;/code&gt;  æ¨¡å‹ä¸€èµ·ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;tiktoken&lt;/code&gt;  ä½¿ç”¨æ–¹æ³•ä¸ºï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; tiktoken&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Using TikToken (Same as GPT3) to tokenize the source text&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;encoding &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tiktoken&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;get_encoding&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;cl100k_base&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# text ä¿å­˜äº† str å˜é‡ç±»å‹çš„æ–‡æœ¬å†…å®¹ --&gt; è¾“å‡ºä¸ºä»¥å•è¯ä¸ºå•ä½çš„ int åˆ—è¡¨&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;tokenized_text &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; encoding&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;encode&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;text&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# å°† tokenized_text è½¬æ¢ä¸º Tensor.int64 ç±»å‹çš„å¼ é‡&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;tokenized_text &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tensor&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dtype&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; device&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;â€ƒâ€ƒä¸Šè¿°çš„ä»£ç æä¾›äº† &lt;code&gt;encoding&lt;/code&gt;  çš„ç¼–ç è¿‡ç¨‹ï¼ŒåŒæ—¶è¿˜å¯ä»¥æ ¹æ® &lt;code&gt;tokenized&lt;/code&gt;  çš„ç¼–ç ç»“æœè¿›è¡Œè§£ç ï¼Œåªéœ€è¦é€šè¿‡ &lt;code&gt;decode&lt;/code&gt;  å‡½æ•°è¾“å…¥ &lt;code&gt;int&lt;/code&gt;  ç±»å‹çš„åˆ—è¡¨é›†åˆè¿”å›åŸå§‹çš„ str ç±»å‹æ–‡æœ¬&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# è¾“å‡ºå•ä¸ªç¼–ç å¯¹åº”çš„ str æ–‡æœ¬&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;encoding&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;decode&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# è¾“å‡ºå¤šä¸ªç¼–ç å¯¹åº”çš„ str æ–‡æœ¬&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;encoding&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;decode&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tolist&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h1 id=&#34;äºŒ-embedding&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äºŒ-embedding&#34;&gt;#&lt;/a&gt; äºŒã€Embedding&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;Tokenize&lt;/code&gt;  å®Œçš„ä¸‹ä¸€æ­¥å°±æ˜¯å°† &lt;code&gt;token&lt;/code&gt;  çš„ &lt;code&gt;one-hot&lt;/code&gt;  ç¼–ç è½¬æ¢æˆæ›´ &lt;code&gt;dense&lt;/code&gt;  çš„ &lt;code&gt;embedding&lt;/code&gt;  ç¼–ç ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;Embedding&lt;/code&gt;  çŸ©é˜µçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªæŸ¥æ‰¾è¡¨ã€‚ç”±äºè¾“å…¥å‘é‡æ˜¯ &lt;code&gt;one-hot&lt;/code&gt;  çš„ï¼Œ &lt;code&gt;embedding&lt;/code&gt;  çŸ©é˜µä¸­æœ‰ä¸”ä»…æœ‰ä¸€è¡Œè¢«æ¿€æ´»ã€‚è¡Œé—´äº’ä¸å¹²æ‰°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡è®¾è¯æ±‡è¡¨ä¸€å…±æœ‰ &lt;code&gt;6&lt;/code&gt;  ä¸ªè¯ï¼Œåˆ™ &lt;code&gt;one-hot&lt;/code&gt;  è¡¨ç¤ºçš„é•¿åº¦ä¸º &lt;code&gt;6&lt;/code&gt; ã€‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸‰ä¸ªå•è¯ç»„æˆä¸€ä¸ªå¥å­ï¼Œåˆ™è¾“å…¥çŸ©é˜µçš„å½¢çŠ¶ä¸º &lt;code&gt;(3,6)&lt;/code&gt;  ã€‚ç„¶åæˆ‘ä»¬å­¦å‡ºæ¥ä¸€ä¸ª &lt;code&gt;embedding&lt;/code&gt;  çŸ©é˜µï¼Œæ ¹æ®ä¸Šé¢çš„æ¨å¯¼ï¼Œå¦‚æœæˆ‘ä»¬çš„ &lt;code&gt;embedding size&lt;/code&gt; ï¼ˆç¼–ç å‘é‡çš„é•¿åº¦ï¼‰ä¸º &lt;code&gt;4&lt;/code&gt; ï¼Œåˆ™ &lt;code&gt;embedding&lt;/code&gt;  çŸ©é˜µçš„å½¢çŠ¶åº”è¯¥ä¸º &lt;code&gt;(6,4)&lt;/code&gt; ã€‚è¿™æ ·ä¹˜å‡ºæ¥çš„è¾“å‡ºçŸ©é˜µçš„å½¢çŠ¶åº”ä¸º &lt;code&gt;(3,4)&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/Transformer/2.1.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå¯¹äºç¬¬ä¸€ä¸ªå•è¯ &lt;code&gt;I&lt;/code&gt; ï¼Œå‡è®¾å…¶ &lt;code&gt;one-hot&lt;/code&gt;  ç¼–ç ä¸º &lt;code&gt;[0,0,1,0,0,0]&lt;/code&gt; ï¼Œå°†å…¶ä¸ &lt;code&gt;embedding&lt;/code&gt;  çŸ©é˜µç›¸ä¹˜ï¼Œç›¸å½“äºå–å‡º &lt;code&gt;embedding&lt;/code&gt;  çŸ©é˜µçš„ç¬¬ &lt;code&gt;3&lt;/code&gt;  è¡Œï¼ˆ &lt;code&gt;index&lt;/code&gt;  ä¸º &lt;code&gt;2&lt;/code&gt; ï¼‰ã€‚åŒç†ï¼Œå¯¹äºå•è¯ &lt;code&gt;love&lt;/code&gt; ï¼Œç›¸å½“äºå–å‡º &lt;code&gt;embedding&lt;/code&gt;  çŸ©é˜µçš„ç¬¬äºŒè¡Œï¼ˆ &lt;code&gt;index&lt;/code&gt;  ä¸º &lt;code&gt;1&lt;/code&gt; ï¼‰ã€‚å› æ­¤ &lt;code&gt;embedding&lt;/code&gt;  çŸ©é˜µçš„æœ¬è´¨æ˜¯ä¸€ä¸ªæŸ¥æ‰¾è¡¨ï¼Œæ¯ä¸ªå•è¯ä¼šå®šä½è¿™ä¸ªè¡¨ä¸­çš„æŸä¸€è¡Œï¼Œè€Œè¿™ä¸€è¡Œå°±æ˜¯è¿™ä¸ªå•è¯å­¦ä¹ åˆ°çš„åœ¨åµŒå…¥ç©ºé—´çš„è¯­ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒé¦–å…ˆå‡†å¤‡æ‰€éœ€è¦çš„æ•°æ®ï¼Œåœ¨ transformer çš„è§£ç å™¨ä¸­ï¼Œéœ€è¦è¾“å…¥ &lt;code&gt;n_batch * context_length * d_model&lt;/code&gt;  ç»´åº¦çš„ &lt;code&gt;Tensor&lt;/code&gt;  æ•°æ®ï¼Œå…¶ä¸­ &lt;code&gt;n_batch&lt;/code&gt;  è¡¨ç¤ºæ‰¹æ¬¡å¤§å°ï¼Œ &lt;code&gt;contex_length&lt;/code&gt;  è¡¨ç¤ºä¸€æ¬¡è¾“å…¥çš„å•æ¬¡æ•°é‡ï¼Œ &lt;code&gt;d_model&lt;/code&gt;  è¡¨ç¤ºç¼–ç å‘é‡çš„é•¿åº¦ã€‚å°† &lt;code&gt;Tokenizer&lt;/code&gt;  ä¸­è·å¾—çš„ &lt;code&gt;tokenized_text&lt;/code&gt;  è¿›è¡Œæ•°æ®é¢„å¤„ç†ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Split train and validation&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;split_idx &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0.9&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;train_data &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;split_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;val_data &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;split_idx&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Get input embedding batch&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;data &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; train_data&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;idxs &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;randint&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;low&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; high&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;data&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt; context_length&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; size&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;batch_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;x_batch &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;stack&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;data&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;idx&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;idx &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; context_length&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; idx &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; idxs&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;y_batch &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;stack&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;data&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;idx &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;idx &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; context_length &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; idx &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; idxs&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;â€ƒâ€ƒä¹‹åä¾¿å¯ä»¥åˆ©ç”¨ &lt;code&gt;torch&lt;/code&gt;  ä¸­çš„ &lt;code&gt;nn.Embedding&lt;/code&gt;  å‡½æ•°æ„é€  &lt;code&gt;Embedding&lt;/code&gt;  å±‚ã€‚å…¶ä¸­ &lt;code&gt;Embedding.weight.data&lt;/code&gt;  æ˜¯ä¸€ä¸ª &lt;code&gt;max_token_value * d_model&lt;/code&gt;  ç»´åº¦çš„ &lt;code&gt;Tensor&lt;/code&gt;  å˜é‡ï¼Œæ˜¯æ¨¡å‹éœ€è¦è®­ç»ƒçš„å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸Šå›¾ä¸­å¯¹åº”çš„ &lt;code&gt;Embedding&lt;/code&gt;  æŸ¥æ‰¾è¡¨ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# define input embedding table&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# è·å– tokenized_text ä¸­çš„æœ€å¤§å€¼ + 1ï¼Œç”¨äºæ„é€  Embedding çš„è¡Œ&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;max_token_value &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;max&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;item&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# ä½¿ç”¨ nn.Embedding å‡½æ•°æ„é€  Embedding å±‚&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# `Embedding.weight.data` æ˜¯ä¸€ä¸ª `max_token_value * d_model` ç»´åº¦çš„ `Tensor` å˜é‡&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;token_embedding_lookup_table &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Embedding&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;num_embeddings&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;max_token_value&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; embedding_dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; device&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# é€šè¿‡è¾“å…¥ x_batch æˆ– y_batch å³å¯è·å¾—å¯¹åº”çš„ Embedding ç¼–ç ç»“æœ&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# x_batch_embedding å’Œ y_batch_embedding æ˜¯ `n_batch * context_length * d_model` ç»´åº¦çš„ `Tensor` æ•°æ®&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;x_batch_embedding &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; token_embedding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x_batch&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;y_batch_embedding &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; token_embedding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;y_batch&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h1 id=&#34;ä¸‰-position-encoding&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸‰-position-encoding&#34;&gt;#&lt;/a&gt; ä¸‰ã€Position Encoding&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨ &lt;code&gt;transformer&lt;/code&gt;  çš„ &lt;code&gt;encoder&lt;/code&gt;  å’Œ &lt;code&gt;decoder&lt;/code&gt;  çš„è¾“å…¥å±‚ä¸­ï¼Œå‡ä½¿ç”¨äº† &lt;code&gt;Positional Encoding&lt;/code&gt; ï¼Œä½¿å¾—æœ€ç»ˆçš„è¾“å…¥æ»¡è¶³ï¼š &lt;code&gt;input = input_embedding + positional_encoding&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;Transformer&lt;/code&gt;  ä½ç½®ç¼–ç çš„å®šä¹‰ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/Transformer/3.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå®ç°ä½ç½®ç¼–ç çš„ä»£ç ä¸ºï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# get positional encoding&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;position_encoding_lookup_table &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;zeros&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;context_length&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# unsqueeze ç”¨æ¥æ‰©å……ä¸€ä¸ªç»´åº¦ï¼Œä¸ºäº†åé¢çš„é€å…ƒç´ è®¡ç®—æ—¶çš„å¹¿æ’­æœºåˆ¶&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;position &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;arange&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; context_length&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dtype&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;unsqueeze&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# æ ¹æ®å…¬å¼è®¡ç®—ä½ç½®ç¼–ç &lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;div_term &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;exp&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;arange&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;math&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;log&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;10000.0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt; d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;position_encoding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;sin&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;position &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; div_term&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;position_encoding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;cos&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;position &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; div_term&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# å°† context_length*d_model çš„çŸ©é˜µå¤åˆ¶ n_epoch æ¬¡ï¼Œå½¢æˆ n_epoch*context_length*d_model çš„çŸ©é˜µ&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;position_encoding_lookup_table &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; position_encoding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;unsqueeze&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;expand&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;batch_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;â€ƒâ€ƒåœ¨è·å¾—ä½ç½®ç¼–ç ä¹‹åå³å¯å°†ä½ç½®ç¼–ç ä¸ &lt;code&gt;Embedding&lt;/code&gt;  è¿›è¡Œç›¸åŠ ï¼Œè·å¾—æœ€ç»ˆè¾“å…¥è‡³ç½‘ç»œçš„è¾“å…¥ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# add positional encoding to the input_embedding&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;x &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; x_batch_embedding &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; position_encoding_lookup_table&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;y &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; y_batch_embedding &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; position_encoding_lookup_table&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h1 id=&#34;å››-transformer-block&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å››-transformer-block&#34;&gt;#&lt;/a&gt; å››ã€Transformer Block&lt;/h1&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/Transformer/4.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒé€šè¿‡ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬è·å¾—äº†è¾“å…¥ &lt;code&gt;x&lt;/code&gt; ï¼Œä¸‹ä¸€æ­¥æ˜¯å¼€å§‹å®ç°å¤šå¤´æ³¨æ„åŠ›å—ï¼ˆ &lt;code&gt;Muti-head Attention block&lt;/code&gt; ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;Transformer&lt;/code&gt;  æ¨¡å‹çš„å¼ºå¤§æ¥æºäº &lt;code&gt;self-attention&lt;/code&gt; ï¼Œé€šè¿‡ &lt;code&gt;self-attention&lt;/code&gt; ï¼Œ &lt;code&gt;Transformer&lt;/code&gt;  æ¨¡å‹å¯ä»¥å…³æ³¨åˆ° &lt;code&gt;input&lt;/code&gt;  æ›´åŠ é‡è¦çš„éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;Multi-head attention&lt;/code&gt;  ç”±å‡ ä¸ªå•ç‹¬çš„ &lt;code&gt;heads&lt;/code&gt;  å †å åœ¨ä¸€èµ·ç»„æˆã€‚æ‰€æœ‰ heads éƒ½æ¥æ”¶åˆ°å®Œå…¨ç›¸åŒçš„è¾“å…¥ï¼Œå°½ç®¡å®ƒä»¬åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä½¿ç”¨äº†è‡ªå·±çš„ç‰¹å®šæƒé‡é›†ã€‚åœ¨å¤„ç†è¾“å…¥ä¹‹åï¼Œæ¥è‡ªæ‰€æœ‰ &lt;code&gt;heads&lt;/code&gt;  çš„è¾“å‡ºè¢«çº§è”ï¼Œç„¶åé€šè¿‡çº¿æ€§å±‚ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ &lt;code&gt;heads&lt;/code&gt;  çš„å·¥ä½œæ–¹å¼æ˜¯é€šè¿‡ä¸‰ä¸ªç‹¬ç‰¹çš„å±‚å¤„ç†ï¼Œå³æŸ¥è¯¢ï¼ˆ &lt;code&gt;Q&lt;/code&gt; ï¼‰ã€é”®ï¼ˆ &lt;code&gt;K&lt;/code&gt; ï¼‰å’Œå€¼ï¼ˆ &lt;code&gt;V&lt;/code&gt; ï¼‰ã€‚ &lt;code&gt;Attention&lt;/code&gt;  çš„è®¡ç®—å…¬å¼å¯ä»¥ä»è®ºæ–‡ã€Š &lt;code&gt;Attention is all you need&lt;/code&gt; ã€‹ä¸­å¾—åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/images/AI/Transformer/4.2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# get Q, K, V&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# æ‰€è°“çš„å¤šå¤´å°±æ˜¯æŠŠ d_model åˆ‡æˆå¤šä»½ï¼Œæ¯ä¸€ä¸ªå¤´é‡Œé¢æœ‰ä¸€éƒ¨åˆ†ç»´åº¦ï¼Œç„¶åå»åšè¿™ä¸€éƒ¨åˆ†çš„è®¡ç®—ï¼Œæœ€åå†æŠŠæ‰€æœ‰çš„è®¡ç®—åˆå¹¶åœ¨ä¸€èµ·&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;head_size &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; d_model &lt;span class=&#34;token operator&#34;&gt;//&lt;/span&gt; num_heads  &lt;span class=&#34;token comment&#34;&gt;# head size should be divisible by d_model&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# (1) è®¡ç®— Q,K,V çŸ©é˜µ&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;key_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bias&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; device&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;query_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bias&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; device&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;value_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bias&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; device&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# [batch_size, context_length, d_model]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;q &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; query_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;k &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; key_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;v &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; value_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# [batch_size, context_length, num_heads, head_size]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;q &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; q&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;view&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;batch_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; num_heads&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; head_size&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;k &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; k&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;view&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;batch_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; num_heads&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; head_size&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;v &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; v&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;view&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;batch_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; num_heads&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; head_size&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# [batch_size, num_heads, context_length, head_size]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;q &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; q&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;transpose&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;k &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; k&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;transpose&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;v &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; v&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;transpose&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# (2) é€šè¿‡ Q @ K^T /sqrt (d_k) è®¡ç®— Attention&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;attention_score &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;q @ k&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;transpose&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1.0&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt; math&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;sqrt&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;head_size&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# (3) è®¡ç®— Mask&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;mask &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;triu&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;ones&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;context_length&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; context_length&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; diagonal&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;attention_score &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; attention_score&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;masked_fill&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;mask&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;-inf&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# (4) è®¡ç®— Softmax&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# [batch_size, num_heads, context_length, context_length]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;27&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;attention_score &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; F&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;softmax&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;attention_score&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;28&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# (5) é€šè¿‡ $V è®¡ç®— A&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;29&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# [batch_size, num_heads, context_length, head_size]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;30&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;A &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; attention_score @ v&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;31&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# (6) è®¡ç®— Concatenate&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;32&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# [batch_size, context_length, num_heads, head_size]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;33&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;A &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; A&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;transpose&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;34&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# [batch_size, context_length, d_model]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;35&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;A &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; A&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;reshape&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;batch_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;36&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# (7) é€šè¿‡ Wo è®¡ç®— Output&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;37&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Define the output weight matrix&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;38&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Wo &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;39&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# [batch_size, context_length, d_model]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;40&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; Wo&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;A&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h1 id=&#34;äº”-residual-connection-and-layer-normalization&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äº”-residual-connection-and-layer-normalization&#34;&gt;#&lt;/a&gt; äº”ã€Residual Connection and Layer Normalization&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒæ®‹å·®è¿æ¥ï¼Œæœ‰æ—¶è¢«ç§°ä¸º &lt;code&gt;skip connection&lt;/code&gt; ï¼Œæ˜¯è®©åŸå§‹è¾“å…¥ &lt;code&gt;X&lt;/code&gt;  ç»•è¿‡ä¸€ä¸ªæˆ–å¤šä¸ªå±‚çš„è¿æ¥ã€‚é€šè¿‡å°†åŸå§‹è¾“å…¥ &lt;code&gt;x&lt;/code&gt;  ä¸æ­¥éª¤å››å¤šå¤´æ³¨æ„åŠ›å±‚çš„è¾“å‡º &lt;code&gt;output&lt;/code&gt;  ç›¸åŠ å³å¯å®Œæˆæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;katex-display&#34;&gt;&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34; display=&#34;block&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;output = output + x
&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.80952em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mrel&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2777777777777778em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.80952em;vertical-align:-0.19444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mbin&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mspace&#34; style=&#34;margin-right:0.2222222222222222em;&#34;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.43056em;vertical-align:0em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord mathnormal&#34;&gt;x&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨æ®‹å·®è¿æ¥ä¹‹åï¼Œè¿‡ç¨‹è¿›å…¥å±‚å½’ä¸€åŒ–ã€‚å±‚å½’ä¸€åŒ–ï¼ˆ &lt;code&gt;LayerNorm&lt;/code&gt; ï¼‰æ˜¯ä¸€ç§ç”¨äºå¯¹ç½‘ç»œä¸­æ¯ä¸€å±‚çš„è¾“å‡ºè¿›è¡Œå½’ä¸€åŒ–çš„æŠ€æœ¯ã€‚å…¶æ–¹æ³•æ˜¯å‡å»è¾“å‡ºçš„å‡å€¼ï¼Œå¹¶é™¤ä»¥è¾“å‡ºçš„æ ‡å‡†å·®ã€‚ä½¿ç”¨è¿™ç§æŠ€æœ¯æ˜¯ä¸ºäº†é˜²æ­¢æŸä¸€å±‚çš„è¾“å‡ºå˜å¾—è¿‡å¤§æˆ–è¿‡å°ï¼Œä»è€Œé¿å…ç½‘ç»œçš„ä¸ç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Add residual connection&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; output &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; X&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Add Layer Normalization&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;layer_norm &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;LayerNorm&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; layer_norm&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;output&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h1 id=&#34;å…­-feed-forward-network&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å…­-feed-forward-network&#34;&gt;#&lt;/a&gt; å…­ã€Feed-Forward Network&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒä¸€æ—¦æˆ‘ä»¬è·å¾—äº†å½’ä¸€åŒ–çš„æ³¨æ„åŠ›æƒé‡ï¼ˆæ¦‚ç‡åˆ†æ•°ï¼‰ï¼Œå®ƒå°†è¢«ä¼ é€’åˆ°ä¸€ä¸ªä½ç½®çº§å‰é¦ˆç½‘ç»œä¸­è¿›è¡Œå¤„ç†ã€‚å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆ &lt;code&gt;FFN&lt;/code&gt; ï¼‰ç”±ä¸¤ä¸ªçº¿æ€§å±‚å’Œå®ƒä»¬ä¹‹é—´çš„ ReLU æ¿€æ´»å‡½æ•°ç»„æˆã€‚&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# update x&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;x &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; output&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Define Feed Forward Network&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; d_model &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;output&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;ReLU&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;output&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;d_model &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;output&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;output&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; p&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;dropout&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; train&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Add residual connection&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; output &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; x&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Add Layer Normalization&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;layer_norm &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;LayerNorm&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; layer_norm&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;output&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h1 id=&#34;ä¸ƒ-repeat-step-4-to-6&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸ƒ-repeat-step-4-to-6&#34;&gt;#&lt;/a&gt; ä¸ƒã€Repeat step 4 to 6&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒä»¥ä¸Šæˆ‘ä»¬å®Œæˆçš„åªæ˜¯ä¸€ä¸ª &lt;code&gt;transformer&lt;/code&gt;  å—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šå°†å¤šä¸ª &lt;code&gt;transformer&lt;/code&gt;  å—å †å åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ª &lt;code&gt;transformer&lt;/code&gt;  è§£ç å™¨ã€‚&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒå®é™…ä¸Šï¼Œæˆ‘ä»¬åº”è¯¥å°†ä»£ç å°è£…åˆ°ç±»ä¸­ï¼Œå¹¶ä½¿ç”¨ &lt;code&gt;PyTorch&lt;/code&gt;  çš„ &lt;code&gt;nn.Module&lt;/code&gt;  æ¥æ„å»ºæˆ‘ä»¬çš„ &lt;code&gt;transformer&lt;/code&gt;  è§£ç å™¨ã€‚ä½†ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬åªä½¿ç”¨ä¸€ä¸ªå—ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…«-output-probabilities&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å…«-output-probabilities&#34;&gt;#&lt;/a&gt; å…«ã€Output Probabilities&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒåº”ç”¨æœ€åä¸€ä¸ªçº¿æ€§å±‚æ¥è·å¾—æˆ‘ä»¬çš„ &lt;code&gt;logits&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;logits &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; max_token_value&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;output&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;â€ƒâ€ƒæœ€åä¸€æ­¥æ˜¯å¯¹é€»è¾‘å›å½’è¾“å‡ºè¿›è¡Œ &lt;code&gt;softmax&lt;/code&gt;  æ“ä½œï¼Œä»¥è·å¾—æ¯ä¸ª &lt;code&gt;token&lt;/code&gt;  çš„æ¦‚ç‡ï¼š&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# torch.softmax usually used during inference, during training we use torch.nn.CrossEntropyLoss&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# but for illustration purpose, we&#39;ll use torch.softmax here&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;probabilities &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;softmax&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;logits&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h1 id=&#34;full-working-code&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#full-working-code&#34;&gt;#&lt;/a&gt; Full Working Code&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒå®Œæ•´çš„ä»£ç å¯ä»¥å‚è€ƒ &lt;code&gt;github&lt;/code&gt; : &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3dheWxhbmR6aGFuZy9UcmFuc2Zvcm1lci1mcm9tLXNjcmF0Y2g=&#34;&gt;https://github.com/waylandzhang/Transformer-from-scratch&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight py&#34;&gt;&lt;figcaption data-lang=&#34;Python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; os&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; requests&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; math&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; tiktoken&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; torch&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;nn &lt;span class=&#34;token keyword&#34;&gt;as&lt;/span&gt; nn&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;from&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;nn &lt;span class=&#34;token keyword&#34;&gt;import&lt;/span&gt; functional &lt;span class=&#34;token keyword&#34;&gt;as&lt;/span&gt; F&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Hyperparameters&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;batch_size &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# How many batches per training step&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;context_length &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;16&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Length of the token chunk each batch&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;d_model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;64&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# The size of our model token embeddings&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;num_blocks &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;8&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Number of transformer blocks&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;num_heads &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Number of heads in Multi-head attention&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;learning_rate &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1e-3&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# 0.001&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;dropout &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0.1&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Dropout rate&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;max_iters &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;5000&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Total of training iterations &amp;lt;- Change this to smaller number for testing&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;eval_interval &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;50&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# How often to evaluate&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;eval_iters &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;20&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Number of iterations to average for evaluation&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;device &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;cuda&#39;&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;cuda&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;is_available&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;cpu&#39;&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Use GPU if it&#39;s available.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;TORCH_SEED &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1337&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;manual_seed&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;TORCH_SEED&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Load training data&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;not&lt;/span&gt; os&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;path&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;exists&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;data/sales_textbook.txt&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    url &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;https://huggingface.co/datasets/goendalf666/sales-textbook_for_convincing_and_selling/raw/main/sales_textbook.txt&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;27&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;data/sales_textbook.txt&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;w&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;as&lt;/span&gt; f&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;28&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        f&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;write&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;requests&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;get&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;url&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;text&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;29&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;30&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;data/sales_textbook.txt&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;r&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; encoding&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;utf-8&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;as&lt;/span&gt; f&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;31&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    text &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; f&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;read&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;32&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;33&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Using TikToken (Same as GPT3) to tokenize the source text&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;34&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;encoding &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tiktoken&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;get_encoding&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#34;cl100k_base&#34;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;35&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;tokenized_text &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; encoding&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;encode&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;text&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;36&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;max_token_value &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;max&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# the maximum value of the tokenized numbers&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;37&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;tokenized_text &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tensor&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dtype&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; device&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# put tokenized text into tensor&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;38&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;39&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Split train and validation&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;40&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;split_idx &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0.9&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;41&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;train_data &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;split_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;42&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;val_data &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tokenized_text&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;split_idx&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;43&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;44&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;45&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Define Feed Forward Network&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;46&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;FeedForward&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Module&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;47&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;48&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token builtin&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;__init__&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;49&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; d_model&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;50&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; dropout&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;51&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;ffn &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Sequential&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;52&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;53&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;ReLU&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;54&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;55&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Dropout&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;dropout&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;56&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;57&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;58&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;59&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;ffn&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;60&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;61&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;62&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Define Scaled Dot Product Attention&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;63&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;Attention&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Module&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;64&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; head_size&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;65&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token builtin&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;__init__&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;66&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; d_model&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;67&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;head_size &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; head_size&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;68&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; context_length&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;69&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; dropout&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;70&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;71&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;key_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;head_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bias&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;72&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;query_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;head_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bias&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;73&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;value_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;head_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bias&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;74&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;register_buffer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;tril&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tril&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;75&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;ones&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Lower triangular mask&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;76&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Dropout&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;77&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;78&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;79&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        B&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; T&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; C &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; x&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;shape  &lt;span class=&#34;token comment&#34;&gt;# Batch size, Time steps(current context_length), Channels(dimensions)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;80&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;assert&lt;/span&gt; T &lt;span class=&#34;token operator&#34;&gt;&amp;lt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;81&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;assert&lt;/span&gt; C &lt;span class=&#34;token operator&#34;&gt;==&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;82&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        q &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;query_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;83&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        k &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;key_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;84&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        v &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;value_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;85&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;86&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# Scaled dot product attention: Q @ K^T / sqrt(d_k)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;87&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        weights &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;q @ k&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;transpose&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1.0&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt; math&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;sqrt&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;k&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;size&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;88&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# Apply masked attention&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;89&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        weights &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; weights&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;masked_fill&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tril&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;T&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;T&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;-inf&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;90&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        weights &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; F&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;softmax&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;weights&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;91&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        weights &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;weights&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;92&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;93&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# Apply dot product attention: weights @ V&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;94&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        out &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; weights @ v&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;95&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; out&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;96&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;97&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;98&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;MultiHeadAttention&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Module&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;99&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; head_size&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;100&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token builtin&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;__init__&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;101&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;num_heads &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; num_heads&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;102&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;head_size &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; head_size&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;103&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; d_model&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;104&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; context_length&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;105&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; dropout&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;106&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;107&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;heads &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;ModuleList&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;Attention&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;head_size&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;head_size&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; _ &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;num_heads&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;108&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;projection_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;109&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Dropout&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;dropout&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;110&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;111&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;112&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        out &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;cat&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;h&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; h &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;heads&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;113&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        out &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;projection_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;out&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;114&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        out &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;out&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;115&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; out&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;116&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;117&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;118&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;TransformerBlock&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Module&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;119&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;120&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; num_heads&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;121&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token builtin&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;__init__&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;122&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; d_model&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;123&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; context_length&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;124&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;head_size &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; d_model &lt;span class=&#34;token operator&#34;&gt;//&lt;/span&gt; num_heads  &lt;span class=&#34;token comment&#34;&gt;# head size should be divisible by d_model&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;125&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;num_heads &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; num_heads&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;126&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; dropout&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;127&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;128&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;multi_head_attention_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; MultiHeadAttention&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;head_size&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;head_size&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;129&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;feed_forward_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; FeedForward&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;130&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;layer_norm_1 &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;LayerNorm&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;normalized_shape&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;131&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;layer_norm_2 &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;LayerNorm&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;normalized_shape&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;132&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;133&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;134&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# Note: The order of the operations is different from the original Transformer paper&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;135&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# The order here is: LayerNorm -&gt; Multi-head attention -&gt; LayerNorm -&gt; Feed forward&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;136&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        x &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; x &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;multi_head_attention_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;layer_norm_1&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Residual connection&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;137&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        x &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; x &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;feed_forward_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;layer_norm_2&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;token comment&#34;&gt;# Residual connection&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;138&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; x&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;139&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;140&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;141&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;TransformerLanguageModel&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Module&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;142&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;143&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token builtin&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;__init__&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;144&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; d_model&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;145&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; context_length&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;146&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;num_heads &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; num_heads&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;147&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;num_blocks &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; num_blocks&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;148&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;dropout &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; dropout&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;149&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;max_token_value &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; max_token_value&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;150&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# Set up token embedding look-up table&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;151&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;token_embedding_lookup_table &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Embedding&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;num_embeddings&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;max_token_value &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; embedding_dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;152&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;153&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# Run all the transformer blocks&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;154&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# Different from original paper, here we add a final layer norm after all the blocks&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;155&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;transformer_blocks &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Sequential&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;156&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;TransformerBlock&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;num_heads&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;num_heads&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; _ &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;num_blocks&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;157&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;LayerNorm&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;158&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;159&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;language_model_out_linear_layer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; nn&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;Linear&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;in_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; out_features&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;max_token_value&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;160&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;161&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; idx&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; targets&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;162&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        B&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; T &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; idx&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;shape&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;163&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token triple-quoted-string string&#34;&gt;&#34;&#34;&#34;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;164&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        # Set up position embedding look-up table&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;165&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        # following the same approach as the original Transformer paper (Sine and Cosine functions)&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;166&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &#34;&#34;&#34;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;167&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        position_encoding_lookup_table &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;zeros&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;168&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        position &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;arange&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dtype&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;unsqueeze&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;169&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        div_term &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;exp&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;arange&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;math&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;log&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;10000.0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;d_model&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;170&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        position_encoding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;sin&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;position &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; div_term&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;171&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        position_encoding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;cos&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;position &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; div_term&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;172&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# change position_encoding_lookup_table from (context_length, d_model) to (T, d_model)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;173&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        position_embedding &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; position_encoding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;T&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;174&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        x &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;token_embedding_lookup_table&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;idx&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; position_embedding&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;175&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        x &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;transformer_blocks&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;176&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# The &#34;logits&#34; are the output values of our model before applying softmax&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;177&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        logits &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;language_model_out_linear_layer&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;178&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;179&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; targets &lt;span class=&#34;token keyword&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;token boolean&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;180&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            B&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; T&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; C &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; logits&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;shape&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;181&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            logits_reshaped &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; logits&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;view&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;B &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; T&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; C&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;182&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            targets_reshaped &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; targets&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;view&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;B &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; T&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;183&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            loss &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; F&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;cross_entropy&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;logits_reshaped&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; target&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;targets_reshaped&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;184&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;185&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            loss &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token boolean&#34;&gt;None&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;186&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; logits&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; loss&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;187&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;188&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;generate&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; idx&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; max_new_tokens&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;189&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token comment&#34;&gt;# idx is (B,T) array of indices in the current context&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;190&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; _ &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;max_new_tokens&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;191&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            &lt;span class=&#34;token comment&#34;&gt;# Crop idx to the max size of our positional embeddings table&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;192&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            idx_crop &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; idx&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;self&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;context_length&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;193&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            &lt;span class=&#34;token comment&#34;&gt;# Get predictions&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;194&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            logits&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; loss &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; self&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;idx_crop&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;195&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            &lt;span class=&#34;token comment&#34;&gt;# Get the last time step from logits where the dimensions of the logits are (B,T,C)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;196&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            logits_last_timestep &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; logits&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;197&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            &lt;span class=&#34;token comment&#34;&gt;# Apply softmax to get probabilities&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;198&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            probs &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; F&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;softmax&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;logits_last_timestep&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;199&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            &lt;span class=&#34;token comment&#34;&gt;# Sample from the probabilities&#39; distribution.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;200&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            idx_next &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;multinomial&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;probs&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; num_samples&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;201&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            &lt;span class=&#34;token comment&#34;&gt;# Append the sampled indexes idx_next to idx&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;202&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            idx &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;cat&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;idx&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; idx_next&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dim&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;203&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; idx&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;204&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;205&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;206&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Initialize the model&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;207&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; TransformerLanguageModel&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;208&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;model &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;209&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;210&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;211&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Get input embedding batch&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;212&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;get_batch&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;split&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;213&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    data &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; train_data &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; split &lt;span class=&#34;token operator&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;train&#39;&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;else&lt;/span&gt; val_data&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;214&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    idxs &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;randint&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;low&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; high&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;data&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt; context_length&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; size&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;batch_size&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;215&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    x &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;stack&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;data&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;idx&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;idx &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; context_length&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; idx &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; idxs&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;216&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    y &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;stack&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;data&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;idx &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;idx &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; context_length &lt;span class=&#34;token operator&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; idx &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; idxs&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;to&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;217&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; x&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; y&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;218&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;219&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;220&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Calculate loss&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;221&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token decorator annotation punctuation&#34;&gt;@torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;no_grad&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;222&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;estimate_loss&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;223&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    out &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;224&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;eval&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;225&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; split &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;train&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;valid&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;226&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        losses &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;zeros&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;eval_iters&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;227&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; k &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;eval_iters&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;228&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            x_batch&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; y_batch &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; get_batch&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;split&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;229&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            logits&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; loss &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; model&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x_batch&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; y_batch&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;230&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;            losses&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;k&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; loss&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;item&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;231&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        out&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;split&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; losses&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;mean&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;232&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;train&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;233&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; out&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;234&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;235&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;236&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Use AdamW optimizer&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;237&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;optimizer &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;optim&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;AdamW&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;params&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;parameters&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; lr&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;learning_rate&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;238&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;tracked_losses &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;239&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; step &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;max_iters&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;240&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; step &lt;span class=&#34;token operator&#34;&gt;%&lt;/span&gt; eval_iters &lt;span class=&#34;token operator&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;or&lt;/span&gt; step &lt;span class=&#34;token operator&#34;&gt;==&lt;/span&gt; max_iters &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;241&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        losses &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; estimate_loss&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;242&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        tracked_losses&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;append&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;losses&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;243&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;Step:&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; step&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;Training Loss:&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token builtin&#34;&gt;round&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;losses&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;train&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;item&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;Validation Loss:&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;244&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;              &lt;span class=&#34;token builtin&#34;&gt;round&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;losses&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;valid&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;item&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;245&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;246&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    xb&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; yb &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; get_batch&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;train&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;247&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    logits&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; loss &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; model&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;xb&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; yb&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;248&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    optimizer&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;zero_grad&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;set_to_none&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;249&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    loss&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;backward&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;250&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    optimizer&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;step&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;251&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;252&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Save the model state dictionary&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;253&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;save&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;state_dict&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;model-ckpt.pt&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;254&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;255&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;# Generate&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;256&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;eval&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;257&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;start &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;The salesperson&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;258&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;start_ids &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; encoding&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;encode&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;start&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;259&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;x &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tensor&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;start_ids&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; dtype&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;torch&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; device&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;device&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token boolean&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;260&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;y &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; model&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;generate&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;x&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; max_new_tokens&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;261&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;---------------&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;262&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;encoding&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;decode&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;y&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tolist&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;263&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token string&#34;&gt;&#39;---------------&#39;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt; ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://qianqiu-cell.github.io/2024/02/01/AI/Neural_networks_classification/</guid>
            <title>ç¥ç»ç½‘ç»œå¤§è‡´åˆ†ç±»</title>
            <link>http://qianqiu-cell.github.io/2024/02/01/AI/Neural_networks_classification/</link>
            <category>AI</category>
            <pubDate>Thu, 01 Feb 2024 00:00:00 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;å‚è€ƒæ–‡ç« ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yNjg3MDk2MTg=&#34;&gt;https://zhuanlan.zhihu.com/p/268709618&lt;/span&gt;&lt;br&gt;
&lt;img data-src=&#34;/images/AI/Neural_networks_classification/0.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;ä¸€-mpç¥ç»å…ƒæ¨¡å‹&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸€-mpç¥ç»å…ƒæ¨¡å‹&#34;&gt;#&lt;/a&gt; ä¸€ã€MP ç¥ç»å…ƒæ¨¡å‹&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒMP æ¨¡å‹æ˜¯é’ˆå¯¹ç”Ÿç‰©ç¥ç»å…ƒçš„ä¸€äº›åŸºæœ¬ç”Ÿç†ç‰¹å¾æ‰€æå‡ºçš„å½¢å¼ç¥ç»å…ƒçš„æ•°å­¦æ¨¡å‹ä¸ç»“æ„ï¼Œå…¶æƒå€¼è¢«è®¤ä¸ºæ˜¯ä¸å¯è°ƒæ•´çš„ã€‚MP ç¥ç»å…ƒæ¨¡å‹æ˜¯å…¶ä»–ç¥ç»ç½‘ç»œçš„åŸºç¡€ã€‚&lt;br&gt;
&lt;img data-src=&#34;/images/AI/Neural_networks_classification/1.1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;äºŒ-å‰é¦ˆç¥ç»ç½‘ç»œfnn&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äºŒ-å‰é¦ˆç¥ç»ç½‘ç»œfnn&#34;&gt;#&lt;/a&gt; äºŒã€å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFNNï¼‰&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒå¯¹äºå‰é¦ˆç½‘ç»œï¼Œæ ¹æ®ç¥ç»å…ƒçš„ä¼ é€’å‡½æ•°ä¸åŒï¼Œä»¥åŠå­¦ä¹ ç®—æ³•å’Œç½‘ç»œç»“æ„ä¸Šçš„åŒºåˆ«ï¼Œå¯ä»¥ç»†åˆ†ç±»æ„ŸçŸ¥å™¨ç½‘ç»œã€çº¿æ€§ç½‘ç»œã€BP ç½‘ç»œã€å¾„å‘åŸºç½‘ç»œåŠ GMDH ç½‘ç»œç­‰ä¸åŒçš„ç½‘ç»œæ¨¡å‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;21-æ„ŸçŸ¥å™¨pla&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#21-æ„ŸçŸ¥å™¨pla&#34;&gt;#&lt;/a&gt; 2.1 æ„ŸçŸ¥å™¨ï¼ˆPLAï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒæ„ŸçŸ¥å™¨æ¨¡å‹ï¼ˆPercetron Learning Algorithmï¼Œç®€ç§° PLAï¼‰æ˜¯ç”±ç¾å›½å­¦è€… F.Rosenblatt äº 1958 å¹´æå‡ºçš„ã€‚å®ƒä¸ MP æ¨¡å‹çš„ä¸åŒä¹‹å¤„æ˜¯å®ƒå‡å®šç¥ç»å…ƒçš„çªè§¦æƒå€¼æ˜¯å¯å˜çš„ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡Œå­¦ä¹ ã€‚æ„ŸçŸ¥å™¨æ˜¯æœ€ç®€å•å½¢å¼çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼Œæ˜¯ä¸€ç§äºŒå…ƒçº¿æ€§åˆ†ç±»å™¨ã€‚&lt;br&gt;
&lt;img data-src=&#34;/images/AI/Neural_networks_classification/1.2.png&#34; alt=&#34;&#34;&gt;&lt;br&gt;
â€ƒâ€ƒæ„ŸçŸ¥å™¨å…·æœ‰å¦‚ä¸‹çš„å±€é™æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ„ŸçŸ¥å™¨ç¥ç»ç½‘ç»œçš„ä¼ è¾“å‡½æ•°ä¸€èˆ¬é‡‡ç”¨é˜ˆå€¼å‡½æ•°ï¼Œæ‰€ä»¥è¾“å‡ºå€¼åªæœ‰ä¸¤ç§ï¼›&lt;/li&gt;
&lt;li&gt;å•å±‚æ„ŸçŸ¥å™¨ç½‘ç»œåªèƒ½ç”¨äºè§£å†³çº¿æ€§å¯åˆ†çš„åˆ†ç±»é—®é¢˜ï¼Œè€Œå¯¹çº¿æ€§ä¸å¯åˆ†çš„åˆ†ç±»é—®é¢˜æ— èƒ½ä¸ºåŠ›ï¼›&lt;/li&gt;
&lt;li&gt;æ„ŸçŸ¥å™¨å­¦ä¹ ç®—æ³•åªé€‚äºå•å±‚æ„ŸçŸ¥å™¨ç½‘ç»œï¼Œæ‰€ä»¥ä¸€èˆ¬æ„ŸçŸ¥å™¨ç½‘ç»œéƒ½æ˜¯å•å±‚çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;22-å¤šå±‚æ„ŸçŸ¥å™¨mlp&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#22-å¤šå±‚æ„ŸçŸ¥å™¨mlp&#34;&gt;#&lt;/a&gt; 2.2 å¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMLPï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒå¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆMultilayer Perceptron, ç®€ç§° MLPï¼‰æ˜¯æ„ŸçŸ¥å™¨çš„æ¨å¹¿ï¼Œå…‹æœäº†æ„ŸçŸ¥å™¨ä¸èƒ½å¯¹çº¿æ€§ä¸å¯åˆ†æ•°æ®è¿›è¡Œè¯†åˆ«çš„å¼±ç‚¹ã€‚å¯¹äºéçº¿æ€§å‡½æ•°çš„æ¨¡æ‹Ÿï¼Œéœ€è¦é‡‡ç”¨ MLPï¼Œå³åœ¨æœ€åˆçš„è¾“å…¥å’Œè¾“å‡ºå±‚ä¹‹é—´éšè—ç€ä¸€åˆ°å¤šä¸ªå±‚ã€‚&lt;br&gt;
â€ƒâ€ƒ&lt;mark&gt;å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼ˆFully Connected Neural Networkï¼Œç®€ç§° FNNï¼‰ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œï¼ˆ Deep Neural Networksï¼Œç®€ç§° DNNï¼‰å’Œ MLP çš„æ¦‚å¿µç›¸ä¼¼ï¼Œåªæ˜¯ä¾§é‡ç‚¹ä¸åŒã€‚ä¸€ä¸ªå¤šå±‚å…¨è¿æ¥ç¥ç»ç½‘ç»œå³ä½¿ MLPï¼Œåˆæ˜¯ FNNï¼ŒåŒæ—¶ä¹Ÿæ˜¯ DNNã€‚&lt;/mark&gt;&lt;br&gt;
â€ƒâ€ƒ&lt;mark&gt;BP ç¥ç»ç½‘ç»œæ˜¯æŒ‡ä½¿ç”¨äº† BP ç®—æ³•ï¼ˆ Back Propagationï¼Œåå‘ä¼ æ’­ï¼‰è¿›è¡Œè®­ç»ƒçš„ MLP æ¨¡å‹ã€‚&lt;/mark&gt;&lt;/p&gt;
&lt;h2 id=&#34;23-å¾„å‘åŸºç¥ç»ç½‘ç»œrbfnn&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#23-å¾„å‘åŸºç¥ç»ç½‘ç»œrbfnn&#34;&gt;#&lt;/a&gt; 2.3 å¾„å‘åŸºç¥ç»ç½‘ç»œï¼ˆRBFNNï¼‰&lt;/h2&gt;
&lt;p&gt;å‚è€ƒé“¾æ¥ï¼š &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDgwMjY3Ni9hcnRpY2xlL2RldGFpbHMvMTAwODA1NTQ1&#34;&gt;https://blog.csdn.net/weixin_40802676/article/details/100805545&lt;/span&gt;&lt;br&gt;
â€ƒâ€ƒé¦–å…ˆä»‹ç»å¾„å‘åŸºå‡½æ•°ï¼ˆ Radial Basis Functionï¼Œç®€ç§° RBFï¼‰ï¼š&lt;br&gt;
&lt;img data-src=&#34;/images/AI/Neural_networks_classification/1.3.png&#34; alt=&#34;&#34;&gt;&lt;br&gt;
â€ƒâ€ƒæœ€å¸¸ç”¨çš„å¾„å‘åŸºå‡½æ•°æ˜¯é«˜æ–¯å‡½æ•°ï¼ˆradbasï¼‰ã€‚&lt;br&gt;
&lt;img data-src=&#34;/images/AI/Neural_networks_classification/1.4.png&#34; alt=&#34;&#34;&gt;&lt;br&gt;
â€ƒâ€ƒRBFNN çš„ç¥ç»ç½‘ç»œèŠ‚åå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ä¸‰å±‚çš„ç¥ç»ç½‘ç»œå°±å¯ä»¥æ‹Ÿåˆä»»ä½•ä¸€ä¸ªå‡½æ•°ï¼ŒRBFNN å³ä¸ºä¸‰å±‚ï¼ˆå•éšå±‚ï¼‰ä¸”éšè—å±‚ä½¿ç”¨å¾„å‘åŸºå‡½æ•°çš„ç¥ç»ç½‘ç»œã€‚å› æ­¤ RBFNN å®Œå…¨å¯ä»¥æ‹Ÿåˆä»»ä½•ä¸€ä¸ªå‡½æ•°ï¼ˆåªè¦éšè—å±‚ç¥ç»å…ƒè¶³å¤Ÿå¤šï¼‰ã€‚è¾“å…¥å±‚åˆ°éšè—å±‚çš„ç¥ç»å…ƒä¹‹é—´çš„æƒé‡å…¨éƒ¨ä¸º 1ã€‚éšè—å±‚æ˜¯ä½¿ç”¨å¾„å‘åŸºå‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°çš„ç¥ç»å…ƒã€‚éšè—å±‚ä¸è¾“å‡ºå±‚ä¹‹é—´å°±æ˜¯æ™®é€šçš„ç¥ç»ç½‘ç»œçš„è¿æ¥å…³ç³»ï¼Œä»–ä»¬ä¹‹é—´çš„æƒé‡å¯ä»¥è®­ç»ƒè€Œæ”¹å˜ã€‚&lt;br&gt;
â€ƒâ€ƒRBFNN çš„å…³é”®å°±åœ¨äºå¾„å‘åŸºå‡½æ•°çš„ç¡®å®šï¼Œä¸­å¿ƒç‚¹åœ¨å“ªï¼Œå¾„åŸºå®½åº¦å¤šå¤§ï¼Œå¤šå°‘ä¸ªå¾„å‘åŸºå‡½æ•°ï¼Œéƒ½æ˜¯ä¼šå½±å“ç¥ç»ç½‘ç»œçš„æ•ˆæœçš„ã€‚å¹¿ä¹‰å›å½’ç¥ç»ç½‘ç»œ (General Regression Neural Networkï¼Œç®€ç§° GRNN) å’Œå¹¿ä¹‰å›å½’ç¥ç»ç½‘ç»œ (General Regression Neural Networkï¼Œç®€ç§° GPNN) éƒ½æ˜¯ RBFNN çš„å˜åŒ–å½¢å¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;24-å·ç§¯ç¥ç»ç½‘ç»œcnn&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#24-å·ç§¯ç¥ç»ç½‘ç»œcnn&#34;&gt;#&lt;/a&gt; 2.4 å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒå·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Networksï¼Œç®€ç§° CNNï¼‰æ˜¯ä¸€ç§æ·±åº¦å­¦ä¹ æ¨¡å‹æˆ–ç±»ä¼¼äºäººå·¥ç¥ç»ç½‘ç»œçš„å¤šå±‚æ„ŸçŸ¥å™¨ï¼Œå¸¸ç”¨æ¥åˆ†æè§†è§‰å›¾åƒã€‚&lt;br&gt;
&lt;img data-src=&#34;/images/AI/Neural_networks_classification/1.5.png&#34; alt=&#34;&#34;&gt;&lt;br&gt;
â€ƒâ€ƒä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œä¸»è¦ç”±ä»¥ä¸‹ 5 å±‚ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®è¾“å…¥å±‚ / Input layer&lt;/li&gt;
&lt;li&gt;å·ç§¯è®¡ç®—å±‚ / CONV layer&lt;/li&gt;
&lt;li&gt;ReLU æ¿€åŠ±å±‚ / ReLU layer&lt;/li&gt;
&lt;li&gt;æ± åŒ–å±‚     / Pooling layer&lt;/li&gt;
&lt;li&gt;å…¨è¿æ¥å±‚   / FC layer&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;25-çº¿æ€§ç¥ç»ç½‘å’¯&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#25-çº¿æ€§ç¥ç»ç½‘å’¯&#34;&gt;#&lt;/a&gt; 2.5 çº¿æ€§ç¥ç»ç½‘å’¯&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒçº¿æ€§ç¥ç»ç½‘ç»œä¸æ„ŸçŸ¥å™¨çš„ä¸»è¦åŒºåˆ«åœ¨äºæ„ŸçŸ¥å™¨çš„æ¿€æ´»å‡½æ•°åªèƒ½è¾“å‡ºä¸¤ç§å¯èƒ½å€¼ï¼ˆ-1 æˆ– 1ï¼‰ï¼Œè€Œçº¿æ€§ç¥ç»ç½‘ç»œçš„è¾“å‡ºå¯ä»¥å–ä»»æ„å€¼ï¼Œå…¶æ¿€æ´»å‡½æ•°æ˜¯çº¿æ€§å‡½æ•°ã€‚&lt;br&gt;
â€ƒâ€ƒçº¿æ€§ç¥ç»ç½‘ç»œé‡‡ç”¨ Widrow-Hoff å­¦ä¹ è§„åˆ™ï¼ˆæœ€å°å‡æ–¹è§„åˆ™ï¼‰ï¼Œå³ LMSï¼ˆLeast Mean Squareï¼‰ç®—æ³•æ¥è°ƒæ•´ç½‘ç»œçš„æƒå€¼å’Œåç½®å€¼ã€‚ç»“æ„å›¾å¦‚ä¸‹ã€‚è¿™é‡Œä½¿ç”¨ purelin æ¿€æ´»å‡½æ•°è¿›è¡Œæ¨¡å‹è®­ç»ƒï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ›´å¥½çš„æ•ˆæœã€‚è¾“å‡ºç»“æœçš„æ—¶å€™è¿˜æ˜¯ä½¿ç”¨ sign æ¿€æ´»å‡½æ•°ã€‚&lt;br&gt;
&lt;img data-src=&#34;/images/AI/Neural_networks_classification/1.6.png&#34; alt=&#34;&#34;&gt;&lt;br&gt;
&lt;img data-src=&#34;/images/AI/Neural_networks_classification/1.7.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;ä¸‰-åé¦ˆç¥ç»ç½‘ç»œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸‰-åé¦ˆç¥ç»ç½‘ç»œ&#34;&gt;#&lt;/a&gt; ä¸‰ã€åé¦ˆç¥ç»ç½‘ç»œ&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒæ‰€è°“åé¦ˆç½‘ç»œæ˜¯æŒ‡åœ¨ç½‘ç»œä¸­è‡³å°‘å«æœ‰ä¸€ä¸ªåé¦ˆå›è·¯çš„ç¥ç»ç½‘ç»œã€‚åé¦ˆç½‘ç»œå¯ä»¥åŒ…å«ä¸€ä¸ªå•å±‚ç¥ç»å…ƒï¼Œå…¶ä¸­æ¯ä¸ªç¥ç»å…ƒå°†è‡ªèº«çš„è¾“å‡ºä¿¡å·åé¦ˆç»™å…¶ä»–æ‰€æœ‰ç¥ç»å…ƒçš„è¾“å…¥ åé¦ˆç¥ç»ç½‘ç»œä¸­ç¥ç»å…ƒä¸ä½†å¯ä»¥æ¥æ”¶å…¶ä»–ç¥ç»å…ƒçš„ä¿¡å·ï¼Œè€Œä¸”å¯ä»¥æ¥æ”¶è‡ªå·±çš„åé¦ˆä¿¡å·ã€‚å’Œå‰é¦ˆç¥ç»ç½‘ç»œç›¸æ¯”ï¼Œåé¦ˆç¥ç»ç½‘ç»œä¸­çš„ç¥ç»å…ƒå…·æœ‰è®°å¿†åŠŸèƒ½ï¼Œåœ¨ä¸åŒæ—¶åˆ»å…·æœ‰ä¸åŒçš„çŠ¶æ€ã€‚åé¦ˆç¥ç»ç½‘ç»œä¸­çš„ä¿¡æ¯ä¼ æ’­å¯ä»¥æ˜¯å•å‘ä¹Ÿå¯ä»¥æ˜¯åŒå‘ä¼ æ’­ï¼Œå› æ­¤å¯ä»¥ç”¨ä¸€ä¸ªæœ‰å‘å¾ªç¯å›¾æˆ–è€…æ— å‘å›¾æ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;31-å¾ªç¯ç¥ç»ç½‘ç»œrnn&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#31-å¾ªç¯ç¥ç»ç½‘ç»œrnn&#34;&gt;#&lt;/a&gt; 3.1 å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networkï¼Œç®€ç§° RNNï¼‰æ˜¯ä¸€ç§æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¸“é—¨ç”¨äºå¤„ç†åºåˆ—æ•°æ®å’Œå…·æœ‰æ—¶é—´ä¾èµ–æ€§çš„ä»»åŠ¡ã€‚ç›¸æ¯”äºä¼ ç»Ÿç¥ç»ç½‘ç»œï¼ŒRNN å…·æœ‰ä¸€ç§é€’å½’ç»“æ„ï¼Œä½¿å…¶èƒ½å¤Ÿå¯¹åºåˆ—ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚&lt;br&gt;
â€ƒâ€ƒRNN çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å®ƒèƒ½å¤Ÿä¿æŒå¯¹ä¹‹å‰è¾“å…¥ä¿¡æ¯çš„è®°å¿†ï¼Œè¿™ä½¿å¾—å®ƒåœ¨å¤„ç†æ—¶é—´åºåˆ—ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰ä»»åŠ¡æ—¶éå¸¸æœ‰æ•ˆã€‚å®ƒçš„åŸºæœ¬ç»“æ„åŒ…æ‹¬ä¸€ä¸ªéšè—å±‚ï¼Œå…¶ä¸­çš„ç¥ç»å…ƒå¯ä»¥æ¥æ”¶è¾“å…¥æ•°æ®å’Œå‰ä¸€ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªæ–°çš„éšè—çŠ¶æ€ã€‚è¿™ç§é€’å½’ç»“æ„ä½¿å¾— RNN èƒ½å¤Ÿæ•æ‰åºåˆ—ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£å’Œå¤„ç†åºåˆ—æ•°æ®ã€‚&lt;br&gt;
â€ƒâ€ƒç„¶è€Œï¼Œä¼ ç»Ÿçš„ RNN å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸ç­‰é—®é¢˜ï¼Œå¯¼è‡´éš¾ä»¥æ•æ‰é•¿æœŸä¾èµ–å…³ç³»ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œä¸€äº›æ”¹è¿›å‹çš„å¾ªç¯ç¥ç»ç½‘ç»œè¢«æå‡ºï¼Œå¦‚é•¿çŸ­æ—¶è®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memoryï¼Œç®€ç§° LSTMï¼‰å’Œé—¨æ§å¾ªç¯å•å…ƒï¼ˆGated Recurrent Unitï¼Œç®€ç§° GRUï¼‰ã€‚è¿™äº›æ”¹è¿›æ¨¡å‹å¼•å…¥äº†é—¨æ§æœºåˆ¶ï¼Œä½¿å¾—ç½‘ç»œèƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†é•¿æœŸä¾èµ–å…³ç³»ï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚&lt;br&gt;
â€ƒâ€ƒæ€»çš„æ¥è¯´ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œåœ¨å¤„ç†åºåˆ—æ•°æ®æ–¹é¢å…·æœ‰å¹¿æ³›çš„åº”ç”¨ï¼ŒåŒ…æ‹¬è‡ªç„¶è¯­è¨€å¤„ç†ã€è¯­éŸ³è¯†åˆ«ã€æ—¶é—´åºåˆ—é¢„æµ‹ç­‰é¢†åŸŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;32-hopfieldç¥ç»ç½‘ç»œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#32-hopfieldç¥ç»ç½‘ç»œ&#34;&gt;#&lt;/a&gt; 3.2 Hopfield ç¥ç»ç½‘ç»œ&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒHopfield ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§åé¦ˆå‹çš„äººå·¥ç¥ç»ç½‘ç»œï¼Œæœ€åˆç”±ç‰©ç†å­¦å®¶çº¦ç¿°ãƒ»éœæ™®è²å°”å¾·ï¼ˆJohn Hopfieldï¼‰äº 1982 å¹´æå‡ºã€‚å®ƒä¸»è¦ç”¨äºæ¨¡æ‹Ÿå’Œå¤„ç†ç¦»æ•£å‹åŠ¨åŠ›ç³»ç»Ÿï¼Œå°¤å…¶åœ¨è§£å†³ä¼˜åŒ–é—®é¢˜å’Œæ¨¡å¼è¯†åˆ«æ–¹é¢åº”ç”¨å¹¿æ³›ã€‚æ ¹æ®å…¶æ¿€æ´»å‡½æ•°çš„ä¸åŒï¼ŒHopfield ç¥ç»ç½‘ç»œæœ‰ä¸¤ç§ï¼šç¦»æ•£ Hopfield ç½‘ç»œï¼ˆDiscrete Hopfield Neural Networkï¼Œç®€ç§° DHNNï¼‰å’Œè¿ç»­ Hopfield ç½‘ç»œï¼ˆContinues Hopfield Neural Networkï¼Œç®€ç§° CHNNï¼‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;å››-å¯¹æŠ—ç¥ç»ç½‘ç»œgan&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å››-å¯¹æŠ—ç¥ç»ç½‘ç»œgan&#34;&gt;#&lt;/a&gt; å››ã€å¯¹æŠ—ç¥ç»ç½‘ç»œï¼ˆGANï¼‰&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒç®€ä»‹ï¼šå¯¹æŠ—ç¥ç»ç½‘ç»œå…¶å®æ˜¯ä¸¤ä¸ªç½‘ç»œçš„ç»„åˆï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç½‘ç»œç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼Œå¦ä¸€ä¸ªç½‘ç»œåˆ¤æ–­ç”Ÿæˆçš„æ•°æ®æ˜¯çœŸå®çš„è¿˜æ˜¯æ¨¡æ‹Ÿçš„ã€‚ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®çš„ç½‘ç»œè¦ä¸æ–­ä¼˜åŒ–è‡ªå·±è®©åˆ¤åˆ«çš„ç½‘ç»œåˆ¤æ–­ä¸å‡ºæ¥ï¼Œåˆ¤åˆ«çš„ç½‘ç»œä¹Ÿè¦ä¸æ–­ä¼˜åŒ–è‡ªå·±è®©åˆ¤æ–­çš„æ›´åŠ ç²¾ç¡®ã€‚ä¸¤è€…çš„å…³ç³»å½¢æˆå¯¹æŠ—ï¼Œå› æ­¤å«å¯¹æŠ—ç¥ç»ç½‘ç»œã€‚&lt;br&gt;
â€ƒâ€ƒç»“æ„ï¼šGAN ç”± generatorï¼ˆç”Ÿæˆæ¨¡å‹ï¼‰å’Œ discriminatorï¼ˆåˆ¤åˆ«å¼æ¨¡å‹ï¼‰ä¸¤éƒ¨åˆ†æ„æˆã€‚äºŒè€…ç»“åˆä¹‹åï¼Œç»è¿‡å¤§é‡æ¬¡æ•°çš„è¿­ä»£è®­ç»ƒä¼šä½¿ generator å°½å¯èƒ½æ¨¡æ‹Ÿå‡ºä»¥å‡ä¹±çœŸçš„æ ·æœ¬ï¼Œè€Œ discrimator ä¼šæœ‰æ›´ç²¾ç¡®çš„é‰´åˆ«çœŸä¼ªæ•°æ®çš„èƒ½åŠ›ï¼Œæœ€ç»ˆæ•´ä¸ª GAN ä¼šè¾¾åˆ°æ‰€è°“çš„çº³ä»€å‡è¡¡ï¼Œå³ discriminator å¯¹äº generator çš„æ•°æ®é‰´åˆ«ç»“æœä¸ºæ­£ç¡®ç‡å’Œé”™è¯¯ç‡å„å  50%ã€‚&lt;/p&gt;
&lt;h1 id=&#34;äº”-è‡ªç»„ç»‡ç¥ç»ç½‘ç»œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äº”-è‡ªç»„ç»‡ç¥ç»ç½‘ç»œ&#34;&gt;#&lt;/a&gt; äº”ã€è‡ªç»„ç»‡ç¥ç»ç½‘ç»œ&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨ç”Ÿç‰©ç¥ç»ç³»ç»Ÿä¸­ï¼Œå­˜åœ¨ç€ä¸€ç§ä¾§æŠ‘åˆ¶ç°è±¡ï¼Œå³ä¸€ä¸ªç¥ç»ç»†èƒå…´å¥‹ä»¥åï¼Œä¼šå¯¹å‘¨å›´å…¶ä»–ç¥ç»ç»†èƒäº§ç”ŸæŠ‘åˆ¶ä½œç”¨ã€‚è¿™ç§æŠ‘åˆ¶ä½œç”¨ä¼šä½¿ç¥ç»ç»†èƒä¹‹é—´å‡ºç°ç«äº‰ï¼Œå…¶ç»“æœæ˜¯æŸäº›è·èƒœï¼Œè€Œå¦ä¸€äº›åˆ™å¤±è´¥ã€‚è¡¨ç°å½¢å¼æ˜¯è·èƒœç¥ç»ç»†èƒå…´å¥‹ï¼Œå¤±è´¥ç¥ç»ç»†èƒæŠ‘åˆ¶ã€‚è‡ªç»„ç»‡ï¼ˆç«äº‰å‹ï¼‰ç¥ç»ç½‘ç»œå°±æ˜¯æ¨¡æ‹Ÿä¸Šè¿°ç”Ÿç‰©ç¥ç»ç³»ç»ŸåŠŸèƒ½çš„äººå·¥ç¥ç»ç½‘ç»œã€‚&lt;/p&gt;
&lt;h1 id=&#34;å…­-åé¦ˆç¥ç»ç½‘ç»œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å…­-åé¦ˆç¥ç»ç½‘ç»œ&#34;&gt;#&lt;/a&gt; å…­ã€åé¦ˆç¥ç»ç½‘ç»œ&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒä¸€èˆ¬çš„ç¥ç»ç½‘ç»œæ¨¡å‹é€šå¸¸å‡å®šç½‘ç»œç»“æ„æ˜¯äº‹å…ˆå›ºå®šçš„ï¼Œè®­ç»ƒçš„ç›®çš„æ˜¯åˆ©ç”¨è®­ç»ƒæ ·æœ¬æ¥ç¡®å®šåˆé€‚çš„è¿æ¥æƒã€é˜™å€¼ç­‰å‚æ•°ã€‚ä¸æ­¤ä¸åŒï¼Œç»“æ„è‡ªé€‚åº”ç½‘ç»œåˆ™å°†ç½‘ç»œç»“æ„ä¹Ÿå½“ä½œå­¦ä¹ çš„ç›®æ ‡ä¹‹ä¸€ï¼Œå¹¶å¸Œæœ›èƒ½åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ‰¾åˆ°æœ€åˆ©åˆæ•°æ®ç‰¹ç‚¹çš„ç½‘ç»œç»“æ„&lt;/p&gt;
&lt;h1 id=&#34;ä¸ƒ-åé¦ˆç¥ç»ç½‘ç»œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸ƒ-åé¦ˆç¥ç»ç½‘ç»œ&#34;&gt;#&lt;/a&gt; ä¸ƒã€åé¦ˆç¥ç»ç½‘ç»œ&lt;/h1&gt;
&lt;p&gt;â€ƒâ€ƒéšæœºç¥ç»ç½‘ç»œæ˜¯å¯¹ç¥ç»ç½‘ç»œå¼•å…¥éšæœºæœºåˆ¶ï¼Œè®¤ä¸ºç¥ç»å…ƒæ˜¯æŒ‰ç…§æ¦‚ç‡çš„åŸç†è¿›è¡Œå·¥ä½œçš„ï¼Œè¿™å°±æ˜¯è¯´ï¼Œæ¯ä¸ªç¥ç»å…ƒçš„å…´å¥‹æˆ–æŠ‘åˆ¶å…·æœ‰éšæœºæ€§ï¼Œå…¶æ¦‚ç‡å–å†³äºç¥ç»å…ƒçš„è¾“å…¥ã€‚&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
